"use strict";(self.webpackChunkdora_dora=self.webpackChunkdora_dora||[]).push([[5892],{55892:(e,l,r)=>{r.r(l),r.d(l,{default:()=>Q});var i=r(89379),t=r(54616),o=r(59852),d=r(9950),n=r(57559),a=r(65827),s=r(65250),c=r(27321),h=r(71500),p=r(47371),x=r(87209),u=r(53693),m=r(66615),y=r(55030),g=r(13450),j=r(29949),v=r(71613),f=r(10495),A=r(88198),b=r(9762),k=r(40991),T=r(79771),S=r(77459),P=r(75641),w=r(58179),F=r(23072),C=r(58025),M=r(84765),D=r(44414);let B=[];const z=e=>[{title:e("pro.order"),dataIndex:"order",showSorterTooltip:{target:"full-header"},defaultSortOrder:"descend",sorter:(e,l)=>e.order-l.order,sortDirections:["ascend","descend"]},{title:e("pro.time"),dataIndex:"time",sorter:(e,l)=>e.time-l.time,sortDirections:["ascend","descend"],render:(e,l)=>{let{time:r}=l;return(0,D.jsxs)(D.Fragment,{children:[r," ms"]})}},{title:e("pro.depth"),dataIndex:"depth",sorter:(e,l)=>e.depth-l.depth,sortDirections:["ascend","descend"],render:(e,l)=>{let{depth:r}=l;return(0,D.jsxs)(D.Fragment,{children:[Array.from({length:r},(e,l)=>(0,D.jsx)("p",{style:{display:"inline-block",padding:0,margin:0},children:"\u2003"},l)),r+1]})}},{title:e("pro.module"),dataIndex:"moduleName"}],L=e=>(0,D.jsx)("span",{children:e.split(/\[(error|warning|info)\]/).map((e,l)=>l%2===1?(0,D.jsxs)("span",{children:["[",(0,D.jsx)("span",{style:{color:"error"===e?g.Q1.Error:"warning"===e?g.Q1.Warning:g.Q1.Info},children:e}),"]"]},l):(0,D.jsx)("span",{children:e},l))}),G={appear:!1,enter:!1,exit:!1},Q=(0,d.memo)(e=>{var l;const{t:r}=(0,y.Bd)(),[Q,U]=(0,d.useState)(r("log.wait")),[O,W]=(0,d.useState)(""),[R,H]=(0,d.useState)([]),[I,N]=(0,d.useState)(-1),[K,E]=(0,d.useState)(M.A.webProfiler),[X,Y]=(0,d.useState)(null),[V,_]=(0,d.useState)(z(r));(0,d.useEffect)(()=>{_(z(r))},[r]),(0,d.useEffect)(()=>{const e=(e,l)=>{U(""===l?r("log.wait"):l)};o.oi(e);const l=e=>{if(K){var l;if(void 0===e.loaderCosts)e.loaderCosts=null!==(l=null===X||void 0===X?void 0:X.loaderCosts)&&void 0!==l?l:[],B=e.plotCount>0?Array.from({length:e.plotCount+1},(e,l)=>l):[];Y(e)}};return o.NW(l),()=>{o.N4(e),o.KW(l)}},[r,null===X||void 0===X?void 0:X.loaderCosts,K]);const q=e=>{null!==X&&(X.targetFPS=e.target.value,o.G5({code:"App.targetFPS = ".concat(X.targetFPS),log:!1}).then(()=>{Y((0,i.A)({},X))}).catch(e=>{console.error(e)}))},J=e=>{null!==X&&(X.fixedFPS=e.target.value,o.G5({code:"Director.scheduler.fixedFPS = ".concat(X.fixedFPS),log:!1}).then(()=>{Y((0,i.A)({},X))}).catch(e=>{console.error(e)}))},Z=e=>{null!==X&&(X.vSync=e.target.checked,o.G5({code:"View.vsync = ".concat(X.vSync?"true":"false"),log:!1}).then(()=>{Y((0,i.A)({},X))}).catch(e=>{console.error(e)}))},$=e=>{null!==X&&(X.fpsLimited=e.target.checked,o.G5({code:"App.fpsLimited = ".concat(X.fpsLimited?"true":"false"),log:!1}).then(()=>{Y((0,i.A)({},X))}).catch(e=>{console.error(e)}))};let ee,le,re,ie,te=null,oe=null,de=0;if(null!==X){var ne,ae;ee=[{key:"1",label:(0,D.jsx)(n.A,{title:r("pro.rendererTip"),children:(0,D.jsx)("div",{children:r("pro.renderer")})}),children:X.renderer},{key:"2",label:(0,D.jsx)(n.A,{title:r("pro.multiThreadedTip"),children:(0,D.jsx)("div",{children:r("pro.multiThreaded")})}),children:X.multiThreaded?"Yes":"No"},{key:"3",label:(0,D.jsx)(n.A,{title:r("pro.backBufferTip"),children:(0,D.jsx)("div",{children:r("pro.backBuffer")})}),children:X.backBufferX+" x "+X.backBufferY},{key:"4",label:(0,D.jsx)(n.A,{title:r("pro.drawCallTip"),children:(0,D.jsx)("div",{children:r("pro.drawCall")})}),children:X.drawCall},{key:"5",label:(0,D.jsx)(n.A,{title:r("pro.triTip"),children:(0,D.jsx)("div",{children:r("pro.tri")})}),children:X.tri},{key:"6",label:(0,D.jsx)(n.A,{title:r("pro.lineTip"),children:(0,D.jsx)("div",{children:r("pro.line")})}),children:X.line},{key:"7",label:(0,D.jsx)(n.A,{title:r("pro.visualSizeTip"),children:(0,D.jsx)("div",{children:r("pro.visualSize")})}),children:X.visualSizeX+" x "+X.visualSizeY},{key:"8",label:(0,D.jsx)(n.A,{title:r("pro.vSyncTip"),children:(0,D.jsx)("div",{children:r("pro.vSync")})}),children:(0,D.jsx)(f.A,{checked:null===X||void 0===X?void 0:X.vSync,onChange:Z})},{key:"9",label:(0,D.jsx)(n.A,{title:r("pro.fpsLimitedTip"),children:(0,D.jsx)("div",{children:r("pro.fpsLimited")})}),children:(0,D.jsx)(f.A,{checked:null===X||void 0===X?void 0:X.fpsLimited,onChange:$})},{key:"10",label:(0,D.jsx)(n.A,{title:r("pro.fpsTip"),children:(0,D.jsx)("div",{children:r("pro.fps")})}),children:(0,D.jsxs)(k.Ay.Group,{onChange:q,value:X.targetFPS,children:[(0,D.jsx)(k.Ay,{value:30,children:"30"}),(0,D.jsx)("br",{}),(0,D.jsx)(k.Ay,{value:45,children:"45"}),(0,D.jsx)("br",{}),(0,D.jsx)(k.Ay,{value:60,children:"60"}),X.maxTargetFPS>60&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("br",{}),(0,D.jsx)(k.Ay,{value:X.maxTargetFPS,children:X.maxTargetFPS})]})]})},{key:"11",label:(0,D.jsx)(n.A,{title:r("pro.currentFPSTip"),children:(0,D.jsx)("div",{children:r("pro.currentFPS")})}),children:X.currentFPS},{key:"12",label:(0,D.jsx)(n.A,{title:r("pro.fixedFPSTip"),children:(0,D.jsx)("div",{children:r("pro.fixedFPS")})}),children:(0,D.jsxs)(k.Ay.Group,{onChange:J,value:X.fixedFPS,children:[(0,D.jsx)(k.Ay,{value:30,children:"30"}),(0,D.jsx)("br",{}),(0,D.jsx)(k.Ay,{value:45,children:"45"}),(0,D.jsx)("br",{}),(0,D.jsx)(k.Ay,{value:60,children:"60"}),X.maxTargetFPS>60&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("br",{}),(0,D.jsx)(k.Ay,{value:X.maxTargetFPS,children:X.maxTargetFPS})]})]})}],le=[{key:"1",label:(0,D.jsx)(n.A,{title:r("pro.avgCPUTip"),children:(0,D.jsx)("div",{children:r("pro.avgCPU")})}),children:X.avgCPU+" ms"},{key:"2",label:(0,D.jsx)(n.A,{title:r("pro.avgGPUTip"),children:(0,D.jsx)("div",{children:r("pro.avgGPU")})}),children:X.avgGPU+" ms"}],re=[{key:"1",label:(0,D.jsx)(n.A,{title:r("pro.cppObjectTip"),children:(0,D.jsx)("div",{children:r("pro.cppObject")})}),children:X.cppObject},{key:"2",label:(0,D.jsx)(n.A,{title:r("pro.luaObjectTip"),children:(0,D.jsx)("div",{children:r("pro.luaObject")})}),children:X.luaObject},{key:"3",label:(0,D.jsx)(n.A,{title:r("pro.luaCallbackTip"),children:(0,D.jsx)("div",{children:r("pro.luaCallback")})}),children:X.luaCallback},{key:"4",label:(0,D.jsx)(n.A,{title:r("pro.texturesTip"),children:(0,D.jsx)("div",{children:r("pro.textures")})}),children:X.textures},{key:"5",label:(0,D.jsx)(n.A,{title:r("pro.fontsTip"),children:(0,D.jsx)("div",{children:r("pro.fonts")})}),children:X.fonts},{key:"6",label:(0,D.jsx)(n.A,{title:r("pro.audiosTip"),children:(0,D.jsx)("div",{children:r("pro.audios")})}),children:X.audios}],ie=[{key:"1",label:(0,D.jsx)(n.A,{title:r("pro.memoryPoolTip"),children:(0,D.jsx)("div",{children:r("pro.memoryPool")})}),children:X.memoryPool/1024+" KB"},{key:"2",label:(0,D.jsx)(n.A,{title:r("pro.luaMemoryTip"),children:(0,D.jsx)("div",{children:r("pro.luaMemory")})}),children:(X.luaMemory/1024/1024).toFixed(2)+" MB"},{key:"3",label:(0,D.jsx)(n.A,{title:r("pro.tealMemoryTip"),children:(0,D.jsx)("div",{children:r("pro.tealMemory")})}),children:(X.tealMemory/1024/1024).toFixed(2)+" MB"},{key:"4",label:(0,D.jsx)(n.A,{title:r("pro.wasmMemoryTip"),children:(0,D.jsx)("div",{children:r("pro.wasmMemory")})}),children:(X.wasmMemory/1024/1024).toFixed(2)+" MB"},{key:"5",label:(0,D.jsx)(n.A,{title:r("pro.textureMemoryTip"),children:(0,D.jsx)("div",{children:r("pro.textureMemory")})}),children:(X.textureMemory/1024/1024).toFixed(2)+" MB"},{key:"6",label:(0,D.jsx)(n.A,{title:r("pro.fontMemoryTip"),children:(0,D.jsx)("div",{children:r("pro.fontMemory")})}),children:(X.fontMemory/1024/1024).toFixed(2)+" MB"},{key:"7",label:(0,D.jsx)(n.A,{title:r("pro.audioMemoryTip"),children:(0,D.jsx)("div",{children:r("pro.audioMemory")})}),children:(X.audioMemory/1024/1024).toFixed(2)+" MB"}],te={data:B.map((e,l)=>({time:B.length-l,value:1e3/X.targetFPS,category:"Base"})).concat(X.cpuTimePeeks.map((e,l)=>({time:X.cpuTimePeeks.length-l,value:e,category:"CPU"}))).concat(X.gpuTimePeeks.map((e,l)=>({time:X.gpuTimePeeks.length-l,value:e,category:"GPU"}))).concat(X.deltaTimePeeks.map((e,l)=>({time:X.deltaTimePeeks.length-l,value:e,category:"Delta"}))),xField:"time",yField:"value",legend:{size:!1},colorField:"category",title:{title:r("pro.frameTimePeaks"),style:{titleFontSize:14,titleFill:g.Q1.TextPrimary}},autoFit:!0,theme:"classicDark",animate:!1,tooltip:!1,marginLeft:0,marginRight:10};let e=0;for(const l of X.updateCosts)e+=l.value;oe={data:X.updateCosts.filter(e=>e.value>0).map(l=>({type:l.name,value:Math.round(100*l.value/e)})),angleField:"value",colorField:"type",label:{text:"value",style:{fontWeight:"bold"}},legend:{color:{title:!1,position:"top",rowPadding:5}},title:{title:r("pro.cpuTimePercent"),style:{titleFontSize:14,titleFill:g.Q1.TextPrimary}},innerRadius:.5,autoFit:!0,theme:"classicDark",animate:!1,tooltip:!1,marginLeft:0,marginRight:10},de=(null!==(ne=null===(ae=X.loaderCosts)||void 0===ae?void 0:ae.filter(e=>0===e.depth).reduce((e,l)=>e+l.time,0))&&void 0!==ne?ne:0)/1e3}else ee=[],le=[],re=[],ie=[];const se=.3*e.height;return(0,D.jsx)(g.HK,{children:(0,D.jsxs)(a.A,{maxWidth:"lg",fullWidth:!0,keepMounted:!0,open:null!==e.openName,"aria-labelledby":"logview-dialog-title","aria-describedby":"logview-dialog-description",transitionDuration:0,slotProps:{transition:G},children:[(0,D.jsxs)(s.A,{style:{overflow:"hidden",margin:0,padding:0},children:[(0,D.jsxs)("div",{hidden:!K,children:[(0,D.jsx)(c.A,{sx:{width:"100%",height:e.height-se-1,background:g.Q1.BackgroundDark},children:(0,D.jsx)(A.Ay,{theme:{algorithm:[T.A.darkAlgorithm,T.A.compactAlgorithm],components:{Radio:{colorPrimary:g.Q1.Theme+"aa"},Checkbox:{colorPrimary:g.Q1.Theme+"aa",colorPrimaryHover:g.Q1.Theme}}},children:(0,D.jsx)(S.K9,{skin:"dark",style:{width:"100%",height:"100%"},children:(0,D.jsxs)("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap",width:"100%",height:"100%",padding:10},children:[(0,D.jsx)("div",{style:{padding:5,width:"25%",minHeight:400},children:(0,D.jsx)(b.A,{title:r("pro.basic"),layout:"vertical",bordered:!0,items:ee,size:"small"})}),(0,D.jsxs)("div",{style:{padding:5,width:"25%",height:290},children:[(0,D.jsx)(b.A,{title:r("pro.time"),layout:"vertical",bordered:!0,items:le,size:"small"}),te?(0,D.jsx)(P.A,(0,i.A)({},te)):null]}),(0,D.jsxs)("div",{style:{padding:5,width:"25%",height:290},children:[(0,D.jsx)(b.A,{title:r("pro.object"),layout:"vertical",bordered:!0,items:re,size:"small"}),oe?(0,D.jsx)(w.A,(0,i.A)({},oe)):null]}),(0,D.jsx)("div",{style:{padding:5,width:"25%",minHeight:290},children:(0,D.jsx)(b.A,{title:r("pro.memory"),layout:"vertical",bordered:!0,items:ie,size:"small"})}),(0,D.jsxs)("div",{style:{padding:5,width:"50%",minHeight:290},children:[(0,D.jsxs)(F.A,{children:[r("pro.loaderTimeCosts")," (",de.toFixed(4)," s)"]}),(0,D.jsx)(C.A,{bordered:!0,dataSource:null===X||void 0===X||null===(l=X.loaderCosts)||void 0===l?void 0:l.map(e=>({key:e.order,order:e.order,time:e.time,depth:e.depth,moduleName:e.moduleName})),columns:V})]})]})})})}),(0,D.jsx)(g.wv,{})]}),(0,D.jsx)(t.LazyLog,{height:K?se:e.height,text:Q,style:{msOverflowStyle:"none",scrollbarWidth:"none",WebkitScrollSnapType:"none",fontSize:18,fontFamily:"Roboto,Helvetica,Arial,sans-serif",color:g.Q1.TextSecondary,background:g.Q1.BackgroundDark},formatPart:L,rowHeight:22,extraLines:1,selectableLines:!0,enableSearch:!0,caseInsensitive:!0,stream:!0,follow:!0}),(0,D.jsxs)("div",{style:{position:"absolute",bottom:10,right:10,opacity:.5,display:"flex",alignItems:"center"},children:[(0,D.jsx)("p",{style:{fontSize:14,marginRight:10,color:g.Q1.Secondary},children:e.openName}),(0,D.jsx)(h.A,{color:"secondary","aria-label":"toggle-profiler",onClick:()=>{o.G5({code:"Director.profilerSending = ".concat(K?"false":"true"),log:!1}).then(()=>{E(!K)}).catch(e=>{console.error(e)})},sx:{width:40,height:40},children:K?(0,D.jsx)(j.uFL,{}):(0,D.jsx)(v.A,{})})]})]}),(0,D.jsxs)(p.A,{children:[(0,D.jsx)("form",{noValidate:!0,autoComplete:"off",style:{width:"100%"},onSubmit:e=>{e.preventDefault(),""!==O&&(H(e=>{const l=[...e,O];return l.length>20?l.slice(-20):l}),N(R.length>=20?20:R.length+1),W(""),o.G5({code:O,log:!0}).then().catch(e=>{console.error(e)}))},children:(0,D.jsx)(x.A,{fullWidth:!0,sx:{paddingRight:3,"& .MuiOutlinedInput-notchedOutline":{borderColor:g.Q1.Secondary}},children:(0,D.jsx)(u.A,{label:r("log.command"),id:"commandline",value:O,onChange:e=>W(e.target.value),onKeyDown:e=>{if("ArrowUp"===e.key||"ArrowDown"===e.key){e.preventDefault();let l=I;"ArrowUp"===e.key?l=l>0?l-1:0:"ArrowDown"===e.key&&(l=l<R.length-1?l+1:R.length-1),l>=0&&l<R.length?(W(R[l]),N(l)):l===R.length&&(W(""),N(l))}}})})}),(0,D.jsx)(m.A,{onClick:async()=>{try{const e=await o.ss();if(e.success){const l=e.path,r=new XMLHttpRequest;r.open("GET",o.c2("/"+l),!0),r.responseType="text",r.onload=function(){o.Ux(),o.SX(r.response)},r.send()}}catch(e){console.error(e)}},children:r("action.reload")}),(0,D.jsx)(m.A,{onClick:()=>{o.Ux()},children:r("action.clear")}),(0,D.jsx)(m.A,{onClick:e.onClose,style:{marginRight:20},children:r("action.close")})]})]})})})}}]);