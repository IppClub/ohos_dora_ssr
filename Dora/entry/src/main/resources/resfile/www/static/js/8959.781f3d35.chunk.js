(self.webpackChunkdora_dora=self.webpackChunkdora_dora||[]).push([[8959],{3484:()=>{},18641:()=>{},26031:(e,t,n)=>{"use strict";n.d(t,{addDiagnosticToLog:()=>Ca,getDeclarationFile:()=>Ka,getDiagnosticMessage:()=>Pa,revalidateModel:()=>Ia,setModelMarkers:()=>Ma,transpileTypescript:()=>Fa});var r=n(20503),i=n(90841),s=n(89379),o=n(86292),a=n(84765);function c(e){return Array.isArray(e)?e:[e]}const u=(e,t)=>e.flatMap((e,n)=>0===n?[e]:[t,e]),l=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return[...new Set(...t)]},p=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return l(e).filter(e=>n.every(t=>t.includes(e)))};let d=1e5;const f=e=>((e,t)=>Object.assign(function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(0,s.A)({file:void 0,start:void 0,length:void 0,category:i.DiagnosticCategory.Error,code:e,source:"typescript-to-lua"},t(...r))},{code:e}))(d++,e),m=e=>e.replace(/\\/g,"/"),h=e=>e.slice(0,-o.default.extname(e).length);function g(e){return e=e.replace(/\.json$/,""),"Windows"===a.A.platform&&(e=e.replace(/\.\\/g,"").replace(/\\/g,".")),e.replace(/\.\//g,"").replace(/\//g,".")}function y(e,t,n){return e.has(t)||e.set(t,n()),e.get(t)}function S(e){return null!=e}function x(e,t){if(t(e))return e;throw new Error("Failed to cast value to expected type using ".concat(t.name,"."))}function T(e,t){}function v(e){throw new Error("Value is expected to be never")}const E=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.DiagnosticCategory.Error;return f(function(){return{messageText:e(...arguments),category:t}})},b=E((e,t)=>"Could not resolve lua source files for require path '".concat(e,"' in file ").concat(t,".")),A=E(e=>"Could not read content of resolved dependency ".concat(e,".")),_=(E((e,t)=>'To load "'.concat(t,'" ').concat(e,' it should be transpiled or "ts-node" should be installed.')),E((e,t,n)=>'Could not resolve "'.concat(t,'" ').concat(e,' from "').concat(n,'".')),E((e,t,n)=>'"'.concat(t,'" ').concat(e,' should have a "').concat(n,'" export.')),E(e=>'"'.concat(e,'" transformer should be a ts.TransformerFactory or an object with ts.TransformerFactory values.')),E(e=>"Could not find bundle entry point '".concat(e,"'. It should be a file in the project."))),k=E(()=>"'luaBundleEntry' is required when 'luaBundle' is enabled."),O=f(()=>({category:i.DiagnosticCategory.Warning,messageText:"Using 'luaBundle' with 'luaLibImport: \"inline\"' might generate duplicate code. It is recommended to use 'luaLibImport: \"require\"'."})),N=E(()=>'Cannot bundle projects with "buildmode": "library". Projects including the library can still bundle (which will include external library files).'),w=E(()=>'JSX is only supported with "react" jsx option.'),L=E(()=>"When configuring 'paths' in tsconfig.json, the option 'baseUrl' must also be provided.");let F=function(e){return e.None="none",e.Inline="inline",e.Require="require",e.RequireMinimal="require-minimal",e}({}),I=function(e){return e.Universal="universal",e.Lua50="5.0",e.Lua51="5.1",e.Lua52="5.2",e.Lua53="5.3",e.Lua54="5.4",e.LuaJIT="JIT",e.Luau="Luau",e}({}),M=function(e){return e.Default="default",e.Library="library",e}({});const P=e=>void 0!==e.luaBundle&&void 0!==e.luaBundleEntry;let C=function(e){return e[e.File=0]="File",e[e.Block=1]="Block",e[e.DoStatement=2]="DoStatement",e[e.VariableDeclarationStatement=3]="VariableDeclarationStatement",e[e.AssignmentStatement=4]="AssignmentStatement",e[e.IfStatement=5]="IfStatement",e[e.WhileStatement=6]="WhileStatement",e[e.RepeatStatement=7]="RepeatStatement",e[e.ForStatement=8]="ForStatement",e[e.ForInStatement=9]="ForInStatement",e[e.GotoStatement=10]="GotoStatement",e[e.LabelStatement=11]="LabelStatement",e[e.ReturnStatement=12]="ReturnStatement",e[e.BreakStatement=13]="BreakStatement",e[e.ContinueStatement=14]="ContinueStatement",e[e.ExpressionStatement=15]="ExpressionStatement",e[e.StringLiteral=16]="StringLiteral",e[e.NumericLiteral=17]="NumericLiteral",e[e.NilKeyword=18]="NilKeyword",e[e.DotsKeyword=19]="DotsKeyword",e[e.ArgKeyword=20]="ArgKeyword",e[e.TrueKeyword=21]="TrueKeyword",e[e.FalseKeyword=22]="FalseKeyword",e[e.FunctionExpression=23]="FunctionExpression",e[e.TableFieldExpression=24]="TableFieldExpression",e[e.TableExpression=25]="TableExpression",e[e.UnaryExpression=26]="UnaryExpression",e[e.BinaryExpression=27]="BinaryExpression",e[e.CallExpression=28]="CallExpression",e[e.MethodCallExpression=29]="MethodCallExpression",e[e.Identifier=30]="Identifier",e[e.TableIndexExpression=31]="TableIndexExpression",e[e.ParenthesizedExpression=32]="ParenthesizedExpression",e[e.ConditionalExpression=33]="ConditionalExpression",e[e.AdditionOperator=34]="AdditionOperator",e[e.SubtractionOperator=35]="SubtractionOperator",e[e.MultiplicationOperator=36]="MultiplicationOperator",e[e.DivisionOperator=37]="DivisionOperator",e[e.FloorDivisionOperator=38]="FloorDivisionOperator",e[e.ModuloOperator=39]="ModuloOperator",e[e.PowerOperator=40]="PowerOperator",e[e.NegationOperator=41]="NegationOperator",e[e.ConcatOperator=42]="ConcatOperator",e[e.LengthOperator=43]="LengthOperator",e[e.EqualityOperator=44]="EqualityOperator",e[e.InequalityOperator=45]="InequalityOperator",e[e.LessThanOperator=46]="LessThanOperator",e[e.LessEqualOperator=47]="LessEqualOperator",e[e.GreaterThanOperator=48]="GreaterThanOperator",e[e.GreaterEqualOperator=49]="GreaterEqualOperator",e[e.AndOperator=50]="AndOperator",e[e.OrOperator=51]="OrOperator",e[e.NotOperator=52]="NotOperator",e[e.BitwiseAndOperator=53]="BitwiseAndOperator",e[e.BitwiseOrOperator=54]="BitwiseOrOperator",e[e.BitwiseExclusiveOrOperator=55]="BitwiseExclusiveOrOperator",e[e.BitwiseRightShiftOperator=56]="BitwiseRightShiftOperator",e[e.BitwiseLeftShiftOperator=57]="BitwiseLeftShiftOperator",e[e.BitwiseNotOperator=58]="BitwiseNotOperator",e}({}),D=function(e){return e[e.None=0]="None",e[e.Inline=1]="Inline",e[e.Declaration=2]="Declaration",e[e.TableUnpackCall=4]="TableUnpackCall",e}({});function K(e,t){if(void 0===t)return{kind:e,flags:D.None};const n=R(t);return n?{kind:e,line:n.line,column:n.column,flags:D.None}:{kind:e,flags:D.None}}function B(e,t){return e.line=t.line,e.column=t.column,e}function R(e){var t;const n=null!==(t=i.getParseTreeNode(e))&&void 0!==t?t:e,r=n.getSourceFile();if(void 0!==r&&n.pos>=0){const{line:e,character:t}=i.getLineAndCharacterOfPosition(r,n.pos+n.getLeadingTriviaWidth());return{line:e,column:t}}}function j(e){return{line:e.line,column:e.column}}function V(e,t){return e.flags=t,e}function W(e,t){const n=K(C.Block,t);return n.statements=e,n}function q(e,t){const n=K(C.DoStatement,t);return n.statements=e,n}function G(e){return e.kind===C.VariableDeclarationStatement}function U(e,t,n){const r=K(C.VariableDeclarationStatement,n);return r.left=c(e),t&&(r.right=c(t)),r}function z(e,t,n){const r=K(C.AssignmentStatement,n);return r.left=c(e),r.right=t?c(t):[],r}function H(e,t,n,r){const i=K(C.IfStatement,r);return i.condition=e,i.ifBlock=t,i.elseBlock=n,i}function J(e,t,n){const r=K(C.WhileStatement,n);return r.body=e,r.condition=t,r}function Q(e,t,n){const r=K(C.RepeatStatement,n);return r.body=e,r.condition=t,r}function $(e,t,n,r){const i=K(C.ForInStatement,r);return i.body=e,i.names=t,i.expressions=n,i}function Y(e,t){const n=K(C.LabelStatement,t);return n.name=e,n}function Z(e){return e.kind===C.ReturnStatement}function X(e,t){const n=K(C.ReturnStatement,t);return n.expressions=e,n}function ee(e){return e.kind===C.BreakStatement}function te(e){return K(C.BreakStatement,e)}function ne(e,t){const n=K(C.ExpressionStatement,t);return n.expression=e,n}function re(e){return e.kind===C.NilKeyword}function ie(e){return K(C.NilKeyword,e)}function se(e,t){return K(e?C.TrueKeyword:C.FalseKeyword,t)}function oe(e){return e.kind===C.DotsKeyword}function ae(e){return K(C.DotsKeyword,e)}function ce(e){return K(C.ArgKeyword,e)}function ue(e){return e.kind===C.NumericLiteral}function le(e,t){const n=K(C.NumericLiteral,t);return n.value=e,n}function pe(e){return e.kind===C.StringLiteral}function de(e,t){const n=K(C.StringLiteral,t);return n.value=e,n}function fe(e){return re(e)||oe(e)||function(e){return e.kind===C.ArgKeyword}(e)||function(e){return e.kind===C.TrueKeyword||e.kind===C.FalseKeyword}(e)||ue(e)||pe(e)}function me(e){return e.kind===C.FunctionExpression}function he(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:D.None,i=arguments.length>4?arguments[4]:void 0;const s=K(C.FunctionExpression,i);return s.body=e,s.params=t,s.dots=n,s.flags=r,s}function ge(e){return e.kind===C.TableFieldExpression}function ye(e,t,n){const r=K(C.TableFieldExpression,n);return r.value=e,r.key=t,r}function Se(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;const n=K(C.TableExpression,t);return n.fields=e,n}function xe(e){return e.kind===C.UnaryExpression}function Te(e,t,n){const r=K(C.UnaryExpression,n);return r.operand=e,r.operator=t,r}function ve(e){return e.kind===C.BinaryExpression}function Ee(e,t,n,r){const i=K(C.BinaryExpression,r);return i.left=e,i.right=t,i.operator=n,i}function be(e){return e.kind===C.CallExpression}function Ae(e,t,n){const r=K(C.CallExpression,n);return r.expression=e,r.params=t,r}function _e(e){return e.kind===C.Identifier}function ke(e,t,n,r){const i=K(C.Identifier,t);return i.exportable=!0,i.text=e,i.symbolId=n,i.originalName=r,i}function Oe(e,t){return ke(e.text,t,e.symbolId,e.originalName)}function Ne(e){const t=K(C.Identifier,e);return t.exportable=!1,t.text="____",t}function we(e){return e.kind===C.TableIndexExpression}function Le(e,t,n){const r=K(C.TableIndexExpression,n);return r.table=e,r.index=t,r}function Fe(e){return _e(e)||we(e)}function Ie(e){var t;return 1===e.left.length&&1===(null===(t=e.right)||void 0===t?void 0:t.length)&&me(e.right[0])}function Me(e,t){const n=K(C.ParenthesizedExpression,t);return n.expression=e,n}const Pe=JSON.parse('{"ArrayAt":{"exports":["__TS__ArrayAt"]},"ArrayConcat":{"exports":["__TS__ArrayConcat"],"dependencies":["ArrayIsArray"]},"ArrayEntries":{"exports":["__TS__ArrayEntries"],"dependencies":["Symbol"]},"ArrayEvery":{"exports":["__TS__ArrayEvery"]},"ArrayFill":{"exports":["__TS__ArrayFill"]},"ArrayFilter":{"exports":["__TS__ArrayFilter"]},"ArrayForEach":{"exports":["__TS__ArrayForEach"]},"ArrayFind":{"exports":["__TS__ArrayFind"]},"ArrayFindIndex":{"exports":["__TS__ArrayFindIndex"]},"ArrayFrom":{"exports":["__TS__ArrayFrom"],"dependencies":["Iterator"]},"ArrayIncludes":{"exports":["__TS__ArrayIncludes"]},"ArrayIndexOf":{"exports":["__TS__ArrayIndexOf"]},"ArrayIsArray":{"exports":["__TS__ArrayIsArray"]},"ArrayJoin":{"exports":["__TS__ArrayJoin"]},"ArrayMap":{"exports":["__TS__ArrayMap"]},"ArrayPush":{"exports":["__TS__ArrayPush"]},"ArrayPushArray":{"exports":["__TS__ArrayPushArray"]},"ArrayReduce":{"exports":["__TS__ArrayReduce"],"dependencies":["CountVarargs"]},"ArrayReduceRight":{"exports":["__TS__ArrayReduceRight"],"dependencies":["CountVarargs"]},"ArrayReverse":{"exports":["__TS__ArrayReverse"]},"ArrayUnshift":{"exports":["__TS__ArrayUnshift"]},"ArraySort":{"exports":["__TS__ArraySort"]},"ArraySlice":{"exports":["__TS__ArraySlice"]},"ArraySome":{"exports":["__TS__ArraySome"]},"ArraySplice":{"exports":["__TS__ArraySplice"],"dependencies":["CountVarargs"]},"ArrayToObject":{"exports":["__TS__ArrayToObject"]},"ArrayFlat":{"exports":["__TS__ArrayFlat"],"dependencies":["ArrayIsArray","ArrayFlat"]},"ArrayFlatMap":{"exports":["__TS__ArrayFlatMap"],"dependencies":["ArrayIsArray"]},"ArraySetLength":{"exports":["__TS__ArraySetLength"]},"ArrayToReversed":{"exports":["__TS__ArrayToReversed"],"dependencies":["Unpack","ArrayReverse"]},"ArrayToSorted":{"exports":["__TS__ArrayToSorted"],"dependencies":["Unpack","ArraySort"]},"ArrayToSpliced":{"exports":["__TS__ArrayToSpliced"],"dependencies":["Unpack","ArraySplice"]},"ArrayWith":{"exports":["__TS__ArrayWith"],"dependencies":["Unpack"]},"Await":{"exports":["__TS__AsyncAwaiter","__TS__Await"],"dependencies":["Promise","New"]},"Class":{"exports":["__TS__Class"]},"ClassExtends":{"exports":["__TS__ClassExtends"]},"CloneDescriptor":{"exports":["__TS__CloneDescriptor"]},"CountVarargs":{"exports":["__TS__CountVarargs"]},"Decorate":{"exports":["__TS__Decorate"]},"DecorateLegacy":{"exports":["__TS__DecorateLegacy"],"dependencies":["ObjectAssign","ObjectGetOwnPropertyDescriptor","SetDescriptor"]},"DecorateParam":{"exports":["__TS__DecorateParam"],"dependencies":["DecorateLegacy"]},"Delete":{"exports":["__TS__Delete"],"dependencies":["Error","New","ObjectGetOwnPropertyDescriptors"]},"DelegatedYield":{"exports":["__TS__DelegatedYield"],"dependencies":["StringAccess","Symbol"]},"DescriptorGet":{"exports":["__TS__DescriptorGet"]},"DescriptorSet":{"exports":["__TS__DescriptorSet"]},"Error":{"exports":["Error","RangeError","ReferenceError","SyntaxError","TypeError","URIError"],"dependencies":["StringIncludes","New","Error","Class","ClassExtends"]},"FunctionBind":{"exports":["__TS__FunctionBind"],"dependencies":["Unpack","ArrayUnshift"]},"Generator":{"exports":["__TS__Generator"],"dependencies":["Symbol","CountVarargs","Unpack"]},"InstanceOf":{"exports":["__TS__InstanceOf"],"dependencies":["Symbol"]},"InstanceOfObject":{"exports":["__TS__InstanceOfObject"]},"Iterator":{"exports":["__TS__Iterator"],"dependencies":["Symbol"]},"LuaIteratorSpread":{"exports":["__TS__LuaIteratorSpread"],"dependencies":["Unpack"]},"Map":{"exports":["Map"],"dependencies":["Class","Symbol","Iterator"]},"MapGroupBy":{"exports":["__TS__MapGroupBy"],"dependencies":["Map","New","Iterator"]},"Match":{"exports":["__TS__Match"]},"MathAtan2":{"exports":["__TS__MathAtan2"]},"MathModf":{"exports":["__TS__MathModf"]},"MathSign":{"exports":["__TS__MathSign"],"dependencies":["NumberIsNaN"]},"MathTrunc":{"exports":["__TS__MathTrunc"],"dependencies":["NumberIsFinite"]},"New":{"exports":["__TS__New"]},"Number":{"exports":["__TS__Number"]},"NumberIsFinite":{"exports":["__TS__NumberIsFinite"]},"NumberIsInteger":{"exports":["__TS__NumberIsInteger"],"dependencies":["NumberIsFinite"]},"NumberIsNaN":{"exports":["__TS__NumberIsNaN"]},"ParseInt":{"exports":["__TS__ParseInt"],"dependencies":["StringSubstring","Match"]},"ParseFloat":{"exports":["__TS__ParseFloat"],"dependencies":["StringAccess","Match"]},"NumberToString":{"exports":["__TS__NumberToString"],"dependencies":["StringAccess","MathModf"]},"NumberToFixed":{"exports":["__TS__NumberToFixed"]},"ObjectAssign":{"exports":["__TS__ObjectAssign"]},"ObjectDefineProperty":{"exports":["__TS__ObjectDefineProperty"],"dependencies":["SetDescriptor"]},"ObjectEntries":{"exports":["__TS__ObjectEntries"]},"ObjectFromEntries":{"exports":["__TS__ObjectFromEntries"],"dependencies":["Symbol"]},"ObjectGetOwnPropertyDescriptor":{"exports":["__TS__ObjectGetOwnPropertyDescriptor"]},"ObjectGetOwnPropertyDescriptors":{"exports":["__TS__ObjectGetOwnPropertyDescriptors"]},"ObjectGroupBy":{"exports":["__TS__ObjectGroupBy"],"dependencies":["Iterator"]},"ObjectKeys":{"exports":["__TS__ObjectKeys"]},"ObjectRest":{"exports":["__TS__ObjectRest"]},"ObjectValues":{"exports":["__TS__ObjectValues"]},"Promise":{"exports":["__TS__Promise"],"dependencies":["Promise","New","InstanceOf","Class"]},"PromiseAll":{"exports":["__TS__PromiseAll"],"dependencies":["InstanceOf","Promise","Iterator","New"]},"PromiseAllSettled":{"exports":["__TS__PromiseAllSettled"],"dependencies":["InstanceOf","Iterator","Promise","New"]},"PromiseAny":{"exports":["__TS__PromiseAny"],"dependencies":["InstanceOf","Promise","Iterator","New"]},"PromiseRace":{"exports":["__TS__PromiseRace"],"dependencies":["InstanceOf","Promise","Iterator","New"]},"Set":{"exports":["Set"],"dependencies":["Class","Symbol","Iterator","New"]},"SetDescriptor":{"exports":["__TS__SetDescriptor"],"dependencies":["CloneDescriptor","DescriptorGet","DescriptorSet"]},"SparseArrayNew":{"exports":["__TS__SparseArrayNew"],"dependencies":["CountVarargs"]},"SparseArrayPush":{"exports":["__TS__SparseArrayPush"],"dependencies":["CountVarargs"]},"SparseArraySpread":{"exports":["__TS__SparseArraySpread"]},"WeakMap":{"exports":["WeakMap"],"dependencies":["Class","Symbol"]},"WeakSet":{"exports":["WeakSet"],"dependencies":["Class","Symbol"]},"SourceMapTraceBack":{"exports":["__TS__SourceMapTraceBack"],"dependencies":["StringIncludes","Match"]},"Spread":{"exports":["__TS__Spread"],"dependencies":["StringAccess","Iterator","Unpack"]},"StringAccess":{"exports":["__TS__StringAccess"]},"StringCharAt":{"exports":["__TS__StringCharAt"]},"StringCharCodeAt":{"exports":["__TS__StringCharCodeAt"]},"StringEndsWith":{"exports":["__TS__StringEndsWith"]},"StringIncludes":{"exports":["__TS__StringIncludes"]},"StringPadEnd":{"exports":["__TS__StringPadEnd"]},"StringPadStart":{"exports":["__TS__StringPadStart"]},"StringReplace":{"exports":["__TS__StringReplace"]},"StringReplaceAll":{"exports":["__TS__StringReplaceAll"],"dependencies":["StringSplit"]},"StringSlice":{"exports":["__TS__StringSlice"]},"StringSplit":{"exports":["__TS__StringSplit"]},"StringStartsWith":{"exports":["__TS__StringStartsWith"]},"StringSubstr":{"exports":["__TS__StringSubstr"]},"StringSubstring":{"exports":["__TS__StringSubstring"]},"StringTrim":{"exports":["__TS__StringTrim"]},"StringTrimEnd":{"exports":["__TS__StringTrimEnd"]},"StringTrimStart":{"exports":["__TS__StringTrimStart"]},"Symbol":{"exports":["__TS__Symbol","Symbol"]},"SymbolRegistry":{"exports":["__TS__SymbolRegistryFor","__TS__SymbolRegistryKeyFor"],"dependencies":["Symbol"]},"TypeOf":{"exports":["__TS__TypeOf"]},"Unpack":{"exports":["__TS__Unpack"]},"Using":{"exports":["__TS__Using"],"dependencies":["Unpack","Symbol"]},"UsingAsync":{"exports":["__TS__UsingAsync"],"dependencies":["Unpack","Symbol","Await"]}}');let Ce=function(e){return e.ArrayAt="ArrayAt",e.ArrayConcat="ArrayConcat",e.ArrayEntries="ArrayEntries",e.ArrayEvery="ArrayEvery",e.ArrayFill="ArrayFill",e.ArrayFilter="ArrayFilter",e.ArrayForEach="ArrayForEach",e.ArrayFind="ArrayFind",e.ArrayFindIndex="ArrayFindIndex",e.ArrayFrom="ArrayFrom",e.ArrayIncludes="ArrayIncludes",e.ArrayIndexOf="ArrayIndexOf",e.ArrayIsArray="ArrayIsArray",e.ArrayJoin="ArrayJoin",e.ArrayMap="ArrayMap",e.ArrayPush="ArrayPush",e.ArrayPushArray="ArrayPushArray",e.ArrayReduce="ArrayReduce",e.ArrayReduceRight="ArrayReduceRight",e.ArrayReverse="ArrayReverse",e.ArrayUnshift="ArrayUnshift",e.ArraySort="ArraySort",e.ArraySlice="ArraySlice",e.ArraySome="ArraySome",e.ArraySplice="ArraySplice",e.ArrayToObject="ArrayToObject",e.ArrayFlat="ArrayFlat",e.ArrayFlatMap="ArrayFlatMap",e.ArraySetLength="ArraySetLength",e.ArrayToReversed="ArrayToReversed",e.ArrayToSorted="ArrayToSorted",e.ArrayToSpliced="ArrayToSpliced",e.ArrayWith="ArrayWith",e.Await="Await",e.Class="Class",e.ClassExtends="ClassExtends",e.CloneDescriptor="CloneDescriptor",e.CountVarargs="CountVarargs",e.Decorate="Decorate",e.DecorateLegacy="DecorateLegacy",e.DecorateParam="DecorateParam",e.Delete="Delete",e.DelegatedYield="DelegatedYield",e.DescriptorGet="DescriptorGet",e.DescriptorSet="DescriptorSet",e.Error="Error",e.FunctionBind="FunctionBind",e.Generator="Generator",e.InstanceOf="InstanceOf",e.InstanceOfObject="InstanceOfObject",e.Iterator="Iterator",e.LuaIteratorSpread="LuaIteratorSpread",e.Map="Map",e.MapGroupBy="MapGroupBy",e.Match="Match",e.MathAtan2="MathAtan2",e.MathModf="MathModf",e.MathSign="MathSign",e.MathTrunc="MathTrunc",e.New="New",e.Number="Number",e.NumberIsFinite="NumberIsFinite",e.NumberIsInteger="NumberIsInteger",e.NumberIsNaN="NumberIsNaN",e.NumberParseInt="ParseInt",e.NumberParseFloat="ParseFloat",e.NumberToString="NumberToString",e.NumberToFixed="NumberToFixed",e.ObjectAssign="ObjectAssign",e.ObjectDefineProperty="ObjectDefineProperty",e.ObjectEntries="ObjectEntries",e.ObjectFromEntries="ObjectFromEntries",e.ObjectGetOwnPropertyDescriptor="ObjectGetOwnPropertyDescriptor",e.ObjectGetOwnPropertyDescriptors="ObjectGetOwnPropertyDescriptors",e.ObjectGroupBy="ObjectGroupBy",e.ObjectKeys="ObjectKeys",e.ObjectRest="ObjectRest",e.ObjectValues="ObjectValues",e.ParseFloat="ParseFloat",e.ParseInt="ParseInt",e.Promise="Promise",e.PromiseAll="PromiseAll",e.PromiseAllSettled="PromiseAllSettled",e.PromiseAny="PromiseAny",e.PromiseRace="PromiseRace",e.Set="Set",e.SetDescriptor="SetDescriptor",e.SparseArrayNew="SparseArrayNew",e.SparseArrayPush="SparseArrayPush",e.SparseArraySpread="SparseArraySpread",e.WeakMap="WeakMap",e.WeakSet="WeakSet",e.SourceMapTraceBack="SourceMapTraceBack",e.Spread="Spread",e.StringAccess="StringAccess",e.StringCharAt="StringCharAt",e.StringCharCodeAt="StringCharCodeAt",e.StringEndsWith="StringEndsWith",e.StringIncludes="StringIncludes",e.StringPadEnd="StringPadEnd",e.StringPadStart="StringPadStart",e.StringReplace="StringReplace",e.StringReplaceAll="StringReplaceAll",e.StringSlice="StringSlice",e.StringSplit="StringSplit",e.StringStartsWith="StringStartsWith",e.StringSubstr="StringSubstr",e.StringSubstring="StringSubstring",e.StringTrim="StringTrim",e.StringTrimEnd="StringTrimEnd",e.StringTrimStart="StringTrimStart",e.Symbol="Symbol",e.SymbolRegistry="SymbolRegistry",e.TypeOf="TypeOf",e.Unpack="Unpack",e.Using="Using",e.UsingAsync="UsingAsync",e}({});function De(e){const t=e===I.Lua50?"5.0":"universal";return o.default.resolve("/",o.default.join("/","dist","lualib",t))}const Ke=new Map;function Be(e){return Ke.has(e)||Ke.set(e,Pe),Ke.get(e)}const Re=new Map;const je=new Map;function Ve(e,t,n){return function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Be(t);const i=new Set,s=[];function o(e){var t;if(i.has(e))return;i.add(e);const n=null===(t=r[e])||void 0===t?void 0:t.dependencies;n&&n.forEach(o),s.push(e)}for(const a of e)o(a);return s}(e,t,n).map(e=>function(e,t,n){const r=y(je,t,()=>new Map);if(!r.has(e)){const i=o.default.join(De(t),"".concat(e,".lua")),s=n.readFile(i);if(void 0===s)throw new Error("Could not load lualib feature from '".concat(i,"'"));r.set(e,s)}return r.get(e)}(e,t,n)).join("\n")}const We=new Map;function qe(e,t,n){const r=new Set,i=function(e){if(!Re.has(e)){const t=Be(e),n=new Map;for(const[e,r]of Object.entries(t))for(const t of r.exports)n.set(t,e);Re.set(e,n)}return Re.get(e)}(e);for(const s of n){const e=/^local (\w+) = ____lualib\.(\w+)$/gm;for(;;){const t=e.exec(s);if(!t)break;const[,n,o]=t;if(n!==o)continue;const a=i.get(o);a&&r.add(a)}}return r}var Ge=n(89823);const Ue=(e,t)=>f(function(n){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return{file:i.getOriginalNode(n).getSourceFile(),start:i.getOriginalNode(n).getStart(),length:i.getOriginalNode(n).getWidth(),messageText:"string"===typeof t?t:t(...s),category:e}}),ze=e=>Ue(i.DiagnosticCategory.Error,e),He=e=>Ue(i.DiagnosticCategory.Warning,e),Je=ze(e=>"Unsupported node kind ".concat(i.SyntaxKind[e])),Qe=ze("Iterating over arrays with 'for ... in' is not allowed."),$e=ze(e=>{const t=e?" '".concat(e,"'"):"";return"Unable to convert function with a 'this' parameter to function".concat(t," with no 'this'. ")+"To fix, wrap in an arrow function, or declare with 'this: void'."}),Ye=ze(e=>{const t=e?" '".concat(e,"'"):"";return"Unable to convert function with no 'this' parameter to function".concat(t," with 'this'. ")+"To fix, wrap in an arrow function, or declare with 'this: any'."}),Ze=ze(e=>{const t=e?" to '".concat(e,"'"):"";return"Unsupported assignment of function with different overloaded types for 'this'".concat(t,". ")+"Overloads should all have the same type for 'this'."}),Xe=ze("Decorator function cannot have 'this: void'."),et=ze((e,t,n)=>"'@".concat(e,"' expects ").concat(n," arguments, but got ").concat(t,".")),tt=ze("$range can only be used in a for...of loop."),nt=ze("$vararg can only be used in a spread element ('...$vararg') in global scope."),rt=ze("For loop using $range must declare a single control variable."),it=ze("LuaIterable with a LuaMultiReturn return value type must be destructured."),st=ze("LuaPairsIterable type must be destructured in a for...of statement."),ot=ze("Accessors in object literal are not supported."),at=ze("Right shift operator is not supported for target Lua 5.3. Use `>>>` instead."),ct=e=>e===I.LuaJIT?"LuaJIT":"Lua ".concat(e),ut=ze((e,t)=>"".concat(e," is/are not supported for target ").concat(ct(t),".")),lt=ze((e,t,n)=>"As a precaution, ".concat(e," is/are not supported for target ").concat(ct(t)," due to language features/limitations. ")+'However "--'.concat(n,'" can be used to bypass this precaution. ')+"See https://typescripttolua.github.io/docs/configuration for more information."),pt=ze((e,t)=>"".concat(e,".").concat(t," is unsupported.")),dt=ze(e=>"Invalid ambient identifier name '".concat(e,"'. Ambient identifiers must be valid lua identifiers.")),ft=ze("`var` declarations are not supported. Use `let` or `const` instead."),mt=ze("The $multi function must be called in a return statement."),ht=ze("The $multi function cannot be cast to a non-LuaMultiReturn type."),gt=ze("The LuaMultiReturn type can only be accessed via an element access expression of a numeric type."),yt=ze("This function must be called directly and cannot be referred to."),St=(He(e=>"'@".concat(e,"' is deprecated and will be removed in a future update. Please update your code before upgrading to the next release, otherwise your project will no longer compile. ")+"See https://typescripttolua.github.io/docs/advanced/compiler-annotations#".concat(e.toLowerCase()," for more information.")),He("Only false and nil evaluate to 'false' in Lua, everything else is considered 'true'. Explicitly compare the value with ===.")),xt=ze("The left-hand side of an assignment expression may not be an optional property access."),Tt=ze("Await can only be used inside async functions."),vt=ze("Optional calls are not supported for builtin or language extension functions."),Et=ze("Optional calls are not supported on enums marked with @compileMembersOnly."),bt=ze("Array literals may not contain undefined or null."),At=ze("This language extension must be called as a method."),_t=ze("Spread elements are not supported in call extensions."),kt=ze(e=>"Cannot create assignment assigning to a node of type ".concat(C[e],".")),Ot=He("You are using a class field decorator, note that tstl ignores returned value initializers!"),Nt=ze("Constructing new Array with length is not supported."),wt=ze(e=>"Relative path imports (like '".concat(e,"') are not supported. Please use the Lua style module path instead."));let Lt=function(e){return e.MultiFunction="MultiFunction",e.RangeFunction="RangeFunction",e.VarargConstant="VarargConstant",e.AdditionOperatorType="Addition",e.AdditionOperatorMethodType="AdditionMethod",e.SubtractionOperatorType="Subtraction",e.SubtractionOperatorMethodType="SubtractionMethod",e.MultiplicationOperatorType="Multiplication",e.MultiplicationOperatorMethodType="MultiplicationMethod",e.DivisionOperatorType="Division",e.DivisionOperatorMethodType="DivisionMethod",e.ModuloOperatorType="Modulo",e.ModuloOperatorMethodType="ModuloMethod",e.PowerOperatorType="Power",e.PowerOperatorMethodType="PowerMethod",e.FloorDivisionOperatorType="FloorDivision",e.FloorDivisionOperatorMethodType="FloorDivisionMethod",e.BitwiseAndOperatorType="BitwiseAnd",e.BitwiseAndOperatorMethodType="BitwiseAndMethod",e.BitwiseOrOperatorType="BitwiseOr",e.BitwiseOrOperatorMethodType="BitwiseOrMethod",e.BitwiseExclusiveOrOperatorType="BitwiseExclusiveOr",e.BitwiseExclusiveOrOperatorMethodType="BitwiseExclusiveOrMethod",e.BitwiseLeftShiftOperatorType="BitwiseLeftShift",e.BitwiseLeftShiftOperatorMethodType="BitwiseLeftShiftMethod",e.BitwiseRightShiftOperatorType="BitwiseRightShift",e.BitwiseRightShiftOperatorMethodType="BitwiseRightShiftMethod",e.ConcatOperatorType="Concat",e.ConcatOperatorMethodType="ConcatMethod",e.LessThanOperatorType="LessThan",e.LessThanOperatorMethodType="LessThanMethod",e.GreaterThanOperatorType="GreaterThan",e.GreaterThanOperatorMethodType="GreaterThanMethod",e.NegationOperatorType="Negation",e.NegationOperatorMethodType="NegationMethod",e.BitwiseNotOperatorType="BitwiseNot",e.BitwiseNotOperatorMethodType="BitwiseNotMethod",e.LengthOperatorType="Length",e.LengthOperatorMethodType="LengthMethod",e.TableNewType="TableNew",e.TableDeleteType="TableDelete",e.TableDeleteMethodType="TableDeleteMethod",e.TableGetType="TableGet",e.TableGetMethodType="TableGetMethod",e.TableHasType="TableHas",e.TableHasMethodType="TableHasMethod",e.TableSetType="TableSet",e.TableSetMethodType="TableSetMethod",e.TableAddKeyType="TableAddKey",e.TableAddKeyMethodType="TableAddKeyMethod",e.TableIsEmptyType="TableIsEmpty",e.TableIsEmptyMethodType="TableIsEmptyMethod",e}({});const Ft=new Set(Object.values(Lt));function It(e,t){const n=Pt(e,t,"__tstlExtension");if(n&&Ft.has(n))return n}const Mt=262143|i.TypeFlags.Index|i.TypeFlags.NonPrimitive;function Pt(e,t,n){if(t.flags&Mt)return;const r=t.getProperty(n);if(!r)return;const i=e.checker.getTypeOfSymbolAtLocation(r,e.sourceFile);return i.isStringLiteral()?i.value:void 0}function Ct(e,t){const n=i.getOriginalNode(t);let r=e.checker.getTypeAtLocation(n);return i.isOptionalChain(n)&&(r=e.checker.getNonNullableType(r)),It(e,r)}function Dt(e,t){const n=e.checker.getTypeOfSymbolAtLocation(t,e.sourceFile);return It(e,n)}let Kt=function(e){return e.Iterable="Iterable",e.Pairs="Pairs",e.PairsKey="PairsKey",e}({});function Bt(e,t){const n=e.checker.getTypeAtLocation(t);return function(e,t){const n=Pt(e,t,"__tstlIterable");if(n&&n in Kt)return n}(e,n)}const Rt=new Set(Object.values(Lt).filter(e=>e.endsWith("Method")));function jt(e,t,n,r){let s;if(!t.arguments.some(i.isSpreadElement)){if(Rt.has(n)){if(!i.isPropertyAccessExpression(t.expression)&&!i.isElementAccessExpression(t.expression))return void e.diagnostics.push(At(t));if(t.arguments.length<r-1)return;s=[t.expression.expression,...t.arguments]}else{if(t.arguments.length<r)return;s=t.arguments}return s}e.diagnostics.push(_t(t))}function Vt(e,t,n){var r;return null===(r=jt(e,t,n,1))||void 0===r?void 0:r[0]}function Wt(e,t,n){const r=jt(e,t,n,2);if(void 0!==r)return[r[0],r[1]]}function qt(e,t){e.usedLuaLibFeatures.add(t)}function Gt(e,t,n){qt(e,t);const r=ke("__TS__".concat(t));for(var i=arguments.length,s=new Array(i>3?i-3:0),o=3;o<i;o++)s[o-3]=arguments[o];return Ae(r,s,n)}function Ut(e){return i.isObjectLiteralExpression(e)||i.isArrayLiteralExpression(e)}function zt(e){return i.isBinaryExpression(e)&&e.operatorToken.kind===i.SyntaxKind.EqualsToken&&Ut(e.left)}function Ht(e){const t=an(e,i.isFunctionLike);return!!t&&(!!i.canHaveModifiers(t)&&(null!==(n=null===(r=i.getModifiers(t))||void 0===r?void 0:r.some(e=>e.kind===i.SyntaxKind.AsyncKeyword))&&void 0!==n&&n));var n,r}function Jt(e,t,n){const r=e.checker.getBaseConstraintOfType(t);return r&&(t=r),!!(t.flags&n)||(t.isUnion()?t.types.every(t=>Jt(e,t,n)):!!t.isIntersection()&&t.types.some(t=>Jt(e,t,n)))}function Qt(e,t,n){const r=e.checker.getBaseConstraintOfType(t);if(r)t=r;else if(t.isTypeParameter())return!0;return!!(t.flags&n)||(t.isUnion()||!!t.isIntersection())&&t.types.some(t=>Qt(e,t,n))}function $t(e,t){return Jt(e,t,i.TypeFlags.StringLike)}function Yt(e,t){return Jt(e,t,i.TypeFlags.NumberLike)}function Zt(e,t){if(e.checker.isArrayType(t)||e.checker.isTupleType(t))return!0;if(t.isUnionOrIntersection()&&t.types.some(t=>Zt(e,t)))return!0;const n=t.getBaseTypes();if(n&&n.some(t=>Zt(e,t)))return!0;if(t.symbol){const n=e.checker.getBaseConstraintOfType(t);if(n&&n!==t)return Zt(e,n)}return!1}function Xt(e,t){if(e.checker.isArrayType(t)||e.checker.isTupleType(t))return!0;if(t.symbol){const n=e.checker.getBaseConstraintOfType(t);if(n&&n!==t)return Xt(e,n)}return!!t.isUnionOrIntersection()&&t.types.every(t=>Xt(e,t))}function en(e,t,n){if(n(t))return!0;!t.isClassOrInterface()&&t.symbol&&(t=e.checker.getDeclaredTypeOfSymbol(t.symbol));const r=t.getBaseTypes();return!!r&&r.some(t=>en(e,t,n))}function tn(e,t){return en(e,t,t=>Zt(e,t))}function nn(e,t){return en(e,t,t=>Xt(e,t))}function rn(e){return e.getCallSignatures().length>0}function sn(e,t){if(!(!0===e.options.strict||!0===e.options.strictNullChecks)&&!t.isLiteral())return!0;return Qt(e,t,i.TypeFlags.Boolean|i.TypeFlags.BooleanLiteral|i.TypeFlags.Never|i.TypeFlags.Void|i.TypeFlags.Unknown|i.TypeFlags.Any|i.TypeFlags.Undefined|i.TypeFlags.Null)}function on(e,t){return Qt(e,t,i.TypeFlags.Boolean|i.TypeFlags.BooleanLiteral|i.TypeFlags.Never|i.TypeFlags.Void|i.TypeFlags.Unknown|i.TypeFlags.Any)}function an(e,t){let n=e;for(;n.parent;){if(t(n.parent))return n.parent;n=n.parent}}function cn(e){let t=i.getOriginalNode(e).parent;for(;i.isOuterExpression(t);)t=i.getOriginalNode(t).parent;return t}function un(e){return!i.isExpressionStatement(cn(e))}function ln(e,t){var n;const r=(null!==(n=i.getParseTreeNode(t))&&void 0!==n?n:t).getSourceFile();return!!r&&("lib.Dora.d.ts"!==r.fileName&&"lua.d.ts"!==r.fileName&&e.program.isSourceFileDefaultLibrary(r))}function pn(e,t,n){const r=t.getSymbol();if(!r||(n?r.name!==n:"__type"===r.name))return!1;const i=r.valueDeclaration;return!i||ln(e,i)}function dn(e){return e.isUnion()?e.types.flatMap(dn):e.getCallSignatures()}function fn(e){return void 0!==e.getProperty("__tstlMultiReturn")}function mn(e){return 0!==(e.flags&i.TypeFlags.Any)||fn(e)||e.isUnion()&&e.types.some(e=>mn(e))}function hn(e,t){return function(e,t){return i.isIdentifier(t)&&"$multi"===t.text&&Ct(e,t)===Lt.MultiFunction}(e,t.expression)}function gn(e,t){const n=e.checker.getResolvedSignature(t),r=null===n||void 0===n?void 0:n.getReturnType();return!!r&&fn(r)}function yn(e,t){return i.isCallExpression(t)&&gn(e,t)}function Sn(e,t){const n=an(t,i.isFunctionLike);if(!n)return!1;const r=e.checker.getSignatureFromDeclaration(n),s=null===r||void 0===r?void 0:r.getReturnType();return!!s&&fn(s)}function xn(e,t){if(!gn(e,t))return!1;const n=cn(t);return(!i.isVariableDeclaration(n)||!i.isArrayBindingPattern(n.name))&&((!i.isBinaryExpression(n)||n.operatorToken.kind!==i.SyntaxKind.EqualsToken||!i.isArrayLiteralExpression(n.left))&&(!i.isSpreadElement(n)&&(!i.isExpressionStatement(n)&&((!i.isReturnStatement(n)&&!i.isArrowFunction(n)||!Sn(e,t))&&(!i.isElementAccessExpression(n)&&(!i.isForOfStatement(n)||Bt(e,t)!==Kt.Iterable))))))}function Tn(e,t){return"$vararg"===t.getName()&&Dt(e,t)===Lt.VarargConstant}function vn(e,t,n){var r;if(!i.isSpreadElement(cn(n)))return!1;const s=Nn(e,_n.Function|_n.Try|_n.Catch|_n.File);if(!s)return;if(function(e,t,n){return n.type===_n.File&&Tn(e,t)}(e,t,s))return!0;if(!function(e){return void 0!==e.node&&i.isFunctionLike(e.node)}(s))return!1;if(i.canHaveModifiers(s.node)&&null!==(r=i.getModifiers(s.node))&&void 0!==r&&r.some(e=>e.kind===i.SyntaxKind.AsyncKeyword))return!1;return!!s.node.parameters.some(n=>n.dotDotDotToken&&i.isIdentifier(n.name)&&e.checker.getSymbolAtLocation(n.name)===t)&&(!function(e,t,n){if(!t.referencedSymbols)return;for(const r of t.referencedSymbols.values())if(r.some(t=>e.checker.getSymbolAtLocation(t)===n))return!0;return!1}(e,s,t)&&!function(e,t){if(!t.referencedSymbols||!t.node)return!1;for(const[r,i]of t.referencedSymbols){var n;const s=e.checker.getTypeAtLocation(i[0]);if((null===(n=t.functionDefinitions)||void 0===n||!n.has(r))&&s.getCallSignatures().length>0&&Ln(s.symbol,t.node))return!0}return!1}(e,s))}function En(e,t){return e.symbolInfoMap.get(t)}function bn(e,t,n){let r=e.symbolIdMaps.get(t);return void 0===r&&(r=e.nextSymbolId(),e.symbolIdMaps.set(t,r),e.symbolInfoMap.set(r,{symbol:t,firstSeenAtPos:n.pos})),vn(e,t,n)||function(e,t,n){for(const i of e.scopeStack){var r;null!==(r=i.referencedSymbols)&&void 0!==r||(i.referencedSymbols=new Map);y(i.referencedSymbols,t,()=>[]).push(n)}}(e,r,n),r}function An(e,t,n){if(n)return bn(e,n,t)}let _n=function(e){return e[e.File=1]="File",e[e.Function=2]="Function",e[e.Switch=4]="Switch",e[e.Loop=8]="Loop",e[e.Conditional=16]="Conditional",e[e.Block=32]="Block",e[e.Try=64]="Try",e[e.Catch=128]="Catch",e[e.LoopInitializer=256]="LoopInitializer",e}({}),kn=function(e){return e[e.WithGoto=0]="WithGoto",e[e.WithRepeatBreak=1]="WithRepeatBreak",e[e.WithContinue=2]="WithContinue",e}({});function On(e){const t=e.scopeStack,n=t[t.length-1];return n}function Nn(e,t){for(let n=e.scopeStack.length-1;n>=0;--n){const r=e.scopeStack[n];if(t&r.type)return r}}function wn(e,t){var n;null!==(n=e.variableDeclarations)&&void 0!==n||(e.variableDeclarations=[]),e.variableDeclarations.push(t)}function Ln(e,t){var n;return null===e||void 0===e||null===(n=e.declarations)||void 0===n?void 0:n.some(e=>i.isFunctionDeclaration(e)&&an(e,e=>e===t))}function Fn(e,t){const n=On(e),r=[],i=[];let{unhoistedStatements:s,hoistedStatements:o,hoistedIdentifiers:a}=function(e,t,n){if(!t.functionDefinitions)return{unhoistedStatements:n,hoistedStatements:[],hoistedIdentifiers:[]};const r=[...n],i=[],s=[];for(const[o,a]of t.functionDefinitions)if(T(a.definition),Mn(e,o,t)){const e=r.indexOf(a.definition);if(e<0)continue;r.splice(e,1),G(a.definition)?(T(a.definition.right),s.push(...a.definition.left),i.push(z(a.definition.left,a.definition.right))):i.push(a.definition)}return{unhoistedStatements:r,hoistedStatements:i,hoistedIdentifiers:s}}(e,n,t);return r.push(...o),i.push(...a),({unhoistedStatements:s,hoistedIdentifiers:a}=function(e,t,n){if(!t.variableDeclarations)return{unhoistedStatements:n,hoistedIdentifiers:[]};const r=[...n],i=[];for(const s of t.variableDeclarations){if(s.left.map(e=>e.symbolId).filter(S).some(n=>Mn(e,n,t))){const e=r.indexOf(s);if(e<0)continue;if(s.right){const t=z(s.left,s.right);B(t,s),r.splice(e,1,t)}else r.splice(e,1);i.push(...s.left)}}return{unhoistedStatements:r,hoistedIdentifiers:i}}(e,n,s)),i.push(...a),({unhoistedStatements:s,hoistedStatements:o}=function(e,t){var n;return{unhoistedStatements:t,hoistedStatements:null!==(n=e.importStatements)&&void 0!==n?n:[]}}(n,s)),r.unshift(...o),{statements:s,hoistedStatements:r,hoistedIdentifiers:i}}function In(e,t){const n=Fn(e,t),r=[...n.hoistedStatements,...n.statements];return n.hoistedIdentifiers.length>0&&r.unshift(U(n.hoistedIdentifiers)),r}function Mn(e,t,n){if(n.type===_n.Switch)return!0;const r=En(e,t);if(!r)return!1;const s=function(e,t){var n,r;const s=null!==(n=i.getParseTreeNode(t))&&void 0!==n?n:t,o=(null!==(r=e.getDeclarations())&&void 0!==r?r:[]).filter(e=>e.getSourceFile()===s);return o.length>0?o.reduce((e,t)=>e.pos<t.pos?e:t):void 0}(r.symbol,e.sourceFile);if(!s)return!1;if(r.firstSeenAtPos<s.pos)return!0;if(n.functionDefinitions)for(const[o,a]of n.functionDefinitions){T(a.definition);const{line:r,column:c}=j(a.definition);if(void 0!==r&&void 0!==c){const u=i.getPositionOfLineAndCharacter(e.sourceFile,r,c);if(o!==t&&s.pos<u&&a.referencedSymbols.has(t)&&Mn(e,o,n))return!0}}return!1}function Pn(e){return void 0===e?[]:c(e)}function Cn(e){return ke("self",e,void 0,"this")}function Dn(){return ke("____exports")}function Kn(e,t){if(0===t)return e;const n=Bn(e);if(void 0!==n){const r=le(n+t);return B(r,e),r}return ve(e)&&ue(e.right)&&(e.operator===C.SubtractionOperator&&e.right.value===t||e.operator===C.AdditionOperator&&e.right.value===-t)?e.left:t>0?Ee(e,le(t),C.AdditionOperator):Ee(e,le(-t),C.SubtractionOperator)}function Bn(e){if(e)return ue(e)?e.value:xe(e)&&e.operator===C.NegationOperator&&ue(e.operand)?-e.operand.value:void 0}function Rn(e,t,n){if(e.luaTarget===I.Universal)return Gt(e,Ce.Unpack,n,t);return V(Ae(e.luaTarget===I.Lua50||e.luaTarget===I.Lua51||e.luaTarget===I.LuaJIT?ke("unpack"):Le(ke("table"),de("unpack")),[t],n),D.TableUnpackCall)}function jn(e,t,n,r){if(e.luaTarget===I.Universal)return Gt(e,Ce.Unpack,r,t);const i=e.luaTarget===I.Lua50?[]:[le(1),le(n)];return V(Ae(e.luaTarget===I.Lua50||e.luaTarget===I.Lua51||e.luaTarget===I.LuaJIT?ke("unpack"):Le(ke("table"),de("unpack")),[t,...i],r),D.TableUnpackCall)}function Vn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Se(t.map(e=>ye(e)))}function Wn(e){return pe(e)||ue(e)||ve(e)&&e.operator===C.ConcatOperator?e:Ae(ke("tostring"),[e])}function qn(e,t,n,r){const i=U(t,n,r);if(void 0!==t.symbolId){const t=On(e);t.type,_n.Switch,wn(t,i)}return i}function Gn(e,t,n,r,s){let o,a;const u=!0===e.options.noImplicitGlobalVariables,l=void 0!==r&&i.isFunctionDeclaration(r),p=c(t);if(0===p.length)return[];const d=null!==s&&void 0!==s?s:Ns(e,p[0]);if(d){if(!n)return[];a=z(p.map(t=>Cs(e,t,d)),n,r)}else{const i=On(e),s=i.type===_n.File;if(e.isModule||!s||u){const s=n&&!Array.isArray(n)&&me(n);if(!(l&&s)&&function(e,t){const n=e.referencedSymbols;return!!n&&c(t).map(e=>e.symbolId&&n.get(e.symbolId)).some(e=>e&&e.length>1)}(i,t)){const s=U(t,void 0,r);e.prependPrecedingStatements(s),n&&(a=z(t,n,r)),wn(i,s)}else o=U(t,n,r),l||wn(i,o)}else{if(!n)return[];a=z(t,n,r)}}if(l){const n=t.symbolId,r=On(e);if(n&&r.functionDefinitions){const e=r.functionDefinitions.get(n);var f;if(e)e.definition=null!==(f=o)&&void 0!==f?f:a}}return function(e,t,n,r){if(e.options.removeComments)return;const s=function(e,t){if(void 0===t)return;const n=t;if(void 0===n.name)return;const r=e.checker.getSymbolAtLocation(n.name);if(void 0===r)return;const s=r.getDocumentationComment(e.checker),o=i.displayPartsToString(s).trim(),a=r.getJsDocTags(e.checker),c=a.map(e=>{let t="@"+e.name;if(void 0!==e.text){t+=" "+e.text.filter(e=>""!==e.text.trim()).map(e=>e.text.trim()).join(" ")}return t}).join("\n"),u=(o+"\n\n"+c).trim();if(""===u)return;const l=u.split("\n").map(e=>" ".concat(e));if(l.length>0){const e=l[0];return e.startsWith(" @")?l.unshift("-"):(l.shift(),l.unshift("-"+e)),l}}(e,t);if(void 0===s)return;n&&r||n?n.leadingComments=s:r&&(r.leadingComments=s)}(e,r,o,a),o&&a?[o,a]:o?[o]:a?[a]:[]}const Un=e=>Ee(le(0),le(0),C.DivisionOperator,e);let zn=function(e){return e.CustomConstructor="customConstructor",e.CompileMembersOnly="compileMembersOnly",e.NoResolution="noResolution",e.NoSelf="noSelf",e.CustomName="customName",e.NoSelfInFile="noSelfInFile",e}({});const Hn=new Map(Object.values(zn).map(e=>[e.toLowerCase(),e]));const Jn=new WeakMap;function Qn(e){const t=Jn.get(e);if(t)return t;const n=new Map;return function(e,t){for(const i of e.getJsDocTags()){var n,r;const e=Hn.get(i.name.toLowerCase());if(!e)continue;const s={kind:i.name,args:null!==(n=null===(r=i.text)||void 0===r?void 0:r.map(e=>e.text))&&void 0!==n?n:[]};t.set(e,s)}}(e,n),Jn.set(e,n),n}function $n(e){const t=new Map;return e.symbol&&Qn(e.symbol).forEach((e,n)=>{t.set(n,e)}),e.aliasSymbol&&Qn(e.aliasSymbol).forEach((e,n)=>{t.set(n,e)}),t}const Yn=new WeakMap;function Zn(e){const t=Yn.get(e);if(t)return t;const n=new Map;return Xn(n,i.getAllJSDocTags(e,i.isJSDocUnknownTag)),Yn.set(e,n),n}function Xn(e,t){for(const n of t){const t=Hn.get(n.tagName.text.toLowerCase());t&&e.set(t,{kind:t,args:nr(n)})}}const er=new WeakMap;function tr(e){const t=er.get(e);if(t)return t;const n=new Map;if(e.statements.length>0){const t=e.statements[0].jsDoc;if(t)for(const e of t)e.tags&&Xn(n,e.tags)}return er.set(e,n),n}function nr(e){if(e.comment){if("string"===typeof e.comment){return e.comment.split("\n")[0].trim().split(" ")}return e.comment.map(e=>e.text)}return[]}let rr=function(e){return e[e.None=0]="None",e[e.Void=1]="Void",e[e.NonVoid=2]="NonVoid",e[e.Mixed=3]="Mixed",e}({});function ir(e){const t=an(e,e=>i.isSourceFile(e)||i.isModuleDeclaration(e));return!!t&&(i.isSourceFile(t)?tr(t).has(zn.NoSelfInFile):!!Zn(t).has(zn.NoSelf)||ir(t))}function sr(e){const t=e.parameters[0];if(t&&i.isIdentifier(t.name)&&i.identifierToKeywordKind(t.name)===i.SyntaxKind.ThisKeyword)return t}const or=new WeakMap;function ar(e,t){const n=or.get(t);if(void 0!==n)return n;const r=e.checker.getResolvedSignature(t),s=null===r||void 0===r?void 0:r.getDeclaration();let o=rr.None;if(s)o=ur(e,s);else{const n=function(e,t){var n,r;const s=i.isTaggedTemplateExpression(t)?t.tag:i.isJsxSelfClosingElement(t)||i.isJsxOpeningElement(t)?t.tagName:i.isCallExpression(t)?t.expression:void 0;if(!s)return[];const o=e.checker.getSymbolAtLocation(s);return void 0===o?[]:null!==(n=null===(r=o.getDeclarations())||void 0===r?void 0:r.flatMap(t=>{if(i.isImportSpecifier(t)){var n;return null!==(n=e.checker.getAliasedSymbol(o).getDeclarations())&&void 0!==n?n:[]}return[t]}))&&void 0!==n?n:[]}(e,t);o=n.some(e=>tr(e.getSourceFile()).has(zn.NoSelfInFile))||e.options.noImplicitSelf?rr.Void:rr.NonVoid}return or.set(t,o),o}const cr=new WeakMap;function ur(e,t){const n=sr(t);if(n)return n.type&&n.type.kind===i.SyntaxKind.VoidKeyword?rr.Void:rr.NonVoid;if(Zn(t).has(zn.NoSelf))return rr.Void;if(i.isMethodSignature(t)||i.isMethodDeclaration(t)||i.isConstructSignatureDeclaration(t)||i.isConstructorDeclaration(t)||t.parent&&i.isPropertyDeclaration(t.parent)||t.parent&&i.isPropertySignature(t.parent)||t.parent&&i.isIndexSignatureDeclaration(t.parent)){const e=an(t,e=>i.isClassDeclaration(e)||i.isClassExpression(e)||i.isInterfaceDeclaration(e));return void 0!==e&&Zn(e).has(zn.NoSelf)?rr.Void:rr.NonVoid}if(t.parent&&i.isTypeParameterDeclaration(t.parent))return rr.NonVoid;const r=e.program;if(r.getCompilerOptions().noImplicitSelf){const e=r.getSourceFile(t.getSourceFile().fileName);if(void 0!==e&&!r.isSourceFileDefaultLibrary(e)&&!r.isSourceFileFromExternalLibrary(e))return rr.Void}return ir(t)?rr.Void:rr.NonVoid}function lr(e,t){if(t.compositeSignatures)return t.compositeSignatures.flatMap(t=>lr(e,t));const n=t.getDeclaration();if(void 0===n)return[];let r;if(i.isMethodDeclaration(n)&&i.isObjectLiteralExpression(n.parent)&&!sr(n)?r=e.checker.getContextualTypeForObjectLiteralElement(n):!i.isFunctionExpression(n)&&!i.isArrowFunction(n)||sr(n)||(r=function(e,t){var n;return null!==(n=e.checker.getContextualType(t))&&void 0!==n?n:e.checker.getTypeAtLocation(t)}(e,n)),r){const e=dn(r);if(e.length>0)return e.map(e=>e.getDeclaration())}return[n]}const pr=new WeakMap;function dr(e,t){const n=pr.get(t);if(void 0!==n)return n;const r=function(e,t){if(t.isTypeParameter()){const n=t.getConstraint();if(n)return dr(e,n)}const n=e.checker.getSignaturesOfType(t,i.SignatureKind.Call);if(0===n.length)return rr.None;return function(e){let t=rr.None;for(const n of e)if(t|=n,t===rr.Mixed)break;return t}(n.flatMap(t=>lr(e,t)).map(t=>function(e,t){const n=cr.get(t);if(void 0!==n)return n;const r=ur(e,t);return cr.set(t,r),r}(e,t)))}(e,t);return pr.set(t,r),r}const fr=new WeakMap;function mr(e,t,n,r,s){var o,a;if(r===n)return;if(0!==(r.flags&i.TypeFlags.Any))return;const c=y(fr,n,()=>new Set);if(c.has(r))return;c.add(r),function(e,t,n,r,i){const s=dr(e,n),o=dr(e,r);s===rr.Mixed||o===rr.Mixed?e.diagnostics.push(Ze(t,i)):s!==o&&s!==rr.None&&o!==rr.None&&e.diagnostics.push(o===rr.Void?$e(t,i):Ye(t,i))}(e,t,n,r,s);const u=e.checker;if((u.isTupleType(r)||u.isArrayType(r))&&(u.isTupleType(n)||u.isArrayType(n))){const i=n.typeArguments,o=r.typeArguments;if(void 0===i||void 0===o)return;const a=Math.min(i.length,o.length);for(let n=0;n<a;++n)mr(e,t,i[n],o[n],s)}const l=null===(o=n.symbol)||void 0===o?void 0:o.members,p=null===(a=r.symbol)||void 0===a?void 0:a.members;function d(n,r,o){const a=e.checker.getTypeOfSymbolAtLocation(n,t),c=e.checker.getTypeOfSymbolAtLocation(r,t),u=i.unescapeLeadingUnderscores(o);mr(e,t,c,a,s?"".concat(s,".").concat(u):u)}l&&p&&(p.size<l.size?p.forEach((e,t)=>{const n=l.get(t);n&&d(e,n,t)}):l.forEach((e,t)=>{const n=p.get(t);n&&d(n,e,t)}))}function hr(e,t){e.pushPrecedingStatements();const n=t();return{precedingStatements:e.popPrecedingStatements(),result:n}}function gr(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];qt(e,Ce.Await);const r=n?[ke("____awaiter_resolve")]:[];return Ae(ke("__TS__AsyncAwaiter"),[he(W(t),r)])}function yr(e,t,n){const r=e.checker.getTypeAtLocation(t),s=i.skipOuterExpressions(t,i.OuterExpressionKinds.Assertions);if(i.isCallExpression(s)){if(hn(e,s)){const r=e.checker.getContextualType(t);r&&!mn(r)&&e.diagnostics.push(ht(s));let i=ss(e,s.arguments);return n&&(i=[Vn(...i)]),i}if(n&&gn(e,s)&&!xn(e,s))return[Vn(e.transformExpression(t))]}else if(Sn(e,s)&&fn(r))return[Rn(e,e.transformExpression(s),s)];return[e.transformExpression(t)]}function Sr(e,t,n){return Ht(n)?X([Ae(ke("____awaiter_resolve"),[ie(),...t])]):(xr(e)&&(t=[se(!0),...t]),X(t,n))}function xr(e){let t=!1;for(const n of function*(e){const t=e.scopeStack;for(let n=t.length-1;n>=0;--n){const e=t[n];yield e}}(e)){if(n.functionReturned=!0,n.type===_n.Function)break;t=t||n.type===_n.Try||n.type===_n.Catch}return t}const Tr=-1;class vr{constructor(e,t,n){var r,s,o;this.program=e,this.sourceFile=t,this.visitorMap=n,this.diagnostics=[],this.checker=this.program.getTypeChecker(),this.resolver=void 0,this.precedingStatementsStack=[],this.options=this.program.getCompilerOptions(),this.luaTarget=null!==(r=this.options.luaTarget)&&void 0!==r?r:I.Universal,this.isModule=i.isExternalModule(this.sourceFile),this.isStrict=(null!==(s=this.options.alwaysStrict)&&void 0!==s?s:this.options.strict)||this.isModule&&void 0!==this.options.target&&this.options.target>=i.ScriptTarget.ES2015,this.currentNodeVisitors=[],this.currentNodeVisitorsIndex=0,this.nextTempId=0,this.lastSymbolId=0,this.symbolInfoMap=new Map,this.symbolIdMaps=new Map,this.usedLuaLibFeatures=new Set,this.scopeStack=[],this.lastScopeId=0,this.currentNamespaces=void 0,this.classSuperInfos=[];const a=null!==(o=i.getParseTreeNode(t,i.isSourceFile))&&void 0!==o?o:t;this.resolver=this.checker.getEmitResolver(a)}transformNode(e){return Pn(this.transformNodeRaw(e))}transformNodeRaw(e,t){var n;if(i.canHaveModifiers(e)&&null!==(n=e.modifiers)&&void 0!==n&&n.some(e=>e.kind===i.SyntaxKind.DeclareKeyword))return[];const r=this.visitorMap.get(e.kind);if(!r)return this.diagnostics.push(Je(e,e.kind)),t?[ie()]:[];const s=this.currentNodeVisitors,o=this.currentNodeVisitorsIndex;this.currentNodeVisitors=r,this.currentNodeVisitorsIndex=r.length-1;const a=(0,this.currentNodeVisitors[this.currentNodeVisitorsIndex])(e,this);return this.currentNodeVisitors=s,this.currentNodeVisitorsIndex=o,a}superTransformNode(e){return Pn(this.doSuperTransformNode(e))}doSuperTransformNode(e){if(--this.currentNodeVisitorsIndex<0)throw new Error("There is no super transform for ".concat(i.SyntaxKind[e.kind]," visitor"));return Pn((0,this.currentNodeVisitors[this.currentNodeVisitorsIndex])(e,this))}transformExpression(e){const t=this.transformNodeRaw(e,!0);return this.assertIsExpression(e,t)}assertIsExpression(e,t){if(void 0===t)throw new Error("Expression visitor for node type ".concat(i.SyntaxKind[e.kind]," did not return any result."));return Array.isArray(t)?t[0]:t}superTransformExpression(e){const t=this.doSuperTransformNode(e);return this.assertIsExpression(e,t)}transformStatements(e){return c(e).flatMap(e=>{this.pushPrecedingStatements();const t=this.transformNode(e),n=this.popPrecedingStatements();return n.push(...t),n})}superTransformStatements(e){return c(e).flatMap(e=>{this.pushPrecedingStatements();const t=this.superTransformNode(e),n=this.popPrecedingStatements();return n.push(...t),n})}pushPrecedingStatements(){this.precedingStatementsStack.push([])}popPrecedingStatements(){const e=this.precedingStatementsStack.pop();return e}addPrecedingStatements(e){const t=this.precedingStatementsStack[this.precedingStatementsStack.length-1];Array.isArray(e)?t.push(...e):t.push(e)}prependPrecedingStatements(e){const t=this.precedingStatementsStack[this.precedingStatementsStack.length-1];Array.isArray(e)?t.unshift(...e):t.unshift(e)}createTempName(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"temp";return e=e.replace(/^_*/,""),Us("".concat(e,"_").concat(this.nextTempId++))}getTempNameForLuaExpression(e){if(pe(e))return e.value;if(ue(e))return"_".concat(e.value.toString());if(_e(e))return e.text;if(be(e)){const t=this.getTempNameForLuaExpression(e.expression);if(t)return"".concat(t,"_result")}else if(we(e)){const t=this.getTempNameForLuaExpression(e.table),n=this.getTempNameForLuaExpression(e.index);if(t||n)return"".concat(null!==t&&void 0!==t?t:"table","_").concat(null!==n&&void 0!==n?n:"index")}}createTempNameForLuaExpression(e){const t=this.getTempNameForLuaExpression(e),n=ke(this.createTempName(t),void 0,Tr);return B(n,j(e)),n}getTempNameForNode(e){if(i.isStringLiteral(e)||i.isIdentifier(e)||i.isMemberName(e))return e.text;if(i.isNumericLiteral(e))return"_".concat(e.text);if(i.isCallExpression(e)){const t=this.getTempNameForNode(e.expression);if(t)return"".concat(t,"_result")}else if(i.isElementAccessExpression(e)||i.isPropertyAccessExpression(e)){const t=this.getTempNameForNode(e.expression),n=i.isElementAccessExpression(e)?this.getTempNameForNode(e.argumentExpression):e.name.text;if(t||n)return"".concat(null!==t&&void 0!==t?t:"table","_").concat(null!==n&&void 0!==n?n:"index")}}createTempNameForNode(e){const t=this.getTempNameForNode(e);return ke(this.createTempName(t),e,Tr)}nextSymbolId(){return++this.lastSymbolId}pushScope(e){const t={type:e,id:++this.lastScopeId};return this.scopeStack.push(t),t}popScope(){const e=this.scopeStack.pop();return e}}function Er(e,t){if(!i.isPropertyAccessExpression(t)&&!i.isElementAccessExpression(t))return!1;const n=e.checker.getTypeAtLocation(t.expression);if(!tn(e,n))return!1;return"length"===(i.isPropertyAccessExpression(t)?t.name.text:i.isStringLiteral(t.argumentExpression)?t.argumentExpression.text:void 0)}function br(e,t,n,r){switch(t.kind){case i.SyntaxKind.ObjectLiteralExpression:return _r(e,t,n,r);case i.SyntaxKind.ArrayLiteralExpression:return Ar(e,t,n,r)}}function Ar(e,t,n,r){return t.elements.flatMap((s,o)=>{const a=Le(n,le(o+1),s);switch(s.kind){case i.SyntaxKind.ObjectLiteralExpression:return _r(e,s,a,r);case i.SyntaxKind.ArrayLiteralExpression:return Ar(e,s,a,r);case i.SyntaxKind.BinaryExpression:const c=e.createTempNameForLuaExpression(a),u=U(c,a),l=Ee(c,ie(),C.EqualityOperator),{precedingStatements:p,result:d}=hr(e,()=>Lr(e,s.left,e.transformExpression(s.right)));d.unshift(...p);const f=Lr(e,s.left,c);return[u,H(l,W(d),W(f),t)];case i.SyntaxKind.Identifier:case i.SyntaxKind.PropertyAccessExpression:case i.SyntaxKind.ElementAccessExpression:const{precedingStatements:m,result:h}=hr(e,()=>Lr(e,s,a,r));return[...m,...h];case i.SyntaxKind.SpreadElement:if(o!==t.elements.length-1)return[];const g=Gt(e,Ce.ArraySlice,void 0,n,le(o)),{precedingStatements:y,result:S}=hr(e,()=>Lr(e,s.expression,g,r));return[...y,...S];case i.SyntaxKind.OmittedExpression:default:return[]}})}function _r(e,t,n,r){const s=[];for(const o of t.properties)switch(o.kind){case i.SyntaxKind.ShorthandPropertyAssignment:s.push(...kr(e,o,n));break;case i.SyntaxKind.PropertyAssignment:s.push(...Or(e,o,n,r));break;case i.SyntaxKind.SpreadAssignment:s.push(...Nr(e,o,n,t.properties));break;case i.SyntaxKind.MethodDeclaration:case i.SyntaxKind.GetAccessor:case i.SyntaxKind.SetAccessor:break;default:v()}return s}function kr(e,t,n){const r=[],i=wr(e,t.name),s=de(t.name.text),o=Lr(e,t.name,Le(n,s));r.push(...o);const a=t.objectAssignmentInitializer?e.transformExpression(t.objectAssignmentInitializer):void 0;if(a){const n=Ee(i,ie(),C.EqualityOperator),s=W(Lr(e,t.name,a));r.push(H(n,s,void 0,t))}return r}function Or(e,t,n,r){const s=[];if(Ut(t.initializer)){const s=Le(n,wi(e,t.name));if(i.isObjectLiteralExpression(t.initializer))return _r(e,t.initializer,s,r);if(i.isArrayLiteralExpression(t.initializer))return Ar(e,t.initializer,s,r)}e.pushPrecedingStatements();let o=wi(e,t.name);o=li(e,o,t.name);const a=Le(n,o);let c;if(i.isBinaryExpression(t.initializer))if(i.isPropertyAccessExpression(t.initializer.left)||i.isElementAccessExpression(t.initializer.left)){const n=x(e.transformExpression(t.initializer.left),we),r=t.initializer.right,{precedingStatements:s,result:o}=hr(e,()=>e.transformExpression(r)),u=e.createTempNameForLuaExpression(n.table),l=e.createTempNameForLuaExpression(n.index),p=U([u,l],[n.table,n.index]),{precedingStatements:d,result:f}=Xr(e,a,o,s,i.SyntaxKind.QuestionQuestionToken,t.initializer);c=[p,...d,z(Le(u,l),f)]}else{c=[H(Ee(e.transformExpression(t.initializer.left),ie(),C.EqualityOperator),W(Pr(e,t.initializer)),void 0,t)]}else c=Lr(e,t.initializer,a,r);return s.push(...e.popPrecedingStatements()),s.push(...c),s}function Nr(e,t,n,r){const s=[];for(const a of r)if((i.isShorthandPropertyAssignment(a)||i.isPropertyAssignment(a))&&!i.isComputedPropertyName(a.name)&&!i.isPrivateIdentifier(a.name)){const t=i.isIdentifier(a.name)?de(a.name.text):e.transformExpression(a.name);s.push(ye(se(!0),t))}const o=Gt(e,Ce.ObjectRest,void 0,n,Se(s));return Lr(e,t.expression,o)}function wr(e,t,n){if(n&&(i.isElementAccessExpression(t)||i.isPropertyAccessExpression(t))){let n,r=e.transformExpression(t.expression);return r=li(e,r,t.expression),i.isElementAccessExpression(t)?(n=Xi(e,t),n=li(e,n,t.argumentExpression)):n=de(t.name.text,t.name),Le(r,n,t)}const r=e.checker.getSymbolAtLocation(t),s=e.transformExpression(t);return _e(s)&&r&&Is(e,r)?Cs(e,s):Fe(s)?s:(e.diagnostics.push(kt(t,s.kind)),Ne())}function Lr(e,t,n,r,s){if(i.isOptionalChain(t))return e.diagnostics.push(xt(t)),[];if(Er(e,t)){return[ne(Gt(e,Ce.ArraySetLength,s,e.transformExpression(t.expression),n))]}if((i.isPropertyAccessExpression(t)||i.isElementAccessExpression(t))&&t.expression.kind===i.SyntaxKind.SuperKeyword){const r=e.checker.getSymbolAtLocation(t);if(r&&r.flags&i.SymbolFlags.SetAccessor)return[ne(Gt(e,Ce.DescriptorSet,s,ke("self"),e.transformExpression(t.expression),i.isPropertyAccessExpression(t)?de(t.name.text):e.transformExpression(t.argumentExpression),n))]}const o=t.parent&&i.isShorthandPropertyAssignment(t.parent)?e.checker.getShorthandAssignmentValueSymbol(t.parent):e.checker.getSymbolAtLocation(t),a=o?Fs(e,o):[],c=z(wr(e,t,r),n,t.parent);return[c,...a.map(t=>{const[n]=c.left;return z(Cs(e,ke(t.name)),n)})]}function Fr(e,t,n,r,i){return[...r,...Lr(e,t,n,r.length>0,i)]}function Ir(e,t){let{precedingStatements:n,result:r}=hr(e,()=>e.transformExpression(t.right));e.addPrecedingStatements(n),yn(e,t.right)&&(r=Vn(r));const i=li(e,r,t.right),s=function(e,t,n,r){return br(e,t.left,n,r)}(e,t,i,n.length>0);return{statements:s,result:i}}const Mr=(e,t)=>i.isArrayLiteralExpression(t.left)&&t.left.elements.every(t=>{if(Er(e,t))return!1;if(i.isPropertyAccessExpression(t)||i.isElementAccessExpression(t))return!1;if(i.isIdentifier(t)){const n=e.checker.getSymbolAtLocation(t);if(n){return 0===Fs(e,n).length}}return!0});function Pr(e,t){const n=e.checker.getTypeAtLocation(t.right),r=e.checker.getTypeAtLocation(t.left);if(mr(e,t.right,n,r),zt(t)){if(Mr(e,t)){const n=e.checker.getTypeAtLocation(t.right);let r;i.isArrayLiteralExpression(t.right)?r=mi(e,t.right.elements):(r=e.transformExpression(t.right),!yn(e,t.right)&&tn(e,n)&&(r=jn(e,r,t.left.elements.length,t.right)));return[z(t.left.elements.map(t=>wr(e,t)),r,t)]}const{statements:n}=Ir(e,t);return n}{const{precedingStatements:n,result:r}=hr(e,()=>e.transformExpression(t.right));return Fr(e,t.left,r,n)}}const Cr=e=>e in Dr,Dr={[i.SyntaxKind.AmpersandToken]:"band",[i.SyntaxKind.BarToken]:"bor",[i.SyntaxKind.CaretToken]:"bxor",[i.SyntaxKind.LessThanLessThanToken]:"lshift",[i.SyntaxKind.GreaterThanGreaterThanToken]:"arshift",[i.SyntaxKind.GreaterThanGreaterThanGreaterThanToken]:"rshift"};function Kr(e,t,n,r,i){const s=Dr[r];return Ae(Le(ke(i),de(s)),[t,n],e)}function Br(e,t,n,r,s){switch(e.luaTarget){case I.Universal:case I.Lua50:case I.Lua51:return e.diagnostics.push(ut(t,"Bitwise operations",e.luaTarget)),Kr(t,n,r,s,"bit");case I.LuaJIT:return Kr(t,n,r,s,"bit");case I.Lua52:return Kr(t,n,r,s,"bit32");default:const o=function(e,t,n){switch(n){case i.SyntaxKind.BarToken:return C.BitwiseOrOperator;case i.SyntaxKind.CaretToken:return C.BitwiseExclusiveOrOperator;case i.SyntaxKind.AmpersandToken:return C.BitwiseAndOperator;case i.SyntaxKind.LessThanLessThanToken:return C.BitwiseLeftShiftOperator;case i.SyntaxKind.GreaterThanGreaterThanToken:return e.diagnostics.push(at(t)),C.BitwiseRightShiftOperator;case i.SyntaxKind.GreaterThanGreaterThanGreaterThanToken:return C.BitwiseRightShiftOperator}}(e,t,s);return Ee(n,r,o,t)}}function Rr(e,t,n,r){let i;if(n===C.BitwiseNotOperator)i="bnot";else v();return Ae(Le(ke(r),de(i)),[t],e)}function jr(e){return!(fe(e)||_e(e))}const Vr={[i.SyntaxKind.BarEqualsToken]:i.SyntaxKind.BarToken,[i.SyntaxKind.PlusEqualsToken]:i.SyntaxKind.PlusToken,[i.SyntaxKind.CaretEqualsToken]:i.SyntaxKind.CaretToken,[i.SyntaxKind.MinusEqualsToken]:i.SyntaxKind.MinusToken,[i.SyntaxKind.SlashEqualsToken]:i.SyntaxKind.SlashToken,[i.SyntaxKind.PercentEqualsToken]:i.SyntaxKind.PercentToken,[i.SyntaxKind.AsteriskEqualsToken]:i.SyntaxKind.AsteriskToken,[i.SyntaxKind.AmpersandEqualsToken]:i.SyntaxKind.AmpersandToken,[i.SyntaxKind.AsteriskAsteriskEqualsToken]:i.SyntaxKind.AsteriskAsteriskToken,[i.SyntaxKind.LessThanLessThanEqualsToken]:i.SyntaxKind.LessThanLessThanToken,[i.SyntaxKind.GreaterThanGreaterThanEqualsToken]:i.SyntaxKind.GreaterThanGreaterThanToken,[i.SyntaxKind.GreaterThanGreaterThanGreaterThanEqualsToken]:i.SyntaxKind.GreaterThanGreaterThanGreaterThanToken,[i.SyntaxKind.BarBarEqualsToken]:i.SyntaxKind.BarBarToken,[i.SyntaxKind.AmpersandAmpersandEqualsToken]:i.SyntaxKind.AmpersandAmpersandToken,[i.SyntaxKind.QuestionQuestionEqualsToken]:i.SyntaxKind.QuestionQuestionToken},Wr=e=>e in Vr,qr=e=>Vr[e];function Gr(e,t,n,r,i,s){const{precedingStatements:o,result:a}=function(e,t,n,r,i,s){if(Er(e,n)){const{precedingStatements:s,result:o}=Jr(e,t,n,r,i);return{precedingStatements:s,result:o.expression}}const o=e.transformExpression(n);if(!Fe(o))return e.diagnostics.push(kt(t,o.kind)),{precedingStatements:[],result:o};const{precedingStatements:a,result:c}=hr(e,()=>e.transformExpression(r));if(we(o)){const n=e.createTempNameForLuaExpression(o.table),r=e.createTempNameForLuaExpression(o.index),u=U([n,r],[o.table,o.index]),l=Le(n,r),p=e.createTempNameForLuaExpression(o);if(s){const n=U(p,l),{precedingStatements:r,result:s}=Xr(e,p,c,a,i,t);return{precedingStatements:[u,...r,n,z(l,s)],result:p}}{if(zr(i))return{precedingStatements:[u,...Hr(l,i,c,a)],result:o};const{precedingStatements:n,result:r}=Xr(e,l,c,a,i,t);return{precedingStatements:[u,...n,U(p,r),z(l,p)],result:p}}}if(s){const r=e.createTempNameForLuaExpression(o),s=U(r,o),{precedingStatements:u,result:l}=Xr(e,r,c,a,i,t);return{precedingStatements:[s,...u,...Fr(e,n,l,a)],result:r}}{if(a.length>0&&zr(i))return{precedingStatements:Hr(o,i,c,a),result:o};const{precedingStatements:r,result:s}=Xr(e,o,c,a,i,t);return{precedingStatements:Fr(e,n,s,r),result:o}}}(e,t,n,r,i,s);return e.addPrecedingStatements(o),a}function Ur(e,t,n,r,i){if(Er(e,n)){const{precedingStatements:s,result:o}=Jr(e,t,n,r,i);return[...s,o]}const s=e.transformExpression(n);if(!Fe(s))return e.diagnostics.push(kt(t,s.kind)),[];const{precedingStatements:o,result:a}=hr(e,()=>e.transformExpression(r));if(we(s)&&function(e,t){return jr(e.table)||jr(e.index)||t.length>0}(s,o)){const n=e.createTempNameForLuaExpression(s.table),r=e.createTempNameForLuaExpression(s.index),c=U([n,r],[s.table,s.index]),u=Le(n,r);if(zr(i))return[c,...Hr(u,i,a,o,t)];const{precedingStatements:l,result:p}=Xr(e,u,a,o,i,t);return[c,...l,z(u,p)]}{if(zr(i))return Hr(s,i,a,o,t);const{precedingStatements:r,result:c}=Xr(e,s,a,o,i,t);return Fr(e,n,c,r)}}function zr(e){return e===i.SyntaxKind.AmpersandAmpersandToken||e===i.SyntaxKind.BarBarToken||e===i.SyntaxKind.QuestionQuestionToken}function Hr(e,t,n,r,s){let o;return t===i.SyntaxKind.AmpersandAmpersandToken?o=e:t===i.SyntaxKind.BarBarToken?o=Te(e,C.NotOperator):t===i.SyntaxKind.QuestionQuestionToken?o=Ee(e,ie(),C.EqualityOperator):v(),[H(o,W([...r,z(e,n,s)]),void 0,s)]}function Jr(e,t,n,r,i){const{precedingStatements:s,result:o}=hr(e,()=>e.transformExpression(r)),a=e.transformExpression(n.expression),c=Te(a,C.LengthOperator,n),{precedingStatements:u,result:l}=Xr(e,c,o,s,i,t);return{precedingStatements:u,result:ne(Gt(e,Ce.ArraySetLength,t,a,l))}}const Qr=e=>e===i.SyntaxKind.AmpersandAmpersandToken||e===i.SyntaxKind.BarBarToken||e===i.SyntaxKind.QuestionQuestionToken,$r={[i.SyntaxKind.AmpersandAmpersandToken]:C.AndOperator,[i.SyntaxKind.BarBarToken]:C.OrOperator,[i.SyntaxKind.PlusToken]:C.AdditionOperator,[i.SyntaxKind.MinusToken]:C.SubtractionOperator,[i.SyntaxKind.AsteriskToken]:C.MultiplicationOperator,[i.SyntaxKind.AsteriskAsteriskToken]:C.PowerOperator,[i.SyntaxKind.SlashToken]:C.DivisionOperator,[i.SyntaxKind.PercentToken]:C.ModuloOperator,[i.SyntaxKind.GreaterThanToken]:C.GreaterThanOperator,[i.SyntaxKind.GreaterThanEqualsToken]:C.GreaterEqualOperator,[i.SyntaxKind.LessThanToken]:C.LessThanOperator,[i.SyntaxKind.LessThanEqualsToken]:C.LessEqualOperator,[i.SyntaxKind.EqualsEqualsToken]:C.EqualityOperator,[i.SyntaxKind.EqualsEqualsEqualsToken]:C.EqualityOperator,[i.SyntaxKind.ExclamationEqualsToken]:C.InequalityOperator,[i.SyntaxKind.ExclamationEqualsEqualsToken]:C.InequalityOperator};function Yr(e,t,n,r,s){if(Cr(r))return Br(e,s,t,n,r);if(r===i.SyntaxKind.QuestionQuestionToken)return i.isBinaryExpression(s),function(e,t,n,r){const s=e.checker.getTypeAtLocation(t.left);if(on(e,s)){const{precedingStatements:s,result:o}=Zr(e,n,r,[],i.SyntaxKind.QuestionQuestionToken,t);return e.addPrecedingStatements(s),o}return Ee(n,r,C.OrOperator,t)}(e,s,t,n);if(r===i.SyntaxKind.PercentToken&&e.luaTarget===I.Lua50){return Ae(Le(ke("math"),de("mod")),[t,n],s)}let o=$r[r];if(r===i.SyntaxKind.PlusToken&&i.isBinaryExpression(s)){const r=e.checker.getTypeAtLocation(s.left),i=e.checker.getTypeAtLocation(s.right),a=$t(e,r),c=$t(e,i);(a||c)&&(t=a?t:Wn(t),n=c?n:Wn(n),o=C.ConcatOperator)}return Ee(t,n,o,s)}function Zr(e,t,n,r,s,o){const a=e.createTempNameForLuaExpression(t),c=U(a,t,null===o||void 0===o?void 0:o.left);let u;switch(s){case i.SyntaxKind.BarBarToken:u=Te(Oe(a),C.NotOperator,o);break;case i.SyntaxKind.AmpersandAmpersandToken:u=Oe(a);break;case i.SyntaxKind.QuestionQuestionToken:u=Ee(Oe(a),ie(),C.EqualityOperator,o)}return{precedingStatements:[c,H(u,W([...r,z(a,n)]),void 0,null===o||void 0===o?void 0:o.left)],result:a}}function Xr(e,t,n,r,s,o){return r.length>0&&Qr(s)?(i.isBinaryExpression(o),Zr(e,t,n,r,s,o)):{precedingStatements:r,result:Yr(e,t,n,s,o)}}function ei(e){if(_e(e)&&e.symbolId===Tr)return;return(_e(e)||fe(e))&&void 0===e.line?void 0:be(e)||e.kind===C.MethodCallExpression?ne(e):U(Ne(),e)}function ti(e){for(;i.isNonNullChain(e);)e=e.expression;return e}function ni(e,t,n){return i.isParenthesizedExpression(t)?ni(e,t.expression,n):i.isPropertyAccessExpression(t)?ts(e,t,n):i.isElementAccessExpression(t)?es(e,t,n):{expression:e.transformExpression(t)}}function ri(e,t,n,r){if(!ui(e,t,r))return t;const i=z(n,t,r);return e.addPrecedingStatements(i),n}const ii=new WeakMap;function si(e){return i.isIdentifier(e)&&ii.has(e)}function oi(e){return ii.get(e)}function ai(e,t){return ci(e,t,void 0).expression}function ci(e,t,n,r){const s=e.createTempName("opt"),{expression:o,chain:a}=function(e){const t=[e=ti(e)];for(;!e.questionDotToken&&!i.isTaggedTemplateExpression(e);){const n=e.expression;T(i.isOptionalChain(n)),e=ti(n),t.unshift(e)}return{expression:e.expression,chain:t}}(t),c=function(e,t){const n=i.factory.createIdentifier(e);return i.setOriginalNode(n,t),ii.set(n,{usedIdentifiers:[]}),n}(s,o);let u,l=c;for(const T of a)i.isPropertyAccessExpression(T)?l=i.factory.createPropertyAccessExpression(l,T.name):i.isElementAccessExpression(T)?l=i.factory.createElementAccessExpression(l,T.argumentExpression):i.isCallExpression(T)?l=i.factory.createCallExpression(l,void 0,T.arguments):v(),i.setOriginalNode(l,T);r&&(l=i.factory.createDeleteExpression(l),i.setOriginalNode(l,r));const{precedingStatements:p,result:d}=hr(e,()=>{if(!n)return e.transformExpression(l);const{expression:t,thisValue:r}=ni(e,l,n);return u=r,t}),f=ke(e.createTempName("this"),void 0,Tr);let m;const h=oi(c),g=null===h||void 0===h?void 0:h.contextualCall,{precedingStatements:y,result:S}=hr(e,()=>{let t;return g?({expression:t,thisValue:m}=ni(e,o,f)):t=e.transformExpression(o),t});if(function e(t){return i.isPropertyAccessExpression(t)?e(t.expression):t}(o).kind===i.SyntaxKind.SuperKeyword&&(m=ke("self")),g)if(m)g.params[0]=m,m===f&&e.addPrecedingStatements(U(f));else if(e.isStrict)g.params[0]=ie();else{const t=ke("_G");if(0===p.length)g.params[0]=t;else{const n=e.createTempNameForLuaExpression(t);p.unshift(U(n,t)),g.params[0]=n}}let x;e.addPrecedingStatements(y);const E=null===h||void 0===h?void 0:h.usedIdentifiers,b=E&&E.length>0&&_e(S)&&(0===p.length||!ui(e,S,o));if(b){x=S;for(const e of E)e.text=x.text}else x=ke(s,void 0,Tr),e.addPrecedingStatements(U(x,S));if(!un(t)||r){const t=ei(d),n=p;return t&&n.push(t),e.addPrecedingStatements(H(Ee(x,ie(),C.InequalityOperator),W(n))),{expression:ie(),thisValue:u}}if(0!==p.length||on(e,e.checker.getTypeAtLocation(o))){let t;return b?(t=ke(e.createTempName("opt_result"),void 0,Tr),e.addPrecedingStatements(U(t))):t=x,e.addPrecedingStatements(H(Ee(x,ie(),C.InequalityOperator),W([...p,z(t,d)]))),{expression:t,thisValue:u}}return{expression:Ee(x,d,C.AndOperator,t),thisValue:u}}function ui(e,t,n){return!fe(t)&&!(_e(t)&&t.symbolId===Tr)&&!(n&&(function(e,t){let n=t;if(i.isComputedPropertyName(n)&&(n=n.expression),!i.isIdentifier(n))return!1;const r=e.checker.getSymbolAtLocation(n);return!(null===r||void 0===r||!r.declarations)&&r.declarations.some(e=>i.isVariableDeclarationList(e.parent)&&0!==(e.parent.flags&i.NodeFlags.Const))}(e,n)||si(n)||n.kind===i.SyntaxKind.ThisKeyword))}function li(e,t,n){if(!ui(e,t,n))return t;const r=e.createTempNameForLuaExpression(t),i=U(r,t,n);return e.addPrecedingStatements(i),Oe(r,n)}function pi(e,t){const n=[],r=[];let i=-1;for(let s=0;s<t.length;++s){const{precedingStatements:o,result:a}=hr(e,()=>e.transformExpression(t[s]));r.push(a),o.length>0&&(i=s),n.push(o)}return{transformedExpressions:r,precedingStatements:n,lastPrecedingStatementsIndex:i}}function di(e,t,n,r,i){for(let s=0;s<n.length;++s)e.addPrecedingStatements(r[s]),s<i&&(n[s]=li(e,n[s],t[s]));return n}function fi(e,t,n){if(t){const r=Gt(e,Ce.SparseArrayPush,void 0,t,...n);e.addPrecedingStatements(ne(r))}else{const r=U(t=ke(e.createTempName("array")),Gt(e,Ce.SparseArrayNew,void 0,...n));e.addPrecedingStatements(r)}return t}function mi(e,t){const{transformedExpressions:n,precedingStatements:r,lastPrecedingStatementsIndex:s}=pi(e,t),o=t.findIndex(e=>i.isSpreadElement(e));return o>=0&&o<t.length-1||function(e,t,n,r){return r<0?0:n.slice(0,r).filter((n,r)=>ui(e,n,t[r])).length}(e,t,n,s)>2?function(e,t,n,r){let s,o=[];for(let a=0;a<t.length;++a)r[a].length>0&&o.length>0&&(s=fi(e,s,o),o=[]),e.addPrecedingStatements(r[a]),o.push(n[a]),i.isSpreadElement(t[a])&&(s=fi(e,s,o),o=[]);if(o.length>0&&(s=fi(e,s,o)),!s)throw new Error("Array identifier was not created");return[Gt(e,Ce.SparseArraySpread,void 0,s)]}(e,t,n,r):di(e,t,n,r,s)}function hi(e,t){const{transformedExpressions:n,precedingStatements:r,lastPrecedingStatementsIndex:i}=pi(e,t);return di(e,t,n,r,i)}function gi(e,t){if(i.isOmittedExpression(t))return Ne(t);if(i.isIdentifier(t))return ys(e,t);if(i.isBindingElement(t)){if(i.isIdentifier(t.name))return ys(e,t.name);{const n=e.createTempNameForNode(t.name);return e.addPrecedingStatements(yi(e,t.name,n)),n}}v()}function yi(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const s=[];for(const[a,c]of t.elements.entries()){var o;if(i.isOmittedExpression(c))continue;if(i.isArrayBindingPattern(c.name)||i.isObjectBindingPattern(c.name)){const o=i.isObjectBindingPattern(t)?c.propertyName:i.factory.createNumericLiteral(String(a+1));void 0!==o&&r.push(o),s.push(...yi(e,c.name,n,r));continue}const u=r.reduce((t,n)=>Le(t,wi(e,n)),n),l=ys(e,c.name),p=null!==(o=c.propertyName)&&void 0!==o?o:c.name,{precedingStatements:d,result:f}=hr(e,()=>wi(e,p));let m;if(s.push(...d),c.dotDotDotToken){if(a!==t.elements.length-1)continue;if(i.isObjectBindingPattern(t)){const n=[];for(const e of t.elements)e.dotDotDotToken||(i.isIdentifier(e.name)&&!e.propertyName&&n.push(e.name),e.propertyName&&e.name&&i.isIdentifier(e.propertyName)&&n.push(e.propertyName));const r=n.map(e=>ye(se(!0),de(e.text,e)));m=Gt(e,Ce.ObjectRest,void 0,u,Se(r))}else m=Gt(e,Ce.ArraySlice,void 0,u,le(a))}else m=Le(u,i.isObjectBindingPattern(t)?f:le(a+1));if(s.push(...Gn(e,l,m)),c.initializer){const t=Ps(e,l),n=c.initializer,{precedingStatements:r,result:i}=hr(e,()=>e.transformExpression(n));s.push(H(Ee(t,ie(),C.EqualityOperator),W([...r,z(t,i)])))}}return r.pop(),s}function Si(e,t){if(t.initializer&&t.type){const n=e.checker.getTypeAtLocation(t.initializer),r=e.checker.getTypeFromTypeNode(t.type);mr(e,t.initializer,n,r)}if(i.isIdentifier(t.name)){const n=ys(e,t.name),r=t.initializer&&e.transformExpression(t.initializer),s=r&&function(){t.initializer;const n=i.skipOuterExpressions(t.initializer);return!(!i.isFunctionExpression(n)&&!i.isArrowFunction(n))&&((!i.isFunctionExpression(n)||!n.name)&&Ei(e,e.checker.getTypeAtLocation(t.name)))}()?vi(r):r;return Gn(e,n,s,t)}return i.isArrayBindingPattern(t.name)||i.isObjectBindingPattern(t.name)?function(e,t,n){const r=[];if(i.isObjectBindingPattern(t)||t.elements.some(e=>i.isBindingElement(e)&&(!i.isIdentifier(e.name)||e.dotDotDotToken))){let i;if(n){let t=e.transformExpression(n);yn(e,n)&&(t=Vn(t));const{precedingStatements:s,result:o}=hr(e,()=>li(e,t,n));r.push(...s),i=o}else i=Ne();return r.push(...yi(e,t,i)),r}const s=t.elements.length>0?t.elements.map(t=>gi(e,t)):Ne();if(n)if(yn(e,n))r.push(...Gn(e,s,e.transformExpression(n),n));else if(i.isArrayLiteralExpression(n)){const t=n.elements.length>0?n.elements.map(t=>e.transformExpression(t)):ie();r.push(...Gn(e,s,t,n))}else{const i=jn(e,e.transformExpression(n),t.elements.length,n);r.push(...Gn(e,s,i,n))}else r.push(...Gn(e,s,ie(),n));for(const o of t.elements)if(!i.isOmittedExpression(o)&&o.initializer){const t=ys(e,o.name),n=Ps(e,t);r.push(H(Ee(n,ie(),C.EqualityOperator),W([z(n,e.transformExpression(o.initializer))])))}return r}(e,t.name,t.initializer):v(t.name)}function xi(e,t){if(0===(t.flags&(i.NodeFlags.Let|i.NodeFlags.Const|i.NodeFlags.Using|i.NodeFlags.AwaitUsing))){const n=i.getOriginalNode(t).getFirstToken();e.diagnostics.push(ft(n))}}function Ti(e,t,n,r){const{precedingStatements:i,result:s}=hr(e,()=>e.transformExpression(n));if(re(s)||i.push(z(t,s)),0===i.length)return;return H(Ee(t,ie(),C.EqualityOperator),W(i,r),void 0,r)}function vi(e){var t;me(e)?null===(t=e.params)||void 0===t||t.unshift(Ne()):e=he(W([X([Ae(e,[ae()])])]),[Ne()],ae(),D.Inline);return Ae(ke("setmetatable"),[Se(),Se([ye(e,de("__call"))])])}function Ei(e,t){return t.isUnion()?t.types.some(t=>Ei(e,t)):rn(t)&&t.getProperties().length>0&&void 0===It(e,t)}function bi(e,t){if(!i.isBlock(t)){const{precedingStatements:n,result:r}=hr(e,()=>function(e,t){return Sr(e,yr(e,t,!1),t)}(e,t));return[...n,r]}return In(e,e.transformStatements(t.statements))}function Ai(e,t,n,r){const s=[],o=[];let a=0;for(const c of n)if(i.isObjectBindingPattern(c.name)||i.isArrayBindingPattern(c.name)){const t=ke("____bindingPattern".concat(a++));if(void 0!==c.initializer){const n=Ti(e,t,c.initializer);n&&s.push(n)}const n=c.name,{precedingStatements:r,result:i}=hr(e,()=>yi(e,n,t));o.push(...r,...i)}else if(void 0!==c.initializer){const t=Ti(e,ys(e,c.name),c.initializer);t&&s.push(t)}if(r&&function(e,t){if(!e.symbolId)return!0;if(void 0===t.referencedSymbols)return!1;const n=t.referencedSymbols.get(e.symbolId);return void 0!==n&&n.length>0}(r,t)){const t=e.luaTarget===I.Lua50?ce():Vn(ae());s.push(U(r,t))}return s.push(...o),s}function _i(e,t,n,r,s){const o=e.pushScope(_n.Function);o.node=s;let a=bi(e,n);s&&function(e){var t,n;return null!==(t=null===(n=e.modifiers)||void 0===n?void 0:n.some(e=>e.kind===i.SyntaxKind.AsyncKeyword))&&void 0!==t&&t}(s)&&(a=[X([gr(e,a)])]);const c=Ai(e,o,t,r);return e.popScope(),[[...c,...a],o]}function ki(e,t,n){const r=[];let s,o;n&&r.push(n);let a=0;for(const c of t){if(i.isIdentifier(c.name)&&i.identifierToKeywordKind(c.name)===i.SyntaxKind.ThisKeyword)continue;const t=i.isObjectBindingPattern(c.name)||i.isArrayBindingPattern(c.name)?ke("____bindingPattern".concat(a++)):ys(e,c.name);c.dotDotDotToken?(s=t,o=ae()):r.push(t)}return[r,o,s]}function Oi(e,t){var n;t.body;const r=e.checker.getTypeAtLocation(t);let s;const o=t.parameters[0];o&&i.isIdentifier(o.name)&&i.identifierToKeywordKind(o.name)===i.SyntaxKind.ThisKeyword&&(null===(n=o.type)||void 0===n?void 0:n.kind)===i.SyntaxKind.VoidKeyword||dr(e,r)===rr.Void||(i.isArrowFunction(t)?t.parameters.length>0&&(s=Ne()):s=Cn());let a=D.None;i.isBlock(t.body)||(a|=D.Inline),(i.isFunctionDeclaration(t)||i.isMethodDeclaration(t))&&(a|=D.Declaration);const[c,u,l]=ki(e,t.parameters,s),[p,d]=_i(e,t.parameters,t.body,l,t),f=he(W(p),c,u,a,t);return[t.asteriskToken?Gt(e,Ce.Generator,void 0,f):f,d]}function Ni(e,t){if(void 0===e.body)return ie();const[n,r]=Oi(t,e),s=i.isFunctionExpression(e)&&e.name;if(s&&r.referencedSymbols){const i=t.checker.getSymbolAtLocation(e.name);if(i){if([...r.referencedSymbols].some(e=>{let[,n]=e;return n.some(e=>{var n;return(null===(n=t.checker.getSymbolAtLocation(e))||void 0===n?void 0:n.valueDeclaration)===i.valueDeclaration})})){const r=ys(t,e.name);return Ei(t,t.checker.getTypeAtLocation(e))?t.addPrecedingStatements([U(r),z(r,vi(n))]):t.addPrecedingStatements(U(r,n)),Oe(r)}}}return s&&Ei(t,t.checker.getTypeAtLocation(e))?vi(n):n}function wi(e,t){if(i.isComputedPropertyName(t))return e.transformExpression(t.expression);if(i.isIdentifier(t))return de(t.text);if(i.isPrivateIdentifier(t))throw new Error("PrivateIdentifier is not supported");return e.transformExpression(t)}function Li(e,t,n){return Ts(e,n,t)}function Fi(e){return e.kind===i.SyntaxKind.UndefinedKeyword||e.kind===i.SyntaxKind.NullKeyword||i.isIdentifier(e)&&"undefined"===e.text}const Ii={[i.SyntaxKind.NullKeyword]:e=>ie(e),[i.SyntaxKind.TrueKeyword]:e=>se(!0,e),[i.SyntaxKind.FalseKeyword]:e=>se(!1,e),[i.SyntaxKind.NumericLiteral]:(e,t)=>{if("Infinity"===e.text){if(t.luaTarget===I.Lua50){return Ee(le(1),le(0),C.DivisionOperator)}return Le(ke("math"),de("huge"),e)}return le(Number(e.text),e)},[i.SyntaxKind.StringLiteral]:e=>de(e.text,e),[i.SyntaxKind.NoSubstitutionTemplateLiteral]:e=>de(e.text,e),[i.SyntaxKind.ObjectLiteralExpression]:(e,t)=>{const n=[],r=[],s=[],o=[];let a=-1;for(let l=0;l<e.properties.length;++l){const c=e.properties[l];t.pushPrecedingStatements();const u=c.name?wi(t,c.name):void 0;let p=t.popPrecedingStatements();if(s.push(p),p.length>0&&(a=l),t.pushPrecedingStatements(),i.isPropertyAssignment(c)){const e=t.transformExpression(c.initializer);n.push(ye(e,u,c)),r.push(c.initializer)}else if(i.isShorthandPropertyAssignment(c)){const e=t.checker.getShorthandAssignmentValueSymbol(c);e&&bn(t,e,c.name);const i=Li(t,e,c.name);n.push(ye(i,u,c)),r.push(c)}else if(i.isMethodDeclaration(c)){const e=Ni(c,t);n.push(ye(e,u,c)),r.push(c)}else if(i.isSpreadAssignment(c)){const e=t.checker.getTypeAtLocation(c.expression);let i;i=tn(t,e)?Gt(t,Ce.ArrayToObject,c.expression,t.transformExpression(c.expression)):t.transformExpression(c.expression),n.push(i),r.push(c.expression)}else i.isAccessor(c)?t.diagnostics.push(ot(c)):v();p=t.popPrecedingStatements(),o.push(p),p.length>0&&(a=l)}if(a>=0)for(let i=0;i<n.length;++i){const c=n[i];t.addPrecedingStatements(s[i]),i<=a&&ge(c)&&c.key&&(c.key=li(t,c.key,e.properties[i].name)),t.addPrecedingStatements(o[i]),i<a&&(ge(c)?c.value=li(t,c.value,r[i]):n[i]=li(t,c,r[i]))}let c=[];const u=[];for(const i of n)ge(i)?c.push(i):(c.length>0&&u.push(Se(c)),u.push(i),c=[]);if(0===u.length)return Se(c,e);if(c.length>0){const t=Se(c,e);u.push(t)}return u[0].kind!==C.TableExpression&&u.unshift(Se(void 0,e)),Gt(t,Ce.ObjectAssign,e,...u)},[i.SyntaxKind.ArrayLiteralExpression]:(e,t)=>{!function(e,t){let n=e.elements.length-1;for(;n>=0&&Fi(e.elements[n]);n--);for(let r=0;r<e.elements.length;r++)r<n&&Fi(e.elements[r])&&t.diagnostics.push(bt(e.elements[r]))}(e,t);return Se(mi(t,e.elements.map(e=>i.isOmittedExpression(e)?i.factory.createIdentifier("undefined"):e)).map(e=>ye(e)),e)}};function Mi(e,t){const n=e.checker.getConstantValue(t);return"string"===typeof n?de(n,t):"number"===typeof n?le(n,t):void 0}const Pi=new Map([[Lt.AdditionOperatorType,C.AdditionOperator],[Lt.AdditionOperatorMethodType,C.AdditionOperator],[Lt.SubtractionOperatorType,C.SubtractionOperator],[Lt.SubtractionOperatorMethodType,C.SubtractionOperator],[Lt.MultiplicationOperatorType,C.MultiplicationOperator],[Lt.MultiplicationOperatorMethodType,C.MultiplicationOperator],[Lt.DivisionOperatorType,C.DivisionOperator],[Lt.DivisionOperatorMethodType,C.DivisionOperator],[Lt.ModuloOperatorType,C.ModuloOperator],[Lt.ModuloOperatorMethodType,C.ModuloOperator],[Lt.PowerOperatorType,C.PowerOperator],[Lt.PowerOperatorMethodType,C.PowerOperator],[Lt.FloorDivisionOperatorType,C.FloorDivisionOperator],[Lt.FloorDivisionOperatorMethodType,C.FloorDivisionOperator],[Lt.BitwiseAndOperatorType,C.BitwiseAndOperator],[Lt.BitwiseAndOperatorMethodType,C.BitwiseAndOperator],[Lt.BitwiseOrOperatorType,C.BitwiseOrOperator],[Lt.BitwiseOrOperatorMethodType,C.BitwiseOrOperator],[Lt.BitwiseExclusiveOrOperatorType,C.BitwiseExclusiveOrOperator],[Lt.BitwiseExclusiveOrOperatorMethodType,C.BitwiseExclusiveOrOperator],[Lt.BitwiseLeftShiftOperatorType,C.BitwiseLeftShiftOperator],[Lt.BitwiseLeftShiftOperatorMethodType,C.BitwiseLeftShiftOperator],[Lt.BitwiseRightShiftOperatorType,C.BitwiseRightShiftOperator],[Lt.BitwiseRightShiftOperatorMethodType,C.BitwiseRightShiftOperator],[Lt.ConcatOperatorType,C.ConcatOperator],[Lt.ConcatOperatorMethodType,C.ConcatOperator],[Lt.LessThanOperatorType,C.LessThanOperator],[Lt.LessThanOperatorMethodType,C.LessThanOperator],[Lt.GreaterThanOperatorType,C.GreaterThanOperator],[Lt.GreaterThanOperatorMethodType,C.GreaterThanOperator]]),Ci=new Map([[Lt.NegationOperatorType,C.NegationOperator],[Lt.NegationOperatorMethodType,C.NegationOperator],[Lt.BitwiseNotOperatorType,C.BitwiseNotOperator],[Lt.BitwiseNotOperatorMethodType,C.BitwiseNotOperator],[Lt.LengthOperatorType,C.LengthOperator],[Lt.LengthOperatorMethodType,C.LengthOperator]]),Di=new Set([Lt.BitwiseAndOperatorType,Lt.BitwiseAndOperatorMethodType,Lt.BitwiseOrOperatorType,Lt.BitwiseOrOperatorMethodType,Lt.BitwiseExclusiveOrOperatorType,Lt.BitwiseExclusiveOrOperatorMethodType,Lt.BitwiseLeftShiftOperatorType,Lt.BitwiseLeftShiftOperatorMethodType,Lt.BitwiseRightShiftOperatorType,Lt.BitwiseRightShiftOperatorMethodType,Lt.BitwiseNotOperatorType,Lt.BitwiseNotOperatorMethodType]),Ki=new Set([...Di,Lt.FloorDivisionOperatorType,Lt.FloorDivisionOperatorMethodType]),Bi={};for(const Ba of Pi.keys())Bi[Ba]=Ri;for(const Ba of Ci.keys())Bi[Ba]=ji;function Ri(e,t,n){Ki.has(n)&&Vi(e,t,n);const r=Wt(e,t,n);if(!r)return ie();const[i,s]=hi(e,r),o=Pi.get(n);return Ee(i,s,o)}function ji(e,t,n){Ki.has(n)&&Vi(e,t,n);const r=Vt(e,t,n);if(!r)return ie();const i=Ci.get(n);return Te(e.transformExpression(r),i)}function Vi(e,t,n){if(e.luaTarget===I.Lua50||e.luaTarget===I.Lua51||e.luaTarget===I.Lua52||e.luaTarget===I.LuaJIT||e.luaTarget===I.Universal){const r=e.luaTarget===I.Universal?I.Lua51:e.luaTarget;n===Lt.FloorDivisionOperatorType||n===Lt.FloorDivisionOperatorMethodType?e.diagnostics.push(ut(t,"Floor division operator",r)):e.diagnostics.push(ut(t,"Native bitwise operations",r))}}const Wi=[Lt.TableNewType],qi={[Lt.TableDeleteType]:Gi,[Lt.TableDeleteMethodType]:Gi,[Lt.TableGetType]:Ui,[Lt.TableGetMethodType]:Ui,[Lt.TableHasType]:zi,[Lt.TableHasMethodType]:zi,[Lt.TableSetType]:Hi,[Lt.TableSetMethodType]:Hi,[Lt.TableAddKeyType]:Ji,[Lt.TableAddKeyMethodType]:Ji,[Lt.TableIsEmptyType]:Qi,[Lt.TableIsEmptyMethodType]:Qi};function Gi(e,t,n){const r=Wt(e,t,n);if(!r)return ie();const[i,s]=hi(e,r);return e.addPrecedingStatements(z(Le(i,s),ie(),t)),se(!0)}function Ui(e,t,n){const r=Wt(e,t,n);if(!r)return ie();const[i,s]=hi(e,r);return Le(i,s,t)}function zi(e,t,n){const r=Wt(e,t,n);if(!r)return ie();const[i,s]=hi(e,r);return Ee(Le(i,s),ie(),C.InequalityOperator,t)}function Hi(e,t,n){const r=jt(e,t,n,3);if(!r)return ie();const[i,s,o]=hi(e,r);return e.addPrecedingStatements(z(Le(i,s),o,t)),ie()}function Ji(e,t,n){const r=jt(e,t,n,2);if(!r)return ie();const[i,s]=hi(e,r);return e.addPrecedingStatements(z(Le(i,s),se(!0),t)),ie()}function Qi(e,t,n){const r=Vt(e,t,n);if(!r)return ie();const i=e.transformExpression(r);return Ee(Ae(ke("next"),[i],t),ie(),C.EqualityOperator,t)}const $i=(0,s.A)((0,s.A)({},Bi),qi),Yi=new Set(Object.keys($i));function Zi(e,t,n){const r=e.checker.getTypeAtLocation(t.expression),i=e.checker.getTypeAtLocation(t.argumentExpression);return tn(e,r)&&Yt(e,i)?Kn(n,1):n}function Xi(e,t){const n=e.transformExpression(t.argumentExpression);return Zi(e,t,n)}Wi.forEach(e=>Yi.add(e));function es(e,t,n){const r=Mi(e,t);if(r)return{expression:r};if(i.isOptionalChain(t))return ci(e,t,n);const[s,o]=hi(e,[t.expression,t.argumentExpression]),a=e.checker.getTypeAtLocation(t.expression),c=e.checker.getTypeAtLocation(t.argumentExpression);if($t(e,a)&&Yt(e,c))return{expression:Gt(e,Ce.StringAccess,t,s,o)};const u=Zi(e,t,o);if(yn(e,t.expression)){const n=e.checker.getTypeAtLocation(t.argumentExpression);Yt(e,n)||e.diagnostics.push(gt(t));if(i.isNumericLiteral(t.argumentExpression)&&"0"===t.argumentExpression.text)return{expression:Me(s)};return{expression:Ae(ke("select"),[u,s])}}if(n){const r=ri(e,s,n,t.expression);return{expression:Le(r,u,t),thisValue:r}}return{expression:Le(s,u,t)}}function ts(e,t,n){const r=e.checker.getTypeAtLocation(t.expression),s=si(t.expression);let o=t.name.text;const a=e.checker.getSymbolAtLocation(t.name),c=Ss(e,a);c&&(o=c);const u=Mi(e,t);if(u)return{expression:u};if(i.isCallExpression(t.expression)&&gn(e,t.expression)&&e.diagnostics.push(gt(t)),i.isOptionalChain(t))return ci(e,t,n);if($n(r).has(zn.CompileMembersOnly)){if(s&&e.diagnostics.push(Et(t)),i.isPropertyAccessExpression(t.expression)){return{expression:Le(e.transformExpression(t.expression.expression),de(o),t)}}return Is(e,r.symbol)&&ws(e,r.symbol)===t.expression.getSourceFile()?{expression:Le(Dn(),de(o),t)}:{expression:ke(o,t)}}const l=function(e,t){const n=e.checker.getTypeAtLocation(t.expression);if(i.isIdentifier(t.expression)&&pn(e,n,void 0))switch(n.symbol.name){case"NumberConstructor":return function(e,t){const n=t.name.text;switch(n){case"POSITIVE_INFINITY":if(e.luaTarget===I.Lua50){return Ee(le(1),le(0),C.DivisionOperator)}return Le(ke("math"),de("huge"),t);case"NEGATIVE_INFINITY":if(e.luaTarget===I.Lua50){return Te(Ee(le(1),le(0),C.DivisionOperator),C.NegationOperator)}return Te(Le(ke("math"),de("huge"),t),C.NegationOperator);case"NaN":return Un(t);case"EPSILON":return Ee(le(2),le(-52),C.PowerOperator,t);case"MIN_VALUE":case"MIN_SAFE_INTEGER":return Ee(le(-2),le(1074),C.PowerOperator,t);case"MAX_SAFE_INTEGER":case"MAX_VALUE":return Ee(le(2),le(1024),C.PowerOperator,t);default:e.diagnostics.push(pt(t.name,"Number",n))}}(e,t);case"Math":return function(e,t){const n=t.name.text;switch(n){case"PI":const r=de("pi",t.name);return Le(ke("math",t.expression),r,t);case"E":case"LN10":case"LN2":case"LOG10E":case"LOG2E":case"SQRT1_2":case"SQRT2":return le(Math[n],t);default:e.diagnostics.push(pt(t.name,"Math",n))}}(e,t);case"SymbolConstructor":qt(e,Ce.Symbol)}if($t(e,n))return function(e,t){if("length"===t.name.text){const n=e.transformExpression(t.expression);if(e.luaTarget===I.Lua50){return Ae(Le(ke("string"),de("len")),[n],t)}return Te(n,C.LengthOperator,t)}e.diagnostics.push(pt(t.name,"string",t.name.text))}(e,t);if(tn(e,n))return function(e,t){if("length"===t.name.text){const n=e.transformExpression(t.expression);return ls(e,n,t)}return}(e,t);if(rn(n))return function(e,t){switch(t.name.text){case"length":e.luaTarget!==I.Lua50&&e.luaTarget!==I.Lua51&&e.luaTarget!==I.Universal||e.diagnostics.push(ut(t,"function.length",e.luaTarget));const n=Ae(Le(ke("debug"),de("getinfo")),[e.transformExpression(t.expression)]),r=Le(n,de("nparams"));return dr(e,e.checker.getTypeAtLocation(t.expression))===rr.NonVoid?Ee(r,le(1),C.SubtractionOperator):r;case"arguments":case"caller":case"displayName":case"name":e.diagnostics.push(pt(t.name,"function",t.name.text))}}(e,t)}(e,t);if(l)return{expression:l};if(i.isIdentifier(t.expression)&&t.parent&&(!i.isCallExpression(t.parent)||t.parent.expression!==t)){const n=Ct(e,t);n&&Yi.has(n)&&e.diagnostics.push(yt(t))}const p=e.transformExpression(t.expression);if(n){const r=ri(e,p,n,t.expression);return{expression:Le(r,de(o),t),thisValue:r}}if(t.expression.kind===i.SyntaxKind.SuperKeyword){const n=e.checker.getSymbolAtLocation(t);if(n&&n.flags&i.SymbolFlags.GetAccessor)return{expression:Gt(e,Ce.DescriptorGet,t,ke("self"),p,de(o))}}return{expression:Le(p,de(o),t)}}function ns(e,t){return Le(ke("__TS__Promise"),de(e),t)}function rs(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;const r=[];if(i.isStringLiteral(t)){const n=function(e,t){const n=e.checker.getSymbolAtLocation(t);return!!n&&Qn(n).has(zn.NoResolution)}(e,t)?"@NoResolution:".concat(t.text):t.text;r.push(de(n))}return Ae(ke("require"),r,n)}function is(e,t){return e.resolver.isReferencedAliasDeclaration(t)}function ss(e,t,n,r){return function(e,t,n){if(n&&!(n.parameters.length<t.length))for(const[r,i]of t.entries()){const t=n.parameters[r];if(void 0!==t.valueDeclaration){const n=e.checker.getTypeAtLocation(t.valueDeclaration),r=e.checker.getTypeAtLocation(i);mr(e,i,r,n,t.name)}}}(e,t,n),mi(e,r?[r,...t]:t)}function os(e,t,n,r,i){let s,o=e.transformExpression(t);return i&&(s=e.transformExpression(i)),r.length>0&&(s&&(s=li(e,s,i)),o=li(e,o,t),e.addPrecedingStatements(r)),s&&n.unshift(s),[o,n]}function as(e,t,n,r,i){const{precedingStatements:s,result:o}=hr(e,()=>ss(e,n,r,i));return os(e,t,o,s)}function cs(e,t,n){if(i.isOptionalChain(t))return ai(e,t);const r=i.isCallExpression(t)?us(t):t.tag;let{precedingStatements:s,result:o}=hr(e,()=>ss(e,n));if(i.isPropertyAccessExpression(r)&&i.isIdentifier(r.name)&&Bs(r.name.text,e.options)&&0===s.length){const n=e.transformExpression(r.expression);let i=r.name.text;const s=e.checker.getSymbolAtLocation(r),a=Ss(e,s);return a&&(i=a),function(e,t,n,r){const i=K(C.MethodCallExpression,r);return i.prefixExpression=e,i.name=t,i.params=n,i}(n,ke(i,r.name),o,t)}if(i.isElementAccessExpression(r)||i.isPropertyAccessExpression(r)){if(function(e){return!(i.isLiteralExpression(e)||i.isIdentifier(e)||e.kind===i.SyntaxKind.ThisKeyword)}(r.expression))return function(e,t,n,r){const s=ke(e.createTempName("self")),o=U(s,e.transformExpression(t.expression));e.addPrecedingStatements(o);let a=Le(s,i.isElementAccessExpression(t)?Xi(e,t):de(t.name.text));return r.length>0&&(a=li(e,a),e.addPrecedingStatements(r)),Ae(a,[s,...n])}(e,r,o,s);{let n;return[n,o]=os(e,r,o,s,r.expression),Ae(n,o,t)}}if(i.isIdentifier(r)||i.isCallExpression(r)){const n=e.isStrict?i.factory.createNull():i.factory.createIdentifier("_G");let a;return[a,o]=os(e,r,o,s,n),Ae(a,o,t)}throw new Error("Unsupported LeftHandSideExpression kind: ".concat(i.SyntaxKind[r.kind]))}function us(e){return i.skipOuterExpressions(e.expression)}function ls(e,t,n){if(e.luaTarget===I.Lua50){return Ae(Le(ke("table"),de("getn")),[t],n)}return Te(t,C.LengthOperator,n)}const ps=e=>i.isStringLiteral(e)&&e.text.includes("%");function ds(e,t){const n=ke("string");for(var r=arguments.length,i=new Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];return Ae(Le(n,de(e)),i,t)}const fs=new Set(["Error","ErrorConstructor","RangeError","RangeErrorConstructor","ReferenceError","ReferenceErrorConstructor","SyntaxError","SyntaxErrorConstructor","TypeError","TypeErrorConstructor","URIError","URIErrorConstructor"]);function ms(e,t){const n=t.symbol;if(!n||n.parent)return;const r=n.name;switch(r){case"Map":case"MapConstructor":return void qt(e,Ce.Map);case"Set":case"SetConstructor":return void qt(e,Ce.Set);case"WeakMap":case"WeakMapConstructor":return void qt(e,Ce.WeakMap);case"WeakSet":case"WeakSetConstructor":return void qt(e,Ce.WeakSet);case"Promise":case"PromiseConstructor":return void qt(e,Ce.Promise)}fs.has(r)&&qt(e,Ce.Error)}function hs(e,t){if(t.isUnionOrIntersection())for(const n of t.types){const t=hs(e,n);if(t)return t}else if(pn(e,t,void 0))return t.symbol}const gs={[Lt.MultiFunction]:"$multi",[Lt.RangeFunction]:"$range",[Lt.VarargConstant]:"$vararg"};function ys(e,t){return xs(e,t,e.checker.getSymbolAtLocation(t))}function Ss(e,t){let n;if(t){const r=t.getDeclarations();if(r){let t;for(const n of r){const r=Zn(n).get(zn.CustomName);if(r){t=r;break}if(i.isImportSpecifier(n)&&!n.propertyName){const t=e.checker.getTypeAtLocation(n);if(t.symbol){const n=Ss(e,t.symbol);if(n)return n}}}t&&(n=t.args[0])}}return n}function xs(e,t,n){if(si(t)){const e=ke(t.text,void 0,Tr);return oi(t).usedIdentifiers.push(e),e}const r=n?Dt(e,n):Ct(e,t);if(r)if(Yi.has(r))i.isVariableDeclaration(t.parent)&&t.parent.name===t||e.diagnostics.push(yt(t));else if(function(e,t){return void 0!==e&&gs[t]===e.name}(n,r))return function(e,t,n){n===Lt.MultiFunction?e.diagnostics.push(mt(t)):n===Lt.RangeFunction?e.diagnostics.push(tt(t)):n===Lt.VarargConstant&&e.diagnostics.push(nt(t))}(e,t,r),Ne(t);const s=e.checker.getTypeAtLocation(t);if(pn(e,s,void 0)&&(ms(e,s),function(e,t){if("Promise"!==t.text)return!1;const n=e.checker.getTypeAtLocation(t);return pn(e,n,void 0)}(e,t)))return ke("__TS__Promise",t);let o=Gs(e,t,n)?Us(t.text):t.text;const a=Ss(e,n);a&&(o=a);return ke(o,t,An(e,t,n),t.text)}function Ts(e,t,n){if(n){const r=ws(e,n);if(r){const i=n.name;return Cs(e,ke(Gs(e,t,n)?Us(i):i,t,An(e,t,n),i),r)}}const r=function(e,t,n){switch(t.text){case"NaN":return Un(t);case"Infinity":return e.luaTarget===I.Lua50?Ee(le(1),le(0),C.DivisionOperator):Le(ke("math"),de("huge"),t);case"globalThis":return ke("_G",t,An(e,t,n),"globalThis")}}(e,t,n);return r||xs(e,t,n)}function vs(e,t){if(!i.isSourceFile(t.parent)&&i.isModuleDeclaration(t.parent)){return Le(vs(e,t.parent),de(Es(e,t).text),t.name)}return Es(e,t)}function Es(e,t){const n=e.checker.getSymbolAtLocation(t.name);return void 0!==n&&Vs(n.name,e.options)?ke(Us(t.name.text),t.name,n&&function(e,t){return e.symbolIdMaps.get(t)}(e,n),t.name.text):ys(e,t.name)}function bs(e){if(e.body){if(i.isModuleBlock(e.body))return e.body.statements.some(e=>!i.isInterfaceDeclaration(e)&&!i.isTypeAliasDeclaration(e));if(i.isModuleDeclaration(e.body))return!0}return!1}function As(e){var t;return i.canHaveModifiers(e)&&!0===(null===(t=e.modifiers)||void 0===t?void 0:t.some(e=>e.kind===i.SyntaxKind.DefaultKeyword))}function _s(e){return!!function(e){var t;return i.canHaveModifiers(e)&&!0===(null===(t=e.modifiers)||void 0===t?void 0:t.some(e=>e.kind===i.SyntaxKind.ExportKeyword))}(e)&&void 0===i.findAncestor(e,i.isModuleDeclaration)}const ks=e=>de("default",e);function Os(e){const t=e.getDeclarations();if(t)return t.find(e=>0!==(i.getCombinedModifierFlags(e)&i.ModifierFlags.Export))}function Ns(e,t){const n=function(e,t){if(void 0!==t.symbolId){const n=En(e,t.symbolId);if(void 0!==n)return n.symbol}}(e,t);if(n)return ws(e,n)}function ws(e,t){const n=Os(t);if(!n)return;const r=an(n,e=>i.isSourceFile(e)||i.isModuleDeclaration(e));if(r&&((!i.isModuleDeclaration(r)||0===(r.flags&i.NodeFlags.GlobalAugmentation))&&Ms(e,t,r)))return r}function Ls(e,t){const n=e.checker.getSymbolAtLocation(i.isSourceFile(t)?t:t.name);if(void 0===(null===n||void 0===n?void 0:n.exports))return[];return[...{[Symbol.iterator]:()=>n.exports.values()}]}function Fs(e,t){return Ls(e,e.sourceFile).filter(n=>{var r;return null===(r=n.declarations)||void 0===r?void 0:r.filter(i.isExportSpecifier).map(e.checker.getExportSpecifierLocalTargetSymbol).includes(t)})}function Is(e,t){return void 0!==Os(t)||Ms(e,t,e.sourceFile)}function Ms(e,t,n){return Ls(e,n).includes(t)}function Ps(e,t){const n=Ns(e,t);return n?Cs(e,t,n):t}function Cs(e,t,n){if(!t.exportable)return t;return Le(n&&i.isModuleDeclaration(n)?vs(e,n):Dn(),de(t.text))}function Ds(e){return Le(Dn(),ks(e),e)}const Ks=e=>e.luaTarget===I.LuaJIT,Bs=(e,t)=>!Rs.has(e)&&(Ks(t)?/^[a-zA-Z_\u007F-\uFFFD][a-zA-Z0-9_\u007F-\uFFFD]*$/:/^[a-zA-Z_][a-zA-Z0-9_]*$/).test(e),Rs=new Set(["and","break","do","else","elseif","end","false","for","function","goto","if","in","local","nil","not","or","repeat","return","then","true","until","while"]),js=new Set(["_G","assert","coroutine","debug","error","ipairs","math","pairs","pcall","print","rawget","repeat","require","self","string","table","tostring","type","unpack"]),Vs=(e,t)=>!Bs(e,t)||js.has(e);function Ws(e,t,n){const r=!Bs(t,e.options);return r&&""!==t&&e.diagnostics.push(dt(n,t)),r}function qs(e,t,n){var r,s;const o=null!==(r=null===(s=t.declarations)||void 0===s?void 0:s.some(e=>{return t=e,0!==(i.getCombinedModifierFlags(t)&i.ModifierFlags.Ambient);var t}))&&void 0!==r&&r;return!(!o||!Ws(e,t.name,n))||Vs(t.name,e.options)&&!o&&!Is(e,t)}function Gs(e,t,n){return n?qs(e,n,t):Ws(e,t.text,t)}const Us=e=>"____"+(e=>e.replace(/[^a-zA-Z0-9_]/g,e=>"_".concat(e.charCodeAt(0).toString(16).toUpperCase())))(e);const zs=(e,t)=>Ea(g(h(ga(e,t))));function Hs(e){const t=e.luaTarget===I.Lua50?"(table.getn(arg) > 0) and module(unpack(arg)) or module(file)":'(select("#", ...) > 0) and module(...) or module(file)';return"\nlocal ____modules = {}\nlocal ____moduleCache = {}\nlocal ____originalRequire = require\nlocal function require(file, ...)\n    if ____moduleCache[file] then\n        return ____moduleCache[file].value\n    end\n    if ____modules[file] then\n        local module = ____modules[file]\n        ____moduleCache[file] = { value = ".concat(t,' }\n        return ____moduleCache[file].value\n    else\n        if ____originalRequire then\n            return ____originalRequire(file)\n        else\n            error("module \'" .. file .. "\' not found")\n        end\n    end\nend\n')}const Js="{#SourceMapTracebackBundle}";function Qs(e){const t={};let n=1;e.walk((e,r)=>{if(void 0!==r.line&&r.line>0){const e=((e,n)=>{const r=t[e];return void 0===r?n:"number"===typeof r?r:r.line})(n,r.line);t[n]={line:e,file:o.default.basename(r.source)}}n+=e.split("\n").length-1});const r="{"+Object.entries(t).map(e=>{let[t,n]=e;return'["'.concat(t,'"] = ').concat("number"===typeof(r=n)?r:"{line = ".concat(r.line,', file = "').concat(r.file,'"}'));var r}).join(",")+"}";return"__TS__SourceMapTraceBack(debug.getinfo(1).short_src, ".concat(r,");")}function $s(e,t){var n,r,i;const s=[],a=e.getCompilerOptions(),c=x(a.luaBundle,S),u=x(a.luaBundleEntry,S),l=o.default.resolve(xa(e),u),p=o.default.resolve(Sa(e),c),d=null!==(n=null===(r=e.getSourceFile(u))||void 0===r?void 0:r.fileName)&&void 0!==n?n:null===(i=e.getSourceFile(l))||void 0===i?void 0:i.fileName;void 0===d&&s.push(_(u));const f=t.map(t=>function(e,t){let{code:n,sourceMapNode:r}=e;const i="[".concat(t,"] = function(...) \n");return Ys([i,null!==r&&void 0!==r?r:n," end,\n"])}(t,zs(t.fileName,e))),m=(h=f,Ys(["____modules = {\n",...h,"}\n"]));var h;const g=a.luaTarget===I.Lua50?"unpack(arg == nil and {} or arg)":"...",y="return require(".concat(zs(null!==d&&void 0!==d?d:u,e),", ").concat(g,")\n"),T=[];a.sourceMapTraceback&&(T.push('local __TS__SourceMapTraceBack = require("lualib_bundle").__TS__SourceMapTraceBack\n'),T.push("".concat(Js,"\n")));const v=[Hs(a),m,...T,y];a.noHeader||v.unshift(ba);const E=Ys(v);let{code:b,map:A}=E.toStringWithSourceMap();return b=b.replace(Js,Qs(E)),[s,{outputPath:p,code:b,sourceMap:A.toString(),sourceFiles:t.flatMap(e=>{var t;return null!==(t=e.sourceFiles)&&void 0!==t?t:[]})}]}function Ys(e){return new Ge.SourceNode(null,null,null,e)}function Zs(e){return function(e,t){const n=[];for(;t<e.length;){const r=e[t];if("r"!==r||0!==t&&!no(e[t-1])&&"]"!==e[t-1]&&"("!==e[t-1]&&"["!==e[t-1])'"'===r||"'"===r?t=eo(e,t,r).offset:"-"===r&&t+1<e.length&&"-"===e[t+1]?t=ro(e,t):t++;else{const r=Xs(e,t);r.matched?(t=r.match.to+1,n.push(r.match)):t=r.end}}return n}(e,0)}function Xs(e,t){const n=t;for(const o of"require"){if(t>e.length)return{matched:!1,end:t};if(e[t]!==o)return{matched:!1,end:t};t++}let r=!1;if((t=to(e,t))>e.length)return{matched:!1,end:t};if("("===e[t])r=!0,t=to(e,++t);else if('"'!==e[t]&&"'"!==e[t])return{matched:!1,end:t};if(t>e.length||'"'!==e[t]&&"'"!==e[t])return{matched:!1,end:t};const{value:i,offset:s}=eo(e,t,e[t]);if(t=s,r){if((t=to(e,t))>e.length||")"!==e[t])return{matched:!1,end:t};t++}return{matched:!0,match:{from:n,to:t-1,requirePath:i}}}function eo(e,t,n){io(e,t,n);let r=++t,i="",s=!1;for(;t<e.length&&(e[t]!==n||s);)"\\"!==e[t]||s?(e[t]===n&&(i+=e.slice(r,t-1),r=t),s=!1):s=!0,t++;return t<e.length&&io(e,t,n),i+=e.slice(r,t),{value:i,offset:t+1}}function to(e,t){for(;t<e.length&&no(e[t]);)t++;return t}function no(e){return" "===e||"\t"===e||"\r"===e||"\n"===e}function ro(e,t){return io(e,t,"-"),io(e,t+1,"-"),(t+=2)+1<e.length&&"["===e[t]&&"["===e[t+1]?function(e,t){for(;t<e.length&&("]"!==e[t]||"]"!==e[t-1]);)t++;return t+1}(e,t):function(e,t){for(;t<e.length&&"\n"!==e[t];)t++;return t+1}(e,t)}function io(e,t,n){if(e[t]!==n)throw new Error("Expected ".concat(n," at position ").concat(t," but found ").concat(e[t]))}class so{constructor(e,t,n){this.program=e,this.options=t,this.emitHost=n,this.diagnostics=[],this.resolvedFiles=new Map,this.processedDependencies=new Set,this.pathToFile=new Map}addAndResolveDependencies(e){if(!this.resolvedFiles.has(e.fileName)){this.resolvedFiles.set(e.fileName,e);for(const t of Zs(e.code).reverse())if(t.requirePath.startsWith("@NoResolution:")){if(!oo(this.program)){const n=t.requirePath.replace("@NoResolution:","");ao(e,t,n,this.options.extension),co(e,t,n,this.options.extension)}}else this.resolveImport(e,t)}}resolveImport(e,t){if("lualib_bundle"===t.requirePath)return void this.resolvedFiles.set("lualib_bundle",{fileName:"lualib_bundle",code:""});const n=this.resolveDependencyPath(e,t.requirePath);if(!n)return this.couldNotResolveImport(t,e);if(this.options.tstlVerbose&&console.log("Resolved ".concat(t.requirePath," to ").concat(m(n))),this.processDependency(n),r=n,!oo(this.program)||!po(r)){const r=ga(n,this.program);ao(e,t,r,this.options.extension),co(e,t,r,this.options.extension)}var r}formatPathToFile(e,t){var n;const r=["/","./","../"].some(t=>e.startsWith(t)),i=o.default.dirname(t.fileName),s=r?i:null!==(n=this.options.baseUrl)&&void 0!==n?n:i;return o.default.join(s,e)}processDependency(e){if(this.processedDependencies.has(e))return;if(this.processedDependencies.add(e),t=e,n=this.program,function(e,t){const n=h(e);return fo(n+".ts",t)||fo(n+".tsx",t)||fo(n+".json",t)}(t,n)||po(t)&&oo(n))return;var t,n;const r=this.emitHost.readFile(e);if(void 0===r)return void this.diagnostics.push(A(e));const i={fileName:e,code:r};this.addAndResolveDependencies(i)}couldNotResolveImport(e,t){const n=function(e,t,n){return g(o.default.normalize(o.default.join(o.default.relative(t,n),e.requirePath)).split(o.default.sep).filter(e=>"."!==e&&".."!==e).join(o.default.sep))}(e,ya(this.program),o.default.dirname(t.fileName));ao(t,e,n,this.options.extension),co(t,e,n,this.options.extension),this.diagnostics.push(b(e.requirePath,o.default.relative(xa(this.program),t.fileName)))}resolveDependencyPath(e,t){this.options.tstlVerbose&&console.log('Resolving "'.concat(t,'" from ').concat(m(e.fileName)));const n=e.fileName.endsWith(".lua"),r=n?t.replace(/\./g,o.default.sep):t;if(n&&po(e.fileName)){const t=this.resolveLuaDependencyPathFromNodeModules(e,r);if(t)return t}const i=this.formatPathToFile(r,e),s=this.getFileFromPath(i);if(s)return s;if(this.options.paths&&this.options.baseUrl){const e=this.tryGetModuleNameFromPaths(r,this.options.paths,this.options.baseUrl);if(e)return e}}resolveLuaDependencyPathFromNodeModules(e,t){const n=o.default.normalize(e.fileName).split(o.default.sep);let r=n.lastIndexOf("node_modules")+2,i=n.slice(0,r).join(o.default.sep);for(;r<n.length;){const e=o.default.join(i,t),s=this.getFileFromPath(e);if(s)return s;i=o.default.join(i,n[r++])}}getFileFromPath(e){const t=this.pathToFile.get(e);if(t)return t;if(!1===t)return;const n=this.searchForFileFromPath(e);return this.pathToFile.set(e,null!==n&&void 0!==n&&n),n}searchForFileFromPath(e){const t=[e,e+".ts",o.default.join(e,"index.ts"),e+".tsx",o.default.join(e,"index.tsx")];for(const r of t)if(fo(r,this.program))return r;const n=[e+".lua",o.default.join(e,"index.lua"),o.default.join(e,"init.lua")];for(const r of n)if(this.emitHost.fileExists(r))return r}tryGetModuleNameFromPaths(e,t,n){const r=ho(m(e));for(const[i,s]of Object.entries(t)){const e=mo(m(i)),t=e.indexOf("*");if(-1!==t){const i=e.substring(0,t),a=e.substring(t+1);if(r.length>=i.length+a.length&&r.startsWith(i)&&r.endsWith(a)||!a&&r===ho(i)){const e=r.substring(i.length,r.length-a.length);for(const t of s){const r=this.getFileFromPath(o.default.join(n,t.replace("*",e)));if(r)return r}}}else if(e===r)for(const r of s){const e=this.getFileFromPath(o.default.join(n,r));if(e)return e}}}}function oo(e){return e.getCompilerOptions().buildMode===M.Library}function ao(e,t,n,r){const i=uo(n,r);e.code=e.code=e.code.substring(0,t.from)+'require("'.concat(i,'")')+e.code.substring(t.to+1)}function co(e,t,n,r){const i=uo(n,r);e.sourceMapNode&&lo(e.sourceMapNode,e.sourceMapNode,'"'.concat(t.requirePath,'"'),'"'.concat(i,'"'))}function uo(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".lua";return t.startsWith(".")||(t=".".concat(t)),e.endsWith(t)?g(e.substring(0,e.length-t.length)):g(e)}function lo(e,t,n,r){if((!e.children||0===e.children.length)&&e.toString()===n)return t.children=[new Ge.SourceNode(e.line,e.column,e.source,[r])],!0;if(e.children)for(const i of e.children)if(lo(i,e,n,r))return!0;return!1}function po(e){return o.default.normalize(e).split(o.default.sep).some(e=>"node_modules"===e)}function fo(e,t){return void 0!==t.getSourceFile(e)}function mo(e){return e.includes(".")?h(e):e}function ho(e){return e.endsWith("/")||e.endsWith("\\")?e.substring(0,-1):e}function go(e,t){return e.transformStatements(i.isBlock(t)?t.statements:t)}function yo(e,t,n){e.pushScope(n);const r=In(e,e.transformStatements(t.statements)),i=e.popScope();return[W(r,t),i]}function So(e){var t;return!0===(null===(t=e.modifiers)||void 0===t?void 0:t.some(e=>e.kind===i.SyntaxKind.PrivateKeyword))}function xo(e){var t;return!0===(null===(t=e.modifiers)||void 0===t?void 0:t.some(e=>e.kind===i.SyntaxKind.StaticKeyword))}function To(e){var t;return null===(t=e.heritageClauses)||void 0===t?void 0:t.find(e=>e.token===i.SyntaxKind.ExtendsKeyword)}function vo(e){const t=To(e);if(t)return t.types[0]}function Eo(e,t){const n=[];for(const r of t){const{precedingStatements:t,result:i}=hr(e,()=>{const t=wi(e,r.name),n=r.initializer?e.transformExpression(r.initializer):void 0;return z(Le(Cn(),t),n,r)});n.push(...t,i)}return n}function bo(e,t,n){if(!t.initializer)return;const r=wi(e,t.name),i=e.transformExpression(t.initializer);return z(Le(Oe(n),r),i)}function Ao(e){return Le(Oe(e),de("prototype"))}function _o(e){return Le(Ao(e),de("____constructor"))}function ko(e,t,n,r,s){if(!t.body)return;const o=e.pushScope(_n.Function),a=bi(e,t.body),[c,u,l]=ki(e,t.parameters,Cn()),p=Ai(e,o,t.parameters,l),d=t.parameters.filter(e=>void 0!==e.modifiers),f=Eo(e,r);if((d.length>0||f.length>0)&&t.body&&t.body.statements.length>0){const e=t.body.statements.findIndex(e=>i.isExpressionStatement(e)&&i.isCallExpression(e.expression)&&e.expression.expression.kind===i.SyntaxKind.SuperKeyword);-1!==e&&p.push(...a.splice(0,e+1))}for(const g of d)if(i.isIdentifier(g.name)){const t=z(Le(Cn(),de(g.name.text)),ys(e,g.name));p.push(t)}p.push(...f),p.push(...a);const m=W(p),h=-1===t.pos;return e.popScope(),z(_o(n),he(m,c,u,D.Declaration),h?s:t)}function Oo(e,t){return xo(e)?Oe(t):Ao(t)}function No(e,t){const n=wi(e,t.name);return pe(n)&&"toString"===n.value?de("__tostring",t.name):n}function wo(e,t,n){var r,s;if(!t.body)return[];const o=Oo(t,n),a=No(e,t),[c]=Oi(e,t),u=(null!==(r=null===(s=i.getDecorators(t))||void 0===s?void 0:s.length)&&void 0!==r?r:0)>0,l=t.parameters.some(e=>{var t,n;return(null!==(t=null===(n=i.getDecorators(e))||void 0===n?void 0:n.length)&&void 0!==t?t:0)>0});return u||l?e.options.experimentalDecorators?[z(Le(o,a),c),ne(Fo(e,t,c,n))]:[z(Le(o,a),Fo(e,t,c,n),t)]:[z(Le(o,a),c,t)]}function Lo(e,t){const n=t.expression,r=e.checker.getTypeAtLocation(n);return dr(e,r)===rr.Void&&e.diagnostics.push(Xe(t)),e.transformExpression(n)}function Fo(e,t,n,r){var s,o;const a=Co(e,t),c=null!==(s=null===(o=i.getDecorators(t))||void 0===o?void 0:o.map(t=>Lo(e,t)))&&void 0!==s?s:[],u=No(e,t);if(e.options.experimentalDecorators){const n=Oo(t,r);return Po(e,t.kind,[...c,...a],n,u)}return Mo(e,r,n,c,{kind:de("method"),name:u,private:se(So(t)),static:se(xo(t))})}function Io(e,t,n){var r;const s=null!==(r=i.getDecorators(t))&&void 0!==r?r:[],o=s.map(t=>Lo(e,t));if(e.options.experimentalDecorators){const r=wi(e,t.name),i=Oo(t,n);return Po(e,t.kind,o,i,r)}for(const a of s){const n=e.checker.getResolvedSignature(a),r=null===n||void 0===n?void 0:n.getReturnType();r&&0===(r.flags&i.TypeFlags.Void)&&e.diagnostics.push(Ot(t))}return Mo(e,n,ie(),o,{kind:de("field"),name:de(t.name.getText()),private:se(So(t)),static:se(xo(t))})}function Mo(e,t,n,r,i){const s=Se(r.map(e=>ye(e))),o=(a=i,Se(Object.entries(a).map(e=>{let[t,n]=e;return ye(n,de(t))})));var a;return Gt(e,Ce.Decorate,void 0,t,n,s,o)}function Po(e,t,n,r,s){const o=[Se(n.map(e=>ye(e))),r];if(s){o.push(s);const e=t===i.SyntaxKind.MethodDeclaration||t===i.SyntaxKind.GetAccessor||t===i.SyntaxKind.SetAccessor;o.push(e?se(!0):ie())}return Gt(e,Ce.DecorateLegacy,void 0,...o)}function Co(e,t){return t.parameters.flatMap((n,r)=>{var s;return null===(s=i.getDecorators(n))||void 0===s?void 0:s.map(n=>Gt(e,Ce.DecorateParam,t,le(r),Lo(e,n)))}).filter(S)}function Do(e,t,n){var r;const[s,o,a]=ki(e,t.parameters,Cn()),c=he(W(t.body?_i(e,t.parameters,t.body,a)[0]:[]),s,o,D.Declaration);return null!==(r=i.getDecorators(t))&&void 0!==r&&r.length?function(e,t,n,r){var s,o;const a=null!==(s=null===(o=i.getDecorators(t))||void 0===o?void 0:o.map(t=>Lo(e,t)))&&void 0!==s?s:[],c=wi(e,t.name);if(e.options.experimentalDecorators){const n=Oo(t,r);return Po(e,t.kind,a,n,c)}return Mo(e,r,n,a,{kind:de(t.kind===i.SyntaxKind.SetAccessor?"setter":"getter"),name:c,private:se(So(t)),static:se(xo(t))})}(e,t,c,n):c}function Ko(e,t,n){let{firstAccessor:r,getAccessor:i,setAccessor:s}=t;const o=wi(e,r.name),a=Se([]);if(i){const t=Do(e,i,n);a.fields.push(ye(t,de("get")))}if(s){const t=Do(e,s,n);a.fields.push(ye(t,de("set")))}const c=xo(r),u=c?Oe(n):Ao(n),l=c?Ce.ObjectDefineProperty:Ce.SetDescriptor,p=[u,o,a];c||p.push(se(!0));return ne(Gt(e,l,void 0,...p))}function Bo(e,t,n,r,s){const o=[],a=Gt(e,Ce.Class,t),c=As(t)?Le(Dn(),ks(t)):void 0;if(c?o.push(z(c,a,t)):o.push(...Gn(e,n,a,t)),c)o.push(U(r,c));else{const t=Ns(e,n);t&&o.push(U(r,Cs(e,Oe(n),t)))}if(o.push(z(Le(Oe(r),de("name")),function(e,t){if(e.name)return de(e.name.text);if(i.isVariableDeclaration(e.parent)&&i.isIdentifier(e.parent.name))return de(e.parent.name.text);if(As(e))return de("default");if(vo(e))return Le(t,de("name"));return de("")}(t,n),t)),s){const n=vo(t);o.push(ne(Gt(e,Ce.ClassExtends,To(t),Oe(r),e.transformExpression(n.expression))))}return o}function Ro(e,t){const{statements:n,name:r}=jo(e,t);return t.addPrecedingStatements(n),r}function jo(e,t,n){let r;r=void 0!==n?n:void 0!==e.name?ys(t,e.name):ke(t.createTempName("class"),e);const s=vo(e),o=function(e,t){const n=vo(t);return n&&e.checker.getTypeAtLocation(n)}(t,e);t.classSuperInfos.push({className:r,extendedTypeNode:s});const a=e.members.filter(i.isPropertyDeclaration).filter(e=>e.initializer).filter(e=>!xo(e)),c=[];let u;Vs(r.text,t.options)?(u=ke(Us(r.text),void 0,r.symbolId,r.text),B(u,r)):u=r,c.push(...Bo(t,e,r,u,o));const l=e.members.find(e=>i.isConstructorDeclaration(e)&&void 0!==e.body);if(l){const n=ko(t,l,u,a,e);n&&c.push(n);const r=function(e,t,n){const r=Co(e,t);if(r.length>0)return ne(Po(e,t.kind,r,n))}(t,l,u);r&&c.push(r)}else if(o){if(a.length>0){const n=Eo(t,a),r=t.luaTarget===I.Lua50?Ae(ke("unpack"),[ce()]):ae(),s=ne(Ae(Le(t.transformExpression(i.factory.createSuper()),de("____constructor")),[Cn(),r]));n.unshift(s);const o=he(W(n),[Cn()],ae(),D.Declaration);c.push(z(_o(u),o,e))}}else{const n=ko(t,i.factory.createConstructorDeclaration([],[],i.factory.createBlock([],!0)),u,a,e);n&&c.push(n)}for(const d of e.members)if(i.isMethodDeclaration(d)){const e=wo(t,d,u);c.push(...e)}for(const d of e.members)if(i.isAccessor(d)){const n=t.checker.getSymbolAtLocation(d.name);if(!n)continue;const r=Vo(e,n,t);if(r.firstAccessor!==d)continue;const i=Ko(t,r,u);i&&c.push(i)}else if(i.isPropertyDeclaration(d)){var p;if(xo(d)){const e=bo(t,d,u);e&&c.push(e)}null!==(p=i.getDecorators(d))&&void 0!==p&&p.length&&c.push(ne(Io(t,d,r)))}else if(i.isClassStaticBlockDeclaration(d)&&d.body.statements.length>0){const e=Ae(he(W(t.transformStatements(d.body.statements)),[ke("self")]),[u]);c.push(ne(e,d))}if(i.canHaveDecorators(e)&&i.getDecorators(e)){const n=function(e,t,n){var r,s,o,a;const c=null!==(r=null===(s=i.getDecorators(t))||void 0===s?void 0:s.map(t=>Lo(e,t)))&&void 0!==r?r:[];return e.options.experimentalDecorators?Po(e,t.kind,c,n):Mo(e,n,n,c,{kind:de("class"),name:de(null!==(o=null===(a=t.name)||void 0===a?void 0:a.getText())&&void 0!==o?o:"")})}(t,e,u),r=z(u,n);if(c.push(r),_s(e)){const n=z(As(e)?Ds(e):Cs(t,u),u);c.push(n)}}return t.classSuperInfos.pop(),{statements:c,name:r}}function Vo(e,t,n){const r=e.members.find(e=>i.isGetAccessor(e)&&n.checker.getSymbolAtLocation(e.name)===t),s=e.members.find(e=>i.isSetAccessor(e)&&n.checker.getSymbolAtLocation(e.name)===t);return{firstAccessor:r&&(!s||r.pos<s.pos)?r:s,setAccessor:s,getAccessor:r}}function Wo(e,t){!1!==t.options.strictNullChecks&&(i.isElementAccessExpression(e)||sn(t,t.checker.getTypeAtLocation(e))||t.diagnostics.push(St(e)))}function qo(e,t){const[n,r]=yo(e,t.block,_n.Catch),i=t.variableDeclaration?ys(e,t.variableDeclaration.name):void 0;return[he(n,i?[Oe(i)]:[]),r]}function Go(e,t){e.pushScope(_n.Loop);const n=In(e,go(e,t.statement)),r=e.popScope(),i=r.id;switch(r.loopContinued){case void 0:case kn.WithContinue:return n;case kn.WithGoto:return[q(n),Y("__continue".concat(i))];case kn.WithRepeatBreak:const e=ke("__continue".concat(i)),t=se(!0),r=[];let s=!1;for(const i of n)if(r.push(i),ee(i)){s=!0;break}return s||r.push(z(e,t)),[q([U(e),Q(W(r),t),H(Te(e,C.NotOperator),W([te()]))])]}}function Uo(e,t){return xi(e,t),0===t.declarations.length?i.factory.createIdentifier("____"):t.declarations[0].name}function zo(e,t,n){const r=ke("____value");if(e.pushScope(_n.LoopInitializer),i.isVariableDeclarationList(t)){const s=Uo(e,t);if(!i.isArrayBindingPattern(s)&&!i.isObjectBindingPattern(s))return e.popScope(),ys(e,s);{const{precedingStatements:t,result:i}=hr(e,()=>yi(e,s,r));n.statements.unshift(...t,...i)}}else n.statements.unshift(...Ut(t)?br(e,t,r,!1):Lr(e,t,r));return e.popScope(),r}function Ho(e){if(xe(e)&&e.operator===C.NotOperator)return e.operand;{const t=Te(e,C.NotOperator);return B(t,j(e)),t}}function Jo(e,t,n,r,s){e.pushPrecedingStatements();let o=[];if(i.isVariableDeclarationList(t.initializer)){const n=Uo(e,t.initializer);i.isArrayBindingPattern(n)?o=n.elements.map(t=>gi(e,t)):e.diagnostics.push(s(n))}else i.isArrayLiteralExpression(t.initializer)?(o=t.initializer.elements.map((e,t)=>ke("____value".concat(t))),o.length>0&&n.statements.unshift(z(t.initializer.elements.map(t=>x(e.transformExpression(t),Fe)),o))):e.diagnostics.push(s(t.initializer));return 0===o.length&&o.push(Ne()),n.statements.unshift(...e.popPrecedingStatements()),$(n,o,[r],t)}function Qo(e,t){return function(e,t){return i.isIdentifier(t)&&"$range"===t.text&&Ct(e,t)===Lt.RangeFunction}(e,t.expression)}function $o(e,t,n){var r;i.isCallExpression(t.expression);const s=null!==(r=function(e,t){if(!i.isVariableDeclarationList(t.initializer))return void e.diagnostics.push(rt(t.initializer));const n=Uo(e,t.initializer);if(i.isIdentifier(n))return ys(e,n);e.diagnostics.push(rt(t.initializer))}(e,t))&&void 0!==r?r:Ne(t.initializer),[o=le(0),a=le(0),c]=ss(e,t.expression.arguments,e.checker.getResolvedSignature(t.expression));return function(e,t,n,r,i,s){const o=K(C.ForStatement,s);return o.body=e,o.controlVariable=t,o.controlVariableInitializer=n,o.limitExpression=r,o.stepExpression=i,o}(n,s,o,a,c,t)}function Yo(e,t){t.moduleSpecifier;const n=rs(e,t.moduleSpecifier);if(t.exportClause&&i.isNamespaceExport(t.exportClause)){return z(Le(Dn(),de(t.exportClause.name.text)),n)}const r=[],s=ke("____export"),o=U(s,n);r.push(o);const a=ke("____exportKey"),c=ke("____exportValue"),u=W([z(Le(Dn(),a),c)]),l=H(Ee(Oe(a),de("default"),C.InequalityOperator),u),p=ke("pairs"),d=$(W([l]),[Oe(a),Oe(c)],[Ae(p,[Oe(s)])]);return r.push(d),q(r,t)}function Zo(e,t){var n;const r=t.name,s=null!==(n=t.propertyName)&&void 0!==n?n:t.name;let o;if(i.isIdentifier(s)){const n=e.checker.getExportSpecifierLocalTargetSymbol(t);o=Li(e,n,s)}else o=de(r.text,s);if((e=>e.name&&i.isIdentifier(e.name)&&i.identifierToKeywordKind(e.name)===i.SyntaxKind.DefaultKeyword||e.propertyName&&i.isIdentifier(e.propertyName)&&i.identifierToKeywordKind(e.propertyName)===i.SyntaxKind.DefaultKeyword)(t)){return z(Ds(t),o,t)}return z(Le(Dn(),de(r.text),r),o,t)}const Xo=e=>{for(const t of e){if(i.isBreakStatement(t)||i.isReturnStatement(t))return!0;if(i.isBlock(t)&&Xo(t.statements))return!0;if(t.kind===i.SyntaxKind.SyntaxList){const e=[];if(i.forEachChild(t,t=>e.push(t)),Xo(e))return!0}}return!1},ea=(e,t,n,r)=>r.length>0?Zr(e,t,n,r,i.SyntaxKind.BarBarToken):{precedingStatements:r,result:Ee(t,n,C.OrOperator)},ta=(e,t,n,r,i)=>{const{precedingStatements:s,result:o}=hr(i,()=>i.transformExpression(r)),a=Ee(n,o,C.EqualityOperator);return e?ea(i,e,a,s):{precedingStatements:[...t,...s],result:a}};function na(e){let t=e.getText();const n=e.kind===i.SyntaxKind.NoSubstitutionTemplateLiteral||e.kind===i.SyntaxKind.TemplateTail;return t=t.substring(1,t.length-(n?1:2)),t=t.replace(/\r\n?/g,"\n"),t}const ra=(e,t)=>(i.isConstTypeReference(e.type)||mr(t,e,t.checker.getTypeAtLocation(e.expression),t.checker.getTypeAtLocation(e.type)),t.transformExpression(e.expression)),ia={[i.SyntaxKind.TypeAliasDeclaration]:()=>{},[i.SyntaxKind.InterfaceDeclaration]:()=>{},[i.SyntaxKind.NonNullExpression]:(e,t)=>t.transformExpression(e.expression),[i.SyntaxKind.ExpressionWithTypeArguments]:(e,t)=>t.transformExpression(e.expression),[i.SyntaxKind.SatisfiesExpression]:(e,t)=>t.transformExpression(e.expression),[i.SyntaxKind.AsExpression]:ra,[i.SyntaxKind.TypeAssertionExpression]:ra,[i.SyntaxKind.NotEmittedStatement]:()=>{}},sa=(0,s.A)((0,s.A)((0,s.A)({},Ii),ia),{},{[i.SyntaxKind.ArrowFunction]:Ni,[i.SyntaxKind.AwaitExpression]:(e,t)=>{Ht(e)||t.diagnostics.push(Tt(e));const n=t.transformExpression(e.expression);return Gt(t,Ce.Await,e,n)},[i.SyntaxKind.BinaryExpression]:(e,t)=>{const n=e.operatorToken.kind,r=function(e,t){const n=t.operatorToken.kind;if(n!==i.SyntaxKind.EqualsEqualsToken&&n!==i.SyntaxKind.EqualsEqualsEqualsToken&&n!==i.SyntaxKind.ExclamationEqualsToken&&n!==i.SyntaxKind.ExclamationEqualsEqualsToken)return;let r,s;if(i.isTypeOfExpression(t.left))s=t.left,r=t.right;else{if(!i.isTypeOfExpression(t.right))return;s=t.right,r=t.left}const o=e.transformExpression(r);if(!pe(o))return;"object"===o.value?o.value="table":"undefined"===o.value&&(o.value="nil");const a=e.transformExpression(s.expression),c=Ae(ke("type"),[a],s),{precedingStatements:u,result:l}=Xr(e,c,o,[],n,t);return e.addPrecedingStatements(u),l}(t,e);if(r)return r;if(Wr(n)){const r=qr(n);return Gr(t,e,e.left,e.right,r,!1)}switch(n){case i.SyntaxKind.EqualsToken:return function(e,t){const n=e.checker.getTypeAtLocation(t.right),r=e.checker.getTypeAtLocation(t.left);if(mr(e,t.right,n,r),Er(e,t.left))return Gt(e,Ce.ArraySetLength,t,e.transformExpression(t.left.expression),e.transformExpression(t.right));if(zt(t)){const{statements:n,result:r}=Ir(e,t);return e.addPrecedingStatements(n),r}if(i.isPropertyAccessExpression(t.left)||i.isElementAccessExpression(t.left)){const{precedingStatements:n,result:r}=hr(e,()=>e.transformExpression(t.right)),i=wr(e,t.left,n.length>0);e.addPrecedingStatements(n);const s=li(e,r,t.right);return e.addPrecedingStatements(z(i,s,t.left)),s}{const n=e.transformExpression(t.left),r=e.transformExpression(t.right);return e.addPrecedingStatements(Lr(e,t.left,r)),n}}(t,e);case i.SyntaxKind.InKeyword:{const n=t.transformExpression(e.left);return Ee(Le(t.transformExpression(e.right),n),ie(),C.InequalityOperator,e)}case i.SyntaxKind.InstanceOfKeyword:{const n=t.transformExpression(e.left),r=t.transformExpression(e.right),i=t.checker.getTypeAtLocation(e.right);return pn(t,i,"ObjectConstructor")?Gt(t,Ce.InstanceOfObject,e,n):Gt(t,Ce.InstanceOf,e,n,r)}case i.SyntaxKind.CommaToken:{const n=t.transformStatements(i.factory.createExpressionStatement(e.left)),{precedingStatements:r,result:s}=hr(t,()=>t.transformExpression(e.right));return n.push(...r),t.addPrecedingStatements(n),s}case i.SyntaxKind.QuestionQuestionToken:case i.SyntaxKind.AmpersandAmpersandToken:case i.SyntaxKind.BarBarToken:{const{precedingStatements:r,result:i}=function(e,t,n){const r=e.transformExpression(t.left),{precedingStatements:i,result:s}=hr(e,()=>e.transformExpression(t.right));return Xr(e,r,s,i,n,t)}(t,e,n);return t.addPrecedingStatements(r),i}}const{precedingStatements:s,result:[o,a]}=hr(t,()=>hi(t,[e.left,e.right])),{precedingStatements:c,result:u}=Xr(t,o,a,s,n,e);return t.addPrecedingStatements(c),u},[i.SyntaxKind.Block]:(e,t)=>{t.pushScope(_n.Block);const n=In(t,t.transformStatements(e.statements));return t.popScope(),q(n,e)},[i.SyntaxKind.BreakStatement]:(e,t)=>te(e),[i.SyntaxKind.CallExpression]:(e,t)=>{var n;const r=us(e);if(r.kind===i.SyntaxKind.ImportKeyword)return((e,t)=>{qt(t,Ce.Promise);const n=e.arguments.length>0?rs(t,e.arguments[0],e):ie();return Ae(ns("resolve",e),[n],e)})(e,t);if(i.isOptionalChain(e))return ai(t,e);const s=i.isIdentifier(r)?oi(r):void 0,o=yn(t,e)&&xn(t,e),a=null!==(n=function(e,t){const n=e.checker.getTypeAtLocation(t.expression);if(i.isIdentifier(t.expression)&&pn(e,n,void 0)){ms(e,n);const r=function(e,t,n){function r(){const n=e.checker.getResolvedSignature(t);return ss(e,t.arguments,n)}const i=n.symbol.name;switch(i){case"SymbolConstructor":return Gt(e,Ce.Symbol,t,...r());case"NumberConstructor":return Gt(e,Ce.Number,t,...r());case"StringConstructor":return function(e){const t=ke("tostring",e.expression);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return Ae(t,r,e)}(t,...r());case"isNaN":case"isFinite":const s=Yt(e,n)?r():[Gt(e,Ce.Number,void 0,...r())];return Gt(e,"isNaN"===i?Ce.NumberIsNaN:Ce.NumberIsFinite,t,...s);case"parseFloat":return Gt(e,Ce.ParseFloat,t,...r());case"parseInt":return Gt(e,Ce.ParseInt,t,...r())}}(e,t,n);if(r)return r}const r=i.getOriginalNode(us(t));if(i.isPropertyAccessExpression(r)){const n=function(e,t,n){const r=e.checker.getTypeAtLocation(n.expression),i=hs(e,r);if(!i||i.parent)return;let s;switch(i.name){case"ArrayConstructor":s=function(e,t,n){const r=e.checker.getResolvedSignature(t),i=ss(e,t.arguments,r),s=n.name.text;switch(s){case"from":return Gt(e,Ce.ArrayFrom,t,...i);case"isArray":return Gt(e,Ce.ArrayIsArray,t,...i);case"of":return Vn(...i);default:e.diagnostics.push(pt(n.name,"Array",s))}}(e,t,n);break;case"Console":s=function(e,t,n){const r=n.name.text,i=e.checker.getResolvedSignature(t),s=ss(e,t.arguments,i);switch(r){case"error":case"info":case"log":case"warn":if(t.arguments.length>0&&ps(t.arguments[0])){const e=Ae(Le(ke("string"),de("format")),s);return Ae(ke("print"),[e])}return Ae(ke("print"),s);case"assert":if(t.arguments.length>1&&ps(t.arguments[1])){const e=Ae(Le(ke("string"),de("format")),s.slice(1));return Ae(ke("assert"),[s[0],e])}return Ae(ke("assert"),s);case"trace":if(t.arguments.length>0&&ps(t.arguments[0])){const e=Ae(Le(ke("string"),de("format")),s),t=Ae(Le(ke("debug"),de("traceback")),[e]);return Ae(ke("print"),[t])}const i=Ae(Le(ke("debug"),de("traceback")),s);return Ae(ke("print"),[i]);default:e.diagnostics.push(pt(n.name,"console",r))}}(e,t,n);break;case"MapConstructor":s=function(e,t,n){const r=ss(e,t.arguments),i=n.name.text;if("groupBy"===i)return Gt(e,Ce.MapGroupBy,t,...r);e.diagnostics.push(pt(n.name,"Map",i))}(e,t,n);break;case"Math":s=function(e,t,n){const r=e.checker.getResolvedSignature(t),i=ss(e,t.arguments,r),s=ke("math"),o=n.name.text;switch(o){case"atan2":if(e.luaTarget===I.Universal)return Gt(e,Ce.MathAtan2,t,...i);return Ae(Le(s,de(e.luaTarget===I.Lua53?"atan":"atan2")),i,t);case"log10":case"log2":return Ee(Ae(Le(s,de("log")),i),le("log10"===o?Math.LN10:Math.LN2),C.DivisionOperator,t);case"log1p":{var a;const e=de("log"),n=Ee(le(1),null!==(a=i[0])&&void 0!==a?a:ie(),C.AdditionOperator);return Ae(Le(s,e),[n],t)}case"pow":var c,u;return Ee(null!==(c=i[0])&&void 0!==c?c:ie(),null!==(u=i[1])&&void 0!==u?u:ie(),C.PowerOperator,t);case"round":{var l;const e=de("floor"),n=le(.5),r=Ee(null!==(l=i[0])&&void 0!==l?l:ie(),n,C.AdditionOperator);return Ae(Le(s,e),[r],t)}case"sign":return Gt(e,Ce.MathSign,t,...i);case"trunc":return Gt(e,Ce.MathTrunc,t,...i);case"abs":case"acos":case"asin":case"atan":case"ceil":case"cos":case"exp":case"floor":case"log":case"max":case"min":case"random":case"sin":case"sqrt":case"tan":return Ae(Le(s,de(o)),i,t);default:e.diagnostics.push(pt(n.name,"Math",o))}}(e,t,n);break;case"StringConstructor":s=function(e,t,n){const r=e.checker.getResolvedSignature(t),i=ss(e,t.arguments,r),s=n.name.text;if("fromCharCode"===s)return Ae(Le(ke("string"),de("char")),i,t);e.diagnostics.push(pt(n.name,"String",s))}(e,t,n);break;case"ObjectConstructor":s=function(e,t,n){const r=ss(e,t.arguments),i=n.name.text;switch(i){case"assign":return Gt(e,Ce.ObjectAssign,t,...r);case"defineProperty":return Gt(e,Ce.ObjectDefineProperty,t,...r);case"entries":return Gt(e,Ce.ObjectEntries,t,...r);case"fromEntries":return Gt(e,Ce.ObjectFromEntries,t,...r);case"getOwnPropertyDescriptor":return Gt(e,Ce.ObjectGetOwnPropertyDescriptor,t,...r);case"getOwnPropertyDescriptors":return Gt(e,Ce.ObjectGetOwnPropertyDescriptors,t,...r);case"groupBy":return Gt(e,Ce.ObjectGroupBy,t,...r);case"keys":return Gt(e,Ce.ObjectKeys,t,...r);case"values":return Gt(e,Ce.ObjectValues,t,...r);default:e.diagnostics.push(pt(n.name,"Object",i))}}(e,t,n);break;case"SymbolConstructor":s=function(e,t,n){const r=e.checker.getResolvedSignature(t),i=ss(e,t.arguments,r),s=n.name.text;switch(s){case"for":case"keyFor":qt(e,Ce.SymbolRegistry);const r=s[0].toUpperCase()+s.slice(1);return Ae(ke("__TS__SymbolRegistry".concat(r)),i,t);default:e.diagnostics.push(pt(n.name,"Symbol",s))}}(e,t,n);break;case"NumberConstructor":s=function(e,t,n){const r=ss(e,t.arguments),i=n.name.text;switch(i){case"isInteger":return Gt(e,Ce.NumberIsInteger,t,...r);case"isNaN":return Gt(e,Ce.NumberIsNaN,t,...r);case"isFinite":return Gt(e,Ce.NumberIsFinite,t,...r);case"parseInt":return Gt(e,Ce.NumberParseInt,t,...r);case"parseFloat":return Gt(e,Ce.NumberParseFloat,t,...r);default:e.diagnostics.push(pt(n.name,"Number",i))}}(e,t,n);break;case"PromiseConstructor":s=function(e,t,n){const r=e.checker.getResolvedSignature(t),i=ss(e,t.arguments,r),s=n.name.text;switch(s){case"all":return Gt(e,Ce.PromiseAll,t,...i);case"allSettled":return Gt(e,Ce.PromiseAllSettled,t,...i);case"any":return Gt(e,Ce.PromiseAny,t,...i);case"race":return Gt(e,Ce.PromiseRace,t,...i);case"resolve":return qt(e,Ce.Promise),Ae(ns("resolve",n),i,t);case"reject":return qt(e,Ce.Promise),Ae(ns("reject",n),i,t);default:e.diagnostics.push(pt(n.name,"Promise",s))}}(e,t,n)}s&&n.questionDotToken&&e.diagnostics.push(vt(n));return s}(e,t,r);if(n)return n;const s=function(e,t,n){const r=e.checker.getTypeAtLocation(t.expression),s=hs(e,r);if(!s)return;const o=s.parent;if(!o||o.parent)return;switch(o.name){case"String":return function(e,t,n){var r;const i=e.checker.getResolvedSignature(t),[s,o]=as(e,n.expression,t.arguments,i),a=n.name.text;switch(a){case"replace":return Gt(e,Ce.StringReplace,t,s,...o);case"replaceAll":return Gt(e,Ce.StringReplaceAll,t,s,...o);case"concat":return Ae(Le(ke("table"),de("concat")),[Vn(s,...o)],t);case"indexOf":var c;return Ee(Ee(ds("find",t,s,null!==(c=o[0])&&void 0!==c?c:ie(),o[1]?Ae(Le(ke("math"),de("max")),[Kn(o[1],1),le(1)]):ie(),se(!0)),le(0),C.OrOperator),le(1),C.SubtractionOperator,t);case"substr":return Gt(e,Ce.StringSubstr,t,s,...o);case"substring":return Gt(e,Ce.StringSubstring,t,s,...o);case"slice":{const n=Bn(o[0]);if(o[0]&&void 0!==n){let e=[Kn(o[0],n<0?0:1)];if(o[1]){const t=Bn(o[1]);void 0!==t?e.push(Kn(o[1],t<0?-1:0)):e=void 0}if(e)return ds("sub",t,s,...e)}return Gt(e,Ce.StringSlice,t,s,...o)}case"toLowerCase":return ds("lower",t,s);case"toUpperCase":return ds("upper",t,s);case"trim":return Gt(e,Ce.StringTrim,t,s);case"trimEnd":case"trimRight":return Gt(e,Ce.StringTrimEnd,t,s);case"trimStart":case"trimLeft":return Gt(e,Ce.StringTrimStart,t,s);case"split":return Gt(e,Ce.StringSplit,t,s,...o);case"charAt":{const n=Bn(o[0]);if(void 0!==n&&n>=0){var u;const e=Kn(null!==(u=o[0])&&void 0!==u?u:ie(),1);return ds("sub",t,s,e,e)}return Gt(e,Ce.StringCharAt,t,s,...o)}case"charCodeAt":{const n=Bn(o[0]);var l;return void 0!==n&&n>=0?Ee(ds("byte",t,s,Kn(null!==(l=o[0])&&void 0!==l?l:ie(),1)),Un(),C.OrOperator):Gt(e,Ce.StringCharCodeAt,t,s,...o)}case"startsWith":return Gt(e,Ce.StringStartsWith,t,s,...o);case"endsWith":return Gt(e,Ce.StringEndsWith,t,s,...o);case"includes":return Gt(e,Ce.StringIncludes,t,s,...o);case"repeat":return ds("rep",t,s,Ae(Le(ke("math"),de("floor")),[null!==(r=o[0])&&void 0!==r?r:ie()]));case"padStart":return Gt(e,Ce.StringPadStart,t,s,...o);case"padEnd":return Gt(e,Ce.StringPadEnd,t,s,...o);case"toString":return;default:e.diagnostics.push(pt(n.name,"string",a))}}(e,t,n);case"Number":return function(e,t,n){const r=e.checker.getResolvedSignature(t),i=ss(e,t.arguments,r),s=e.transformExpression(n.expression),o=n.name.text;switch(o){case"toString":return 0===i.length?Ae(ke("tostring"),[s],t):Gt(e,Ce.NumberToString,t,s,...i);case"toFixed":return Gt(e,Ce.NumberToFixed,t,s,...i);default:e.diagnostics.push(pt(n.name,"number",o))}}(e,t,n);case"Array":case"ReadonlyArray":return function(e,t,n){const r=e.checker.getResolvedSignature(t),[s,o]=as(e,n.expression,t.arguments,r),a=n.name.text;switch(a){case"at":return Gt(e,Ce.ArrayAt,t,s,...o);case"concat":return Gt(e,Ce.ArrayConcat,t,s,...o);case"entries":return Gt(e,Ce.ArrayEntries,t,s);case"fill":return Gt(e,Ce.ArrayFill,t,s,...o);case"push":if(1===t.arguments.length){var c;const n=null!==(c=o[0])&&void 0!==c?c:ie();var u;if(function(e){return be(e)&&0!==(e.flags&D.TableUnpackCall)}(n))return Gt(e,Ce.ArrayPushArray,t,s,null!==(u=n.params[0])&&void 0!==u?u:ie());if(!oe(n))return function(e,t,n,r){const i=_e(n)?n:li(e,n);let s=Ee(ls(e,i),le(1),C.AdditionOperator);const o=un(t);o&&(s=li(e,s));const a=z(Le(i,s),r,t);return e.addPrecedingStatements(a),o?s:ie()}(e,t,s,n)}return Gt(e,Ce.ArrayPush,t,s,...o);case"reverse":return Gt(e,Ce.ArrayReverse,t,s);case"shift":return Ae(Le(ke("table"),de("remove")),[s,le(1)],t);case"unshift":return Gt(e,Ce.ArrayUnshift,t,s,...o);case"sort":return Gt(e,Ce.ArraySort,t,s,...o);case"pop":return Ae(Le(ke("table"),de("remove")),[s],t);case"forEach":return Gt(e,Ce.ArrayForEach,t,s,...o);case"find":return Gt(e,Ce.ArrayFind,t,s,...o);case"findIndex":return Gt(e,Ce.ArrayFindIndex,t,s,...o);case"includes":return Gt(e,Ce.ArrayIncludes,t,s,...o);case"indexOf":return Gt(e,Ce.ArrayIndexOf,t,s,...o);case"map":return Gt(e,Ce.ArrayMap,t,s,...o);case"filter":return Gt(e,Ce.ArrayFilter,t,s,...o);case"reduce":return Gt(e,Ce.ArrayReduce,t,s,...o);case"reduceRight":return Gt(e,Ce.ArrayReduceRight,t,s,...o);case"some":return Gt(e,Ce.ArraySome,t,s,...o);case"every":return Gt(e,Ce.ArrayEvery,t,s,...o);case"slice":return Gt(e,Ce.ArraySlice,t,s,...o);case"splice":return Gt(e,Ce.ArraySplice,t,s,...o);case"join":const r=e.checker.getTypeAtLocation(n.expression),p=e.checker.getElementTypeOfArrayType(r);if(p&&Jt(e,p,i.TypeFlags.StringLike|i.TypeFlags.NumberLike)){var l;const e=de(","),n=null!==(l=o[0])&&void 0!==l?l:ie(),r=[s,0===t.arguments.length?e:pe(n)?n:Ee(n,e,C.OrOperator)];return Ae(Le(ke("table"),de("concat")),r,t)}return Gt(e,Ce.ArrayJoin,t,s,...o);case"flat":return Gt(e,Ce.ArrayFlat,t,s,...o);case"flatMap":return Gt(e,Ce.ArrayFlatMap,t,s,...o);case"toReversed":return Gt(e,Ce.ArrayToReversed,t,s,...o);case"toSorted":return Gt(e,Ce.ArrayToSorted,t,s,...o);case"toSpliced":return Gt(e,Ce.ArrayToSpliced,t,s,...o);case"with":return Gt(e,Ce.ArrayWith,t,s,...o);default:e.diagnostics.push(pt(n.name,"array",a))}}(e,t,n);case"Function":case"CallableFunction":case"NewableFunction":return function(e,t,n){const r=e.checker.getTypeAtLocation(n.expression);dr(e,r)===rr.Void&&e.diagnostics.push(Ye(t));const i=e.checker.getResolvedSignature(t),[s,o]=as(e,n.expression,t.arguments,i),a=n.name.text;switch(a){case"apply":const r=o.length>1?[Rn(e,o[1],t.arguments[1])]:[];return Ae(s,[o[0],...r],t);case"bind":return Gt(e,Ce.FunctionBind,t,s,...o);case"call":return Ae(s,o,t);case"toString":e.diagnostics.push(pt(n.name,"function",a))}}(e,t,n)}}(e,t,r);if(s)return s;const o=function(e,t,n){switch(n.name.text){case"toString":return Ae(ke("tostring"),[e.transformExpression(n.expression)],t);case"hasOwnProperty":const r=e.transformExpression(n.expression),i=e.checker.getResolvedSignature(t),s=ss(e,t.arguments,i);return Ee(Ae(ke("rawget"),[r,...s]),ie(),C.InequalityOperator,t)}}(e,t,r);if(o)return o}}(t,e))&&void 0!==n?n:function(e,t){const n=Ct(e,t.expression);if(!n)return;const r=$i[n];return r?r(e,t,n):void 0}(t,e);if(a)return void 0!==s&&t.diagnostics.push(vt(e)),o?Vn(a):a;if(i.isPropertyAccessExpression(r)){const n=function(e,t,n){const r=e.checker.getResolvedSignature(t);if(n.expression.kind===i.SyntaxKind.SuperKeyword){const n=ss(e,t.arguments,r,i.factory.createThis());return Ae(e.transformExpression(t.expression),n,t)}if(ar(e,t)!==rr.Void)return cs(e,t,t.arguments);{const[n,i]=as(e,t.expression,t.arguments,r);return Ae(n,i,t)}}(t,e,r);return o?Vn(n):n}if(i.isElementAccessExpression(r)){const n=function(e,t){if(ar(e,t)!==rr.Void)return cs(e,t,t.arguments);{const[n,r]=as(e,t.expression,t.arguments);return Ae(n,r,t)}}(t,e);return o?Vn(n):n}const c=t.checker.getResolvedSignature(e);if(r.kind===i.SyntaxKind.SuperKeyword){const n=ss(t,e.arguments,c,i.factory.createThis());return Ae(Le(t.transformExpression(i.factory.createSuper()),de("____constructor")),n,e)}let u,l;const p=ar(t,e)!==rr.Void;if(p){const n=!t.isStrict&&void 0===s?i.factory.createIdentifier("_G"):i.factory.createNull();[u,l]=as(t,r,e.arguments,c,n)}else[u,l]=as(t,r,e.arguments,c);const d=Ae(u,l,e);return s&&p&&(s.contextualCall=d),o?Vn(d):d},[i.SyntaxKind.ClassDeclaration]:(e,t)=>{if(As(e)){const{precedingStatements:n}=hr(t,()=>(Ro(e,t),[]));return n}const{statements:n}=jo(e,t);return n},[i.SyntaxKind.ClassExpression]:Ro,[i.SyntaxKind.ConditionalExpression]:(e,t)=>{if(t.luaTarget===I.Luau)return function(e,t,n,r){const i=K(C.ConditionalExpression,r);return i.condition=e,i.whenTrue=t,i.whenFalse=n,i}(t.transformExpression(e.condition),t.transformExpression(e.whenTrue),t.transformExpression(e.whenFalse),e);Wo(e.condition,t);const n=hr(t,()=>t.transformExpression(e.condition)),r=hr(t,()=>t.transformExpression(e.whenTrue)),i=hr(t,()=>t.transformExpression(e.whenFalse));if(r.precedingStatements.length>0||i.precedingStatements.length>0||sn(t,t.checker.getTypeAtLocation(e.whenTrue)))return function(e,t,n,r,i){const s=e.createTempNameForNode(t.condition),o=r.precedingStatements.concat(z(Oe(s),r.result,t.whenTrue)),a=i.precedingStatements.concat(z(Oe(s),i.result,t.whenFalse));return e.addPrecedingStatements([U(s,void 0,t.condition),...n.precedingStatements,H(n.result,W(o,t.whenTrue),W(a,t.whenFalse),t)]),Oe(s)}(t,e,n,r,i);t.addPrecedingStatements(n.precedingStatements);const s=Ee(n.result,r.result,C.AndOperator);return Ee(s,i.result,C.OrOperator,e)},[i.SyntaxKind.ContinueStatement]:(e,t)=>{var n;const r=Nn(t,_n.Loop),i={[I.Universal]:kn.WithRepeatBreak,[I.Lua50]:kn.WithRepeatBreak,[I.Lua51]:kn.WithRepeatBreak,[I.Lua52]:kn.WithGoto,[I.Lua53]:kn.WithGoto,[I.Lua54]:kn.WithGoto,[I.LuaJIT]:kn.WithGoto,[I.Luau]:kn.WithContinue}[t.luaTarget];r&&(r.loopContinued=i);const s="__continue".concat(null!==(n=null===r||void 0===r?void 0:r.id)&&void 0!==n?n:"");switch(i){case kn.WithGoto:return function(e,t){const n=K(C.GotoStatement,t);return n.label=e,n}(s,e);case kn.WithContinue:return o=e,K(C.ContinueStatement,o);case kn.WithRepeatBreak:return[z(ke(s),se(!0),e),te(e)]}var o},[i.SyntaxKind.DeleteExpression]:(e,t)=>{if(i.isOptionalChain(e.expression))return function(e,t,n){return ci(e,n,void 0,t),se(!0,t)}(t,e,e.expression);let n,r;if(i.isPropertyAccessExpression(e.expression)){if(i.isPrivateIdentifier(e.expression.name))throw new Error("PrivateIdentifier is not supported");n=t.transformExpression(e.expression.expression),r=de(e.expression.name.text)}else if(i.isElementAccessExpression(e.expression)){n=t.transformExpression(e.expression.expression),r=t.transformExpression(e.expression.argumentExpression);const i=t.checker.getTypeAtLocation(e.expression.expression),s=t.checker.getTypeAtLocation(e.expression.argumentExpression);tn(t,i)&&Yt(t,s)&&(r=Kn(r,1))}return n&&r?Gt(t,Ce.Delete,e,n,r):(t.diagnostics.push(pt(e,"delete",i.SyntaxKind[e.kind])),ie())},[i.SyntaxKind.DoStatement]:(e,t)=>{Wo(e.expression,t);const n=q(Go(t,e));let{precedingStatements:r,result:i}=hr(t,()=>Ho(t.transformExpression(e.expression)));return r.length>0&&(r.push(H(i,W([te()]),void 0,e.expression)),i=se(!1)),Q(W([n,...r]),i,e)},[i.SyntaxKind.ElementAccessExpression]:(e,t)=>es(t,e,void 0).expression,[i.SyntaxKind.EmptyStatement]:()=>{},[i.SyntaxKind.EnumDeclaration]:(e,t)=>{if(i.getCombinedModifierFlags(e)&i.ModifierFlags.Const&&!t.options.preserveConstEnums)return;const n=$n(t.checker.getTypeAtLocation(e)).has(zn.CompileMembersOnly),r=[];if(!n&&function(e,t){const n=function(e,t){var n;return null!==(n=t.symbol)&&void 0!==n?n:e.checker.getSymbolAtLocation(t)}(e,t);return!n||n.valueDeclaration===t}(t,e)){const n=ys(t,e.name),i=Ee(Oe(n),Se(),C.OrOperator);r.push(...Gn(t,n,i,e))}const s=t.transformExpression(e.name);for(const a of e.members){const c=wi(t,a.name);let u;const l=Mi(t,a);if(l)u=l;else if(a.initializer){var o;if(i.isIdentifier(a.initializer)){const n=t.checker.getSymbolAtLocation(a.initializer);if(null!==n&&void 0!==n&&n.valueDeclaration&&i.isEnumMember(n.valueDeclaration)&&n.valueDeclaration.parent===e){u=Le(s,wi(t,n.valueDeclaration.name))}}null!==(o=u)&&void 0!==o||(u=t.transformExpression(a.initializer))}else u=ie();if(n){const n=t.checker.getSymbolAtLocation(e.name),i=n?ws(t,n):void 0;r.push(...Gn(t,_e(c)?c:ke(a.name.getText(),a.name),u,e,i))}else{const e=Le(s,c);if(r.push(z(e,u,a)),!pe(u)&&!re(u)){const t=Le(s,e);r.push(z(t,c,a))}}}return r},[i.SyntaxKind.ExportAssignment]:(e,t)=>{if(!t.resolver.isValueAliasDeclaration(e))return;const n=t.transformExpression(e.expression);return e.isExportEquals?U(Dn(),n,e):z(Le(Dn(),ks(e)),n,e)},[i.SyntaxKind.ExportDeclaration]:(e,t)=>{if(!e.exportClause)return Yo(t,e);if(!t.resolver.isValueAliasDeclaration(e))return;if(i.isNamespaceExport(e.exportClause))return Yo(t,e);const n=((e,t)=>t.elements.filter(t=>e.resolver.isValueAliasDeclaration(t)))(t,e.exportClause);return e.moduleSpecifier?function(e,t,n,r){const s=[],o=i.isStringLiteral(n)?n.text.replace(/"/g,""):"module",c=ke(Us(a.A.path.basename(o))),u=rs(e,n);s.push(U(c,u,t));for(const i of r){var l;const t=Dn(),n=i.name,r=Le(t,wi(e,n),n),o=null!==(l=i.propertyName)&&void 0!==l?l:i.name,a=Le(Oe(c),wi(e,o),i);s.push(z(r,a,i))}return q(s,t)}(t,e,e.moduleSpecifier,n):n.map(e=>Zo(t,e))},[i.SyntaxKind.ExpressionStatement]:(e,t)=>{const n=function(e,t){const n=i.isExpressionStatement(t)?t.expression:t;if(i.isPrefixUnaryExpression(n)&&(n.operator===i.SyntaxKind.PlusPlusToken||n.operator===i.SyntaxKind.MinusMinusToken)){const t=n.operator===i.SyntaxKind.PlusPlusToken?i.SyntaxKind.PlusToken:i.SyntaxKind.MinusToken;return Ur(e,n,n.operand,i.factory.createNumericLiteral(1),t)}if(i.isPostfixUnaryExpression(n)){const t=n.operator===i.SyntaxKind.PlusPlusToken?i.SyntaxKind.PlusToken:i.SyntaxKind.MinusToken;return Ur(e,n,n.operand,i.factory.createNumericLiteral(1),t)}}(t,e);if(n)return n;const r=function(e,t){const n=t.expression;if(!i.isBinaryExpression(n))return;const r=n.operatorToken.kind;if(Wr(r)){const t=qr(r);return Ur(e,n,n.left,n.right,t)}if(r===i.SyntaxKind.EqualsToken)return Pr(e,n);if(r===i.SyntaxKind.CommaToken)return q([...e.transformStatements(i.factory.createExpressionStatement(n.left)),...e.transformStatements(i.factory.createExpressionStatement(n.right))],n)}(t,e);return r||ei(t.transformExpression(e.expression))},[i.SyntaxKind.ExternalModuleReference]:(e,t)=>rs(t,e.expression,e),[i.SyntaxKind.ForInStatement]:(e,t)=>{tn(t,t.checker.getTypeAtLocation(e.expression))&&t.diagnostics.push(Qe(e));const n=Ae(ke("pairs"),[t.transformExpression(e.expression)]),r=W(Go(t,e));return $(r,[zo(t,e.initializer,r)],[n],e)},[i.SyntaxKind.ForOfStatement]:(e,t)=>{const n=W(Go(t,e));if(i.isCallExpression(e.expression)&&Qo(t,e.expression))return $o(t,e,n);const r=Bt(t,e.expression);if(r){if(r===Kt.Iterable)return function(e,t,n){const r=e.checker.getTypeAtLocation(t.expression),i=r.isIntersection()&&r.types.find(e=>"Iterable"===e.symbol.escapedName),s=null===i||void 0===i?void 0:i.typeArguments;if(s&&s.length>0&&fn(s[0])){const r=e.transformExpression(t.expression);return Jo(e,t,n,r,it)}const o=e.transformExpression(t.expression);return $(n,[zo(e,t.initializer,n)],[o],t)}(t,e,n);if(r===Kt.Pairs)return function(e,t,n){const r=Ae(ke("pairs"),[e.transformExpression(t.expression)]);return Jo(e,t,n,r,st)}(t,e,n);if(r===Kt.PairsKey)return function(e,t,n){const r=Ae(ke("pairs"),[e.transformExpression(t.expression)]);return $(n,[zo(e,t.initializer,n)],[r],t)}(t,e,n);v()}return tn(t,t.checker.getTypeAtLocation(e.expression))?function(e,t,n){const r=zo(e,t.initializer,n),i=Ae(ke("ipairs"),[e.transformExpression(t.expression)]);return $(n,[Ne(),r],[i],t)}(t,e,n):function(e,t,n){const r=zo(e,t.initializer,n),i=Gt(e,Ce.Iterator,t.expression,e.transformExpression(t.expression));return $(n,[Ne(),r],[i],t)}(t,e,n)},[i.SyntaxKind.ForStatement]:(e,t)=>{const n=[];t.pushScope(_n.Loop),e.initializer&&(i.isVariableDeclarationList(e.initializer)?(xi(t,e.initializer),n.push(...e.initializer.declarations.flatMap(e=>Si(t,e)))):n.push(...t.transformStatements(i.factory.createExpressionStatement(e.initializer))));const r=Go(t,e);let s;if(e.condition){const n=e.condition,{precedingStatements:i,result:o}=hr(t,()=>t.transformExpression(n));s=o,i.length>0&&(i.push(H(Ho(s),W([te()]),void 0,e.condition)),r.unshift(...i),s=se(!0))}else s=se(!0);return e.incrementor&&r.push(...t.transformStatements(i.factory.createExpressionStatement(e.incrementor))),n.push(J(W(r),s,e)),t.popScope(),q(n,e)},[i.SyntaxKind.FunctionDeclaration]:(e,t)=>{if(void 0===e.body)return;if(As(e))return z(Le(Dn(),ks(e)),Ni(e,t));const[n,r]=Oi(t,e),i=e.name?ys(t,e.name):Ne();if(void 0!==i.symbolId){var s,o;const e=On(t);null!==(s=e.functionDefinitions)&&void 0!==s||(e.functionDefinitions=new Map);const n={referencedSymbols:null!==(o=r.referencedSymbols)&&void 0!==o?o:new Map};e.functionDefinitions.set(i.symbolId,n)}const a=e.name&&Ei(t,t.checker.getTypeAtLocation(e.name))?vi(n):n;return Gn(t,i,a,e)},[i.SyntaxKind.FunctionExpression]:Ni,[i.SyntaxKind.Identifier]:(e,t)=>{if(i.identifierToKeywordKind(e)===i.SyntaxKind.UndefinedKeyword)return ie(e);const n=t.checker.getSymbolAtLocation(e);return Ts(t,e,n)},[i.SyntaxKind.IfStatement]:function e(t,n){n.pushScope(_n.Conditional),Wo(t.expression,n);const r=n.transformExpression(t.expression),s=In(n,go(n,t.thenStatement));n.popScope();const o=W(s);if(t.elseStatement){if(i.isIfStatement(t.elseStatement)){const i=t.elseStatement,{precedingStatements:s,result:a}=hr(n,()=>e(i,n));if(s.length>0){return H(r,o,W([...s,a]))}return H(r,o,a)}{n.pushScope(_n.Conditional);const e=In(n,go(n,t.elseStatement));n.popScope();return H(r,o,W(e))}}return H(r,o)},[i.SyntaxKind.ImportDeclaration]:(e,t)=>{var n;if(i.isStringLiteral(e.moduleSpecifier)){const n=e.moduleSpecifier.text;(n.startsWith("./")||n.startsWith("../"))&&t.diagnostics.push(wt(e.moduleSpecifier,n))}const r=On(t);null!==(n=r.importStatements)&&void 0!==n||(r.importStatements=[]);const s=[],a=rs(t,e.moduleSpecifier);if(void 0===e.importClause)return s.push(ne(a)),void r.importStatements.push(...s);const c=i.isStringLiteral(e.moduleSpecifier)?e.moduleSpecifier.text.replace(/"/g,""):"module",u=ke(Us(o.default.basename(c)));let l=!1;if(e.importClause.name&&is(t,e.importClause)){const n=ks(e.importClause.name),r=U(ys(t,e.importClause.name),Le(u,n),e.importClause.name);s.push(r),l=!0}if(e.importClause.namedBindings&&i.isNamespaceImport(e.importClause.namedBindings)&&t.resolver.isReferencedAliasDeclaration(e.importClause.namedBindings)){const n=U(ys(t,e.importClause.namedBindings.name),a,e);s.push(n)}if(e.importClause.namedBindings&&i.isNamedImports(e.importClause.namedBindings)){const n=e.importClause.namedBindings.elements.filter(e=>is(t,e)).map(e=>function(e,t,n){var r,i;const s=e.checker.getTypeAtLocation(t.name),o=ys(e,t.name),a=Ss(e,s.getSymbol());return U(o,Le(n,a?de(a,null!==(r=t.propertyName)&&void 0!==r?r:t.name):wi(e,null!==(i=t.propertyName)&&void 0!==i?i:t.name)),t)}(t,e,u));n.length>0&&(l=!0),s.push(...n)}0!==s.length&&(l&&s.unshift(U(u,a,e)),r.importStatements.push(...s))},[i.SyntaxKind.ImportEqualsDeclaration]:(e,t)=>{if(!t.resolver.isReferencedAliasDeclaration(e)&&(i.isExternalModuleReference(e.moduleReference)||i.isExternalModule(t.sourceFile)||!t.resolver.isTopLevelValueImportEqualsWithEntityName(e)))return;const n=ys(t,e.name),r=t.transformExpression(e.moduleReference);return qn(t,n,r,e)},[i.SyntaxKind.ModuleDeclaration]:(e,t)=>{var n,r;const s=t.currentNamespaces,o=[],a=t.checker.getSymbolAtLocation(e.name),c=void 0!==a&&t.checker.getExportsOfModule(a).length>0,u=ys(t,e.name),l=Ns(t,u),p=!t.isModule&&(!s||l),d=void 0===a||!(null!==(n=a.declarations)&&void 0!==n&&n.some(e=>i.isClassLike(e)||i.isFunctionDeclaration(e)))&&i.getOriginalNode(e)===(null===(r=a.declarations)||void 0===r?void 0:r.find(i.isModuleDeclaration));if(p){const e=Gn(t,u,Ee(Ps(t,u),Se(),C.OrOperator));o.push(...e)}else if(d){const e=Gn(t,u,Se());o.push(...e)}if((p||d)&&l&&c&&bs(e)){const n=qn(t,Es(t,e),Cs(t,u,l));o.push(n)}if(t.currentNamespaces=e,bs(e)){t.pushScope(_n.Block);const n=In(t,t.transformStatements(i.isModuleBlock(e.body)?e.body.statements:e.body));t.popScope(),o.push(q(n))}return t.currentNamespaces=s,o},[i.SyntaxKind.NewExpression]:(e,t)=>{var n,r;if(function(e,t){return Ct(e,t.expression)===Lt.TableNewType}(t,e))return Se(void 0,e);const i=t.checker.getTypeAtLocation(e.expression);if("ArrayConstructor"===(null===(n=hs(t,i))||void 0===n?void 0:n.name)){if(void 0===e.arguments||0===e.arguments.length)return Se([],e);{const n=t.checker.getResolvedSignature(e),r=null===n||void 0===n?void 0:n.getDeclaration();if(1===(null===r||void 0===r?void 0:r.parameters.length)&&void 0===r.parameters[0].dotDotDotToken)return t.diagnostics.push(Nt(e)),Se([],e);return Se(ss(t,e.arguments,n).map(e=>ye(e)),e)}}const s=t.checker.getResolvedSignature(e),[o,a]=as(t,e.expression,null!==(r=e.arguments)&&void 0!==r?r:[],s),c=$n(t.checker.getTypeAtLocation(e)).get(zn.CustomConstructor);if(c){var u;if(1===c.args.length)return Ae(ke(c.args[0]),ss(t,null!==(u=e.arguments)&&void 0!==u?u:[]),e);t.diagnostics.push(et(e,zn.CustomConstructor,c.args.length,1))}return Gt(t,Ce.New,e,o,...a)},[i.SyntaxKind.ParenthesizedExpression]:(e,t)=>t.transformExpression(e.expression),[i.SyntaxKind.PostfixUnaryExpression]:(e,t)=>{switch(e.operator){case i.SyntaxKind.PlusPlusToken:return Gr(t,e,e.operand,i.factory.createNumericLiteral(1),i.SyntaxKind.PlusToken,!0);case i.SyntaxKind.MinusMinusToken:return Gr(t,e,e.operand,i.factory.createNumericLiteral(1),i.SyntaxKind.MinusToken,!0);default:v(e.operator)}},[i.SyntaxKind.PrefixUnaryExpression]:(e,t)=>{switch(e.operator){case i.SyntaxKind.PlusPlusToken:return Gr(t,e,e.operand,i.factory.createNumericLiteral(1),i.SyntaxKind.PlusToken,!1);case i.SyntaxKind.MinusMinusToken:return Gr(t,e,e.operand,i.factory.createNumericLiteral(1),i.SyntaxKind.MinusToken,!1);case i.SyntaxKind.PlusToken:{const n=t.transformExpression(e.operand),r=t.checker.getTypeAtLocation(e.operand);return Yt(t,r)?n:Gt(t,Ce.Number,e,n)}case i.SyntaxKind.MinusToken:{const n=t.transformExpression(e.operand),r=t.checker.getTypeAtLocation(e.operand);return Yt(t,r)?Te(n,C.NegationOperator):Gt(t,Ce.Number,e,Te(n,C.NegationOperator))}case i.SyntaxKind.ExclamationToken:return Te(t.transformExpression(e.operand),C.NotOperator);case i.SyntaxKind.TildeToken:return function(e,t,n,r){switch(e.luaTarget){case I.Universal:case I.Lua50:case I.Lua51:return e.diagnostics.push(ut(t,"Bitwise operations",e.luaTarget)),Rr(t,n,r,"bit");case I.LuaJIT:return Rr(t,n,r,"bit");case I.Lua52:return Rr(t,n,r,"bit32");default:return Te(n,r,t)}}(t,e,t.transformExpression(e.operand),C.BitwiseNotOperator);default:v(e.operator)}},[i.SyntaxKind.PropertyAccessExpression]:(e,t)=>ts(t,e,void 0).expression,[i.SyntaxKind.QualifiedName]:(e,t)=>{const n=de(e.right.text,e.right);return Le(t.transformExpression(e.left),n,e)},[i.SyntaxKind.ReturnStatement]:(e,t)=>{let n;if(e.expression){const r=t.checker.getTypeAtLocation(e.expression),i=t.checker.getContextualType(e.expression);i&&mr(t,e,r,i),n=yr(t,e.expression,xr(t))}else n=[];return Sr(t,n,e)},[i.SyntaxKind.SourceFile]:(e,t)=>{var n,r;let s=[];if(e.flags&i.NodeFlags.JsonFile){const[n]=e.statements;if(n){i.isExpressionStatement(n);const{precedingStatements:e,result:r}=hr(t,()=>t.transformExpression(n.expression));s.push(...e),s.push(X([r]))}else{const e=Ae(ke("error"),[de("Unexpected end of JSON input")]);s.push(ne(e))}}else t.pushScope(_n.File),s=In(t,t.transformStatements(e.statements)),t.popScope(),t.isModule&&(e.statements.some(e=>i.isExportAssignment(e)&&e.isExportEquals)||s.unshift(U(Dn(),Se())),s.push(X([Dn()])));const o=null!==(n=null===(r=e.getFullText().match(/^#!.*\r?\n/))||void 0===r?void 0:r[0])&&void 0!==n?n:"";return function(e,t,n,r){const i=K(C.File,r);return i.statements=e,i.luaLibFeatures=t,i.trivia=n,i}(s,t.usedLuaLibFeatures,o,e)},[i.SyntaxKind.SpreadElement]:(e,t)=>{const n=i.skipOuterExpressions(e.expression);if(i.isIdentifier(n)){const r=t.checker.getSymbolAtLocation(n);if(r&&vn(t,r,n))return t.luaTarget===I.Lua50?Rn(t,ce(),e):ae(e)}const r=t.transformExpression(e.expression);if(yn(t,n))return r;const s=Bt(t,e.expression);if(s){if(s===Kt.Iterable)return Gt(t,Ce.LuaIteratorSpread,e,r);if(s===Kt.Pairs){return Rn(t,Gt(t,Ce.ObjectEntries,e,r),e)}if(s===Kt.PairsKey){return Rn(t,Gt(t,Ce.ObjectKeys,e,r),e)}v()}const o=t.checker.getTypeAtLocation(e.expression);return nn(t,o)?Rn(t,r,e):Gt(t,Ce.Spread,e,r)},[i.SyntaxKind.SuperKeyword]:(e,t)=>{var n;const r=t.classSuperInfos,s=r[r.length-1];if(!s)return Ne(e);const{className:o,extendedTypeNode:a}=s,c=null===a||void 0===a?void 0:a.expression;let u;if(c&&i.isIdentifier(c)){const e=t.checker.getSymbolAtLocation(c);e&&!Is(t,e)&&(u=ys(t,c))}null!==(n=u)&&void 0!==n||(u=Le(o,de("____super"),e));const l=an(e,i.isFunctionLike);return l&&i.canHaveModifiers(l)&&xo(l)?u:Le(u,de("prototype"))},[i.SyntaxKind.SwitchStatement]:(e,t)=>{const n=t.pushScope(_n.Switch),r="____switch".concat(n.id),s="____cond".concat(n.id),o=ke(r),a=ke(s),c=[],u=[],l=[],p=e.caseBlock.clauses;if(1===p.length&&i.isDefaultClause(p[0])){const e=p[0].statements;if(e.length){const{statements:n,hoistedStatements:r,hoistedIdentifiers:i}=Fn(t,t.transformStatements(e));u.push(...r),l.push(...i),c.push(q(n))}}else{let e,n=!1,r=!0,s=[];for(let m=0;m<p.length;m++){const f=p[m],h=p[m-1];if(0===m&&i.isDefaultClause(f))continue;if(i.isDefaultClause(f)&&h&&Xo(h.statements))continue;if(i.isDefaultClause(f)){var d;if(r)c.push(...s,U(a,null!==(d=e)&&void 0!==d?d:se(!1))),e=void 0,s=[],r=!1;if(m===p.length-1){if(e){const{precedingStatements:n,result:r}=ea(t,a,e,s);s=n,e=r,c.push(...s,z(a,e))}continue}}else{const{precedingStatements:n,result:i}=ta(e,s,o,f.expression,t);if(s=n,e=i,m!==p.length-1&&0===f.statements.length)continue;if(r)c.push(...s,U(a,e));else{const{precedingStatements:n,result:r}=ea(t,a,e,s);s=n,e=r,c.push(...s,z(a,e))}r=!1}const{statements:g,hoistedStatements:y,hoistedIdentifiers:S}=Fn(t,t.transformStatements(f.statements));m!==p.length-1||Xo(f.statements)||g.push(te()),u.push(...y),l.push(...S),i.isDefaultClause(f)&&(n=!0),c.push(H(a,W(g))),e=void 0,s=[]}const f=p.findIndex(e=>i.isDefaultClause(e));if(f>=0){const e=p.findIndex((e,t)=>t>=f&&Xo(e.statements)),{statements:r,hoistedStatements:i,hoistedIdentifiers:s}=Fn(t,t.transformStatements(p[f].statements));n||(u.push(...i),l.push(...s));for(const n of p.slice(f+1,e>=0?e+1:void 0)){let e=t.transformStatements(n.statements);({statements:e}=Fn(t,e)),r.push(...e)}r.length&&c.push(q(r))}}c.unshift(...u),l.length>0&&c.unshift(U(l)),t.popScope();const f=t.transformExpression(e.expression);return c.unshift(U(o,f)),Q(W(c),se(!0))},[i.SyntaxKind.TaggedTemplateExpression]:(e,t)=>{const n=[],r=[],s=[];i.isTemplateExpression(e.template)?(n.push(e.template.head.text),r.push(na(e.template.head)),n.push(...e.template.templateSpans.map(e=>e.literal.text)),r.push(...e.template.templateSpans.map(e=>na(e.literal))),s.push(...e.template.templateSpans.map(e=>e.expression))):(n.push(e.template.text),r.push(na(e.template)));const o=i.factory.createArrayLiteralExpression(r.map(e=>i.factory.createStringLiteral(e))),a=i.factory.createObjectLiteralExpression([...n.map((e,t)=>i.factory.createPropertyAssignment(i.factory.createNumericLiteral(t+1),i.factory.createStringLiteral(e))),i.factory.createPropertyAssignment("raw",o)]);s.unshift(a);if(ar(t,e)!==rr.Void)return cs(t,e,s);const c=ss(t,s);return Ae(t.transformExpression(e.tag),c)},[i.SyntaxKind.TemplateExpression]:(e,t)=>{const n=[],r=e.head.text;r.length>0&&n.push(de(r,e.head));const i=hi(t,e.templateSpans.map(e=>e.expression));for(let s=0;s<e.templateSpans.length;++s){const r=e.templateSpans[s],o=i[s],a=t.checker.getTypeAtLocation(r.expression);$t(t,a)?n.push(o):n.push(Wn(o));const c=r.literal.text;c.length>0&&n.push(de(c,r.literal))}return n.reduce((e,t)=>Ee(e,t,C.ConcatOperator))},[i.SyntaxKind.ThisKeyword]:e=>Cn(e),[i.SyntaxKind.ThrowStatement]:(e,t)=>{const n=[];return e.expression&&(n.push(t.transformExpression(e.expression)),n.push(le(0))),ne(Ae(ke("error"),n),e)},[i.SyntaxKind.TryStatement]:(e,t)=>{if(Ht(e))return((e,t)=>{const[n]=yo(t,e.tryBlock,_n.Try);if((t.options.luaTarget===I.Lua50||t.options.luaTarget===I.Lua51)&&!t.options.lua51AllowTryCatchInAsyncAwait)return t.diagnostics.push(lt(e,"try/catch inside async functions",I.Lua51,"lua51AllowTryCatchInAsyncAwait")),n.statements;const r=gr(t,n.statements,!1),i=ke("____try"),s=[U(i,r)];if(e.finallyBlock){const n=Ae(Le(i,de("finally")),[i,he(W(t.transformStatements(e.finallyBlock.statements)))],e.finallyBlock);s.push(ne(n))}if(e.catchClause){const[n]=qo(t,e.catchClause);n.params&&n.params.unshift(Ne());const r=Ae(Le(i,de("catch")),[i,n]),o=Gt(t,Ce.Await,e,r);s.push(ne(o,e))}else{const n=Gt(t,Ce.Await,e,i);s.push(ne(n,e))}return s})(e,t);const[n,r]=yo(t,e.tryBlock,_n.Try);if((t.options.luaTarget===I.Lua50||t.options.luaTarget===I.Lua51)&&function(e){const t=an(e,i.isFunctionDeclaration);return!!t&&void 0!==t.asteriskToken}(e))return t.diagnostics.push(ut(e,"try/catch inside generator functions",I.Lua51)),n.statements;const s=ke("____try"),o=ke("____returnValue"),a=[],c=ke("____hasReturned");let u;const l=Ae(ke("pcall"),[he(n)]);if(e.catchClause&&e.catchClause.block.statements.length>0){var p;const[n,i]=qo(t,e.catchClause),d=ke("____catch");a.push(U(d,n));const f=null!==(p=r.functionReturned)&&void 0!==p?p:i.functionReturned,m=[s];(f||e.catchClause.variableDeclaration)&&(m.push(c),f&&(m.push(o),u=Oe(c))),a.push(U(m,l));const h=Ae(d,e.catchClause.variableDeclaration?[Oe(c)]:[]),g=f?z([Oe(c),Oe(o)],h):ne(h),y=Te(s,C.NotOperator);a.push(H(y,W([g])))}else if(r.functionReturned){const e=[s,c,o];a.push(U(e,l)),u=Ee(Oe(s),c,C.AndOperator)}else a.push(ne(l));if(e.finallyBlock&&e.finallyBlock.statements.length>0&&a.push(...t.transformStatements(e.finallyBlock)),u&&c){const n=[];Sn(t,e)?n.push(Rn(t,Oe(o))):n.push(Oe(o));const r=H(u,W([Sr(t,n,e)]));a.push(r)}return q(a,e)},[i.SyntaxKind.TypeOfExpression]:(e,t)=>{const n=t.transformExpression(e.expression);return Gt(t,Ce.TypeOf,e,n)},[i.SyntaxKind.VariableStatement]:(e,t)=>(xi(t,e.declarationList),e.declarationList.declarations.flatMap(e=>Si(t,e))),[i.SyntaxKind.WhileStatement]:(e,t)=>{Wo(e.expression,t);const n=Go(t,e);let{precedingStatements:r,result:i}=hr(t,()=>t.transformExpression(e.expression));return r.length>0&&(r.push(H(Ho(i),W([te()]),void 0,e.expression)),n.unshift(...r),i=se(!0)),J(W(n),i,e)},[i.SyntaxKind.YieldExpression]:(e,t)=>{const n=e.expression?[t.transformExpression(e.expression)]:[];return e.asteriskToken?Gt(t,Ce.DelegatedYield,e,...n):Ae(Le(ke("coroutine"),de("yield")),n,e)},[i.SyntaxKind.VoidExpression]:(e,t)=>{if(!i.isLiteralExpression(e.expression)){const n=ei(t.transformExpression(e.expression));n&&t.addPrecedingStatements(n)}return ie()}});function oa(e){return t=>n=>{function r(n){if(i.isBlock(n)||i.isSourceFile(n)){const[s,o]=ca(e,n.statements,n);if(s){const a=i.isBlock(n)?i.factory.updateBlock(n,o):i.factory.updateSourceFile(n,o),c=i.visitEachChild(a,r,t),u=[a];function l(e){return i.setParent(e,u[u.length-1]),u.push(e),i.visitEachChild(e,l,t),u.pop(),e}return i.visitEachChild(a,l,t),i.setParent(a,n.parent),c}}return i.visitEachChild(n,r,t)}return r(i.visitEachChild(n,r,t))}}function aa(e){return i.isVariableStatement(e)&&0!==(e.declarationList.flags&i.NodeFlags.Using)}function ca(e,t,n){const r=[];for(let s=0;s<t.length;s++){const o=t[s];if(aa(o)){const a=0!==(o.declarationList.flags&i.NodeFlags.AwaitContext);qt(e,a?Ce.UsingAsync:Ce.Using);const c=o.declarationList.declarations.map(e=>i.factory.createParameterDeclaration(void 0,void 0,e.name));c.unshift(ua(e.checker));const u=t.slice(s+1),[l,p]=ca(e,u,n),d=i.factory.createBlock(l?p:u),f=i.factory.createFunctionExpression(a?[i.factory.createModifier(i.SyntaxKind.AsyncKeyword)]:void 0,void 0,void 0,void 0,c,i.factory.createKeywordTypeNode(i.SyntaxKind.AnyKeyword),d),m=i.factory.createIdentifier(a?"__TS__UsingAsync":"__TS__Using");let h=i.factory.createCallExpression(m,[],[f,...o.declarationList.declarations.map(e=>{var t;return null!==(t=e.initializer)&&void 0!==t?t:i.factory.createIdentifier("unidentified")})]);return a&&(h=i.factory.createAwaitExpression(h)),i.isSourceFile(n)||n.parent&&i.isBlock(n.parent)&&n.parent.statements[n.parent.statements.length-1]!==n?r.push(i.factory.createExpressionStatement(h)):r.push(i.factory.createReturnStatement(h)),[!0,r]}r.push(o)}return[!1]}function ua(e){const t=e.typeToTypeNode(e.getVoidType(),void 0,void 0);return i.factory.createParameterDeclaration(void 0,void 0,i.factory.createIdentifier("this"),void 0,t)}function la(e,t,n,r){var o,a,c,u,l,p;const d=function(e){const t={before:[],after:[],afterDeclarations:[]},n=e.getCompilerOptions();n.jsx===i.JsxEmit.React&&t.before.push(e=>{const t=(0,s.A)((0,s.A)({},e),{},{getCompilerOptions:()=>(0,s.A)((0,s.A)({},e.getCompilerOptions()),{},{target:i.ScriptTarget.ESNext})});return i.transformJsx(t)});return t}(e),f=[...null!==(o=d.afterDeclarations)&&void 0!==o?o:[],...null!==(a=n.afterDeclarations)&&void 0!==a?a:[]];return e.getCompilerOptions().noImplicitSelf&&f.unshift(pa),{afterDeclarations:f,before:[...null!==(c=n.before)&&void 0!==c?c:[],...null!==(u=d.before)&&void 0!==u?u:[],...null!==(l=d.after)&&void 0!==l?l:[],...null!==(p=n.after)&&void 0!==p?p:[],da,()=>e=>(r(e),i.createSourceFile(e.fileName,"",i.ScriptTarget.ESNext))]}}const pa=()=>e=>{const t=e=>{const t=i.factory.createNotEmittedStatement(void 0);return i.addSyntheticLeadingComment(t,i.SyntaxKind.MultiLineCommentTrivia,"* @noSelfInFile ",!0),i.factory.updateSourceFile(e,[t,...e.statements],e.isDeclarationFile)};return i.isBundle(e)?i.factory.updateBundle(e,e.sourceFiles.map(t)):t(e)},da=e=>t=>{function n(e){for(;i.isParenthesizedExpression(e)&&!i.isOptionalChain(e.expression);)e=e.expression;return e}return i.visitEachChild(t,function t(r){return i.isCallExpression(r)?i.factory.updateCallExpression(r,n(r.expression),r.typeArguments,r.arguments):i.isVoidExpression(r)?i.factory.updateVoidExpression(r,n(r.expression)):i.isDeleteExpression(r)?i.factory.updateDeleteExpression(r,n(r.expression)):i.visitEachChild(r,t,e)},e)};function fa(e,t,n){let{program:r,sourceFiles:a,customTransformers:c={}}=n;const u=r.getCompilerOptions();u.tstlVerbose&&console.log("Parsing project settings");const l=function(e){const t=[];return e.luaBundle&&!e.luaBundleEntry&&t.push(k()),e.luaBundle&&e.luaLibImport===F.Inline&&t.push(O()),e.luaBundle&&e.buildMode===M.Library&&t.push(N()),e.jsx&&e.jsx!==i.JsxEmit.React&&t.push(w()),e.paths&&!e.baseUrl&&t.push(L()),t}(u);let p=[];if(u.noEmitOnError){const e=[...l,...r.getOptionsDiagnostics(),...r.getGlobalDiagnostics()];if(a)for(const t of a)e.push(...r.getSyntacticDiagnostics(t)),e.push(...r.getSemanticDiagnostics(t));else e.push(...r.getSyntacticDiagnostics()),e.push(...r.getSemanticDiagnostics());if(0===e.length&&(u.declaration||u.composite)&&e.push(...r.getDeclarationDiagnostics()),e.length>0)return{diagnostics:e,transpiledFiles:p}}const d=function(e){const t=new Map;for(const r of[sa,...e]){const e=r===sa?-1/0:0;for(const[n,i]of Object.entries(r)){if(!i)continue;const r="function"===typeof i?{transform:i,priority:e}:i;y(t,Number(n),()=>[]).push(r)}}const n=new Map;for(const[r,i]of t)n.set(r,i.sort((e,t)=>{var n,r;return(null!==(n=e.priority)&&void 0!==n?n:0)-(null!==(r=t.priority)&&void 0!==r?r:0)}).map(e=>e.transform));return n}([]),f=function(e){if(0===e.length)return(e,t,n,r)=>new _a(t,e,n).print(r);if(1===e.length)return e[0];throw new Error("Only one plugin can specify 'printer'")}([]),m=t=>{u.tstlVerbose&&console.log("Transforming ".concat(t.fileName));const{file:n,diagnostics:a}=function(e,t,n){const r=new vr(e,t,n),s=[oa(r)],o=i.transform(t,s),[a]=r.transformNode(o.transformed[0]);return{file:a,diagnostics:r.diagnostics}}(r,t,d);if(l.push(...a),!u.noEmit&&!u.emitDeclarationOnly){u.tstlVerbose&&console.log("Printing ".concat(t.fileName));const i=f(r,e,t.fileName,n);p.push((0,s.A)({sourceFiles:[t],fileName:o.default.normalize(t.fileName),luaAst:n},i))}},h=la(r,0,c,m),g=e=>e.flags&i.NodeFlags.JsonFile&&!u.emitDeclarationOnly&&!r.isSourceFileFromExternalLibrary(e),S=u.noEmit;u.noEmit=!1;const x=function(e){if(!e.endsWith(".js")&&!e.endsWith(".js.map")&&!e.endsWith(".json")){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t(e,...r)}};if(a)for(const i of a)g(i)?m(i):l.push(...r.emit(i,x,void 0,!1,h).diagnostics);else l.push(...r.emit(void 0,x,void 0,!1,h).diagnostics),r.getSourceFiles().filter(g).forEach(m);return u.noEmit=S,(u.noEmit||u.noEmitOnError&&l.length>0)&&(p=[]),{diagnostics:l,transpiledFiles:p}}class ma{constructor(){let{emitHost:e=i.sys}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.emitHost=void 0,this.emitHost=e}emit(e){const{program:t,writeFile:n=this.emitHost.writeFile}=e,{diagnostics:r,transpiledFiles:i}=fa(this.emitHost,n,(0,s.A)({},e)),{emitPlan:o}=this.getEmitPlan(t,r,i),a=this.emitFiles(t,o,n);return{diagnostics:r.concat(a),emitSkipped:0===o.length}}emitFiles(e,t,n){var r;const i=e.getCompilerOptions();i.tstlVerbose&&console.log("Emitting output");const s=null!==(r=i.emitBOM)&&void 0!==r&&r;for(const{outputPath:o,code:a,sourceMap:c,sourceFiles:u}of t)i.tstlVerbose&&console.log("Emitting ".concat(m(o))),n(o,a,s,void 0,u),i.sourceMap&&void 0!==c&&n(o+".map",c,s,void 0,u);return i.tstlVerbose&&console.log("Emit finished!"),[]}getEmitPlan(e,t,n){const r=e.getCompilerOptions();r.tstlVerbose&&console.log("Constructing emit plan");const i=function(e,t,n){const r=e.getCompilerOptions(),i=new so(e,r,n);for(const s of t)r.tstlVerbose&&console.log("Resolving dependencies for ".concat(m(s.fileName))),i.addAndResolveDependencies(s);return{resolvedFiles:[...i.resolvedFiles.values()],diagnostics:i.diagnostics}}(e,n,this.emitHost);t.push(...i.diagnostics);let o;if(i.resolvedFiles.some(e=>"lualib_bundle"===e.fileName)&&(i.resolvedFiles=i.resolvedFiles.filter(e=>"lualib_bundle"!==e.fileName)),P(r)){const[n,r]=$s(e,i.resolvedFiles);t.push(...n),o=[r]}else o=i.resolvedFiles.map(t=>(0,s.A)((0,s.A)({},t),{},{outputPath:ha(t.fileName,e)}));return{emitPlan:o}}getLuaLibBundleContent(e,t){var n;const r=null!==(n=e.luaTarget)&&void 0!==n?n:I.Universal;if(e.luaLibImport===F.RequireMinimal){return function(e,t,n){const r=Ve(e,t,n),i=Be(t),s=Array.from(e).flatMap(e=>i[e].exports);return r+"\nreturn {\n".concat(s.map(e=>"  ".concat(e," = ").concat(e)).join(",\n"),"\n}\n")}(qe(r,this.emitHost,t.map(e=>e.code)),r,this.emitHost)}return function(e,t){const n=o.default.join(De(e),"lualib_bundle.lua");if(!We.has(n)){const e=t.readFile(n);if(void 0===e)throw new Error("Could not load lualib bundle from '".concat(n,"'"));We.set(n,e)}return We.get(n)}(r,this.emitHost)}}function ha(e,t){const n=ga(e,t),r=Sa(t);return o.default.join(r,n)}function ga(e,t){var n;const r=ya(t);let i;i=""===r?e.split(o.default.sep):o.default.relative(r,e).split(o.default.sep),i=i.filter(e=>".."!==e),"node_modules"===i[0]&&(i[0]="lua_modules");const s=(null!==(n=t.getCompilerOptions().extension)&&void 0!==n?n:"lua").trim(),a=s.startsWith(".")?s.substring(1):s;return i[i.length-1]=h(i[i.length-1])+"."+a,o.default.join(...i)}function ya(e){const t=e.getCompilerOptions().rootDir;return t&&t.length>0?o.default.isAbsolute(t)?t:o.default.resolve(xa(e),t):xa(e)}function Sa(e){const t=e.getCompilerOptions().outDir;return t&&t.length>0?o.default.isAbsolute(t)?t:o.default.resolve(xa(e),t):xa(e)}function xa(e){const t=e.getCompilerOptions().configFilePath;return t?o.default.dirname(t):e.getCommonSourceDirectory()}const Ta=/[\b\f\n\r\t\v\\"\0]/g,va={"\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\v","\\":"\\\\",'"':'\\"',"\0":"\\0"},Ea=e=>'"'.concat(e.replace(Ta,e=>va[e]),'"'),ba="--[[ Generated with https://github.com/TypeScriptToLua/TypeScriptToLua ]]\n";function Aa(e){switch(e.kind){case C.CallExpression:case C.MethodCallExpression:case C.FunctionExpression:return!1;case C.TableExpression:return e.fields.every(e=>Aa(e));case C.TableFieldExpression:const t=e;return(!t.key||Aa(t.key))&&Aa(t.value);case C.TableIndexExpression:const n=e;return Aa(n.table)&&Aa(n.index);case C.UnaryExpression:return Aa(e.operand);case C.BinaryExpression:const r=e;return Aa(r.left)&&Aa(r.right)}return!0}class _a{constructor(e,t,n){this.emitHost=e,this.program=t,this.sourceFile=n,this.currentIndent="",this.luaFile=void 0,this.relativeSourcePath=void 0,this.options=void 0,this.options=t.getCompilerOptions(),this.luaFile=m(ha(this.sourceFile,this.program)),"."===o.default.dirname(this.luaFile)||""===this.sourceFile?this.relativeSourcePath=m(o.default.dirname(this.luaFile)):this.relativeSourcePath=m(o.default.relative(o.default.dirname(this.luaFile),this.sourceFile))}print(e){this.options.sourceMapTraceback&&e.luaLibFeatures.add(Ce.SourceMapTraceBack);const t=this.options.sourceRoot?"".concat(this.options.sourceRoot.replace(/[\\/]+$/,""),"/"):"",n=this.printFile(e),r=this.buildSourceMap(t,n);let i=n.toString();if(this.options.inlineSourceMap&&(i+="\n"+this.printInlineSourceMap(r)),this.options.sourceMapTraceback){const e=this.printStackTraceOverride(n);i=i.replace(_a.sourceMapTracebackPlaceholder,e)}return{code:i,sourceMap:r.toString(),sourceMapNode:n}}printInlineSourceMap(e){const t=e.toString(),n=Buffer.from(t).toString("base64");return"--# sourceMappingURL=data:application/json;base64,".concat(n,"\n")}printStackTraceOverride(e){let t=1;const n={};e.walk((e,r)=>{void 0!==r.line&&r.line>0&&(void 0===n[t]?n[t]=r.line:n[t]=Math.min(n[t],r.line)),t+=e.split("\n").length-1});const r="{"+Object.entries(n).map(e=>{let[t,n]=e;return'["'.concat(t,'"] = ').concat(n)}).join(",")+"}";return"__TS__SourceMapTraceBack(debug.getinfo(1).short_src, ".concat(r,");")}printFile(e){var t,n;let r=[e.trivia];this.options.noHeader||r.push(ba);const i=null!==(t=this.options.luaTarget)&&void 0!==t?t:I.Universal,s=null!==(n=this.options.luaLibImport)&&void 0!==n?n:F.Require;return(s===F.Require||s===F.RequireMinimal)&&e.luaLibFeatures.size>0?r=this.printStatementArray(function(e,t){const n=Be(t),r=Array.from(e).flatMap(e=>n[e].exports);if(0===r.length)return[];const i=Ae(ke("require"),[de("lualib_bundle")]),s=ke("____lualib"),o=[U(s,i)];for(const a of r)o.push(U(ke(a),Le(s,de(a))));return o}(e.luaLibFeatures,i,this.emitHost)):s===F.Inline&&e.luaLibFeatures.size>0&&(r.push("-- Lua Library inline imports\n"),r.push(Ve(e.luaLibFeatures,i,this.emitHost)),r.push("-- End of Lua Library inline imports\n")),this.options.sourceMapTraceback&&!P(this.options)&&r.push("".concat(_a.sourceMapTracebackPlaceholder,"\n")),r.push(...this.printStatementArray(e.statements)),this.concatNodes(...r)}pushIndent(){this.currentIndent+="\t"}popIndent(){this.currentIndent=this.currentIndent.slice(1)}indent(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.concatNodes(this.currentIndent,e)}createSourceNode(e,t,n){const{line:r,column:i}=j(e);return void 0!==r&&void 0!==i?new Ge.SourceNode(r+1,i,this.relativeSourcePath,t,n):new Ge.SourceNode(null,null,this.relativeSourcePath,t,n)}concatNodes(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Ge.SourceNode(null,null,this.relativeSourcePath,t)}printBlock(e){return this.concatNodes(...this.printStatementArray(e.statements))}statementMayRequireSemiColon(e){return G(e)||e.kind===C.AssignmentStatement||function(e){return e.kind===C.ExpressionStatement}(e)}nodeStartsWithParenthesis(e){var t;let n;return e.walk(e=>{void 0===n&&(e=e.trimLeft()).length>0&&(n=e.startsWith("("))}),null!==(t=n)&&void 0!==t&&t}printStatementArray(e){const t=[];for(const[n,r]of e.entries()){const i=this.printStatement(r);if(n>0&&this.statementMayRequireSemiColon(e[n-1])&&this.nodeStartsWithParenthesis(i)&&t[n-1].add(";"),t.push(i),Z(r))break}return t.length>0?[...u(t,"\n"),"\n"]:[]}printStatement(e){let t=this.printStatementExcludingComments(e);return e.leadingComments&&(t=this.concatNodes(e.leadingComments.map(e=>this.printComment(e)).join("\n"),"\n",t)),e.trailingComments&&(t=this.concatNodes(t,"\n",e.trailingComments.map(e=>this.printComment(e)).join("\n"))),t}printComment(e){if(Array.isArray(e)){if(0===e.length)return this.indent("--[[]]");{const[t,...n]=e,r=this.concatNodes(...n.map(e=>this.concatNodes("\n",this.indent(e))));return this.concatNodes(this.indent("--[["),t,r,"]]")}}return this.indent("--".concat(e))}printStatementExcludingComments(e){switch(e.kind){case C.DoStatement:return this.printDoStatement(e);case C.VariableDeclarationStatement:return this.printVariableDeclarationStatement(e);case C.AssignmentStatement:return this.printVariableAssignmentStatement(e);case C.IfStatement:return this.printIfStatement(e);case C.WhileStatement:return this.printWhileStatement(e);case C.RepeatStatement:return this.printRepeatStatement(e);case C.ForStatement:return this.printForStatement(e);case C.ForInStatement:return this.printForInStatement(e);case C.GotoStatement:return this.printGotoStatement(e);case C.LabelStatement:return this.printLabelStatement(e);case C.ReturnStatement:return this.printReturnStatement(e);case C.BreakStatement:return this.printBreakStatement(e);case C.ContinueStatement:return this.printContinueStatement(e);case C.ExpressionStatement:return this.printExpressionStatement(e);default:throw new Error("Tried to print unknown statement kind: ".concat(C[e.kind]))}}printDoStatement(e){const t=[];return t.push(this.indent("do\n")),this.pushIndent(),t.push(...this.printStatementArray(e.statements)),this.popIndent(),t.push(this.indent("end")),this.concatNodes(...t)}printVariableDeclarationStatement(e){const t=[];return t.push(this.indent("local ")),Ie(e)?t.push(this.printFunctionDefinition(e)):(t.push(...this.joinChunksWithComma(e.left.map(e=>this.printExpression(e)))),e.right&&(t.push(" = "),t.push(...this.joinChunksWithComma(e.right.map(e=>this.printExpression(e)))))),this.createSourceNode(e,t)}printVariableAssignmentStatement(e){const t=[];if(t.push(this.indent()),Ie(e)&&0!==(e.right[0].flags&D.Declaration)){if(((e,t)=>(Ks(t)?/^[a-zA-Z0-9_\u00FF-\uFFFD.]+$/:/^[a-zA-Z0-9_.]+$/).test(e))(this.printExpression(e.left[0]).toString(),this.options))return t.push(this.printFunctionDefinition(e)),this.createSourceNode(e,t)}return t.push(...this.joinChunksWithComma(e.left.map(e=>this.printExpression(e)))),t.push(" = "),t.push(...this.joinChunksWithComma(e.right.map(e=>this.printExpression(e)))),this.createSourceNode(e,t)}printIfStatement(e){const t=[],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"elseif":"if";return t.push(this.indent(n+" "),this.printExpression(e.condition)," then\n"),this.pushIndent(),t.push(this.printBlock(e.ifBlock)),this.popIndent(),e.elseBlock?e.elseBlock.kind===C.IfStatement?t.push(this.printIfStatement(e.elseBlock,!0)):(t.push(this.indent("else\n")),this.pushIndent(),t.push(this.printBlock(e.elseBlock)),this.popIndent(),t.push(this.indent("end"))):t.push(this.indent("end")),this.concatNodes(...t)}printWhileStatement(e){const t=[];return t.push(this.indent("while "),this.printExpression(e.condition)," do\n"),this.pushIndent(),t.push(this.printBlock(e.body)),this.popIndent(),t.push(this.indent("end")),this.concatNodes(...t)}printRepeatStatement(e){const t=[];return t.push(this.indent("repeat\n")),this.pushIndent(),t.push(this.printBlock(e.body)),this.popIndent(),t.push(this.indent("until "),this.printExpression(e.condition)),this.concatNodes(...t)}printForStatement(e){const t=this.printExpression(e.controlVariable),n=this.printExpression(e.controlVariableInitializer),r=this.printExpression(e.limitExpression),i=[];return i.push(this.indent("for "),t," = ",n,", ",r),e.stepExpression&&i.push(", ",this.printExpression(e.stepExpression)),i.push(" do\n"),this.pushIndent(),i.push(this.printBlock(e.body)),this.popIndent(),i.push(this.indent("end")),this.concatNodes(...i)}printForInStatement(e){const t=this.joinChunksWithComma(e.names.map(e=>this.printIdentifier(e))),n=this.joinChunksWithComma(e.expressions.map(e=>this.printExpression(e))),r=[];return r.push(this.indent("for "),...t," in ",...n," do\n"),this.pushIndent(),r.push(this.printBlock(e.body)),this.popIndent(),r.push(this.indent("end")),this.createSourceNode(e,r)}printGotoStatement(e){return this.createSourceNode(e,[this.indent("goto "),e.label])}printLabelStatement(e){return this.createSourceNode(e,[this.indent("::"),e.name,"::"])}printReturnStatement(e){if(0===e.expressions.length)return this.createSourceNode(e,this.indent("return"));const t=[];return t.push(...this.joinChunksWithComma(e.expressions.map(e=>this.printExpression(e)))),this.createSourceNode(e,[this.indent(),"return ",...t])}printBreakStatement(e){return this.createSourceNode(e,this.indent("break"))}printContinueStatement(e){return this.createSourceNode(e,this.indent("continue"))}printExpressionStatement(e){return this.createSourceNode(e,[this.indent(),this.printExpression(e.expression)])}printExpression(e){switch(e.kind){case C.StringLiteral:return this.printStringLiteral(e);case C.NumericLiteral:return this.printNumericLiteral(e);case C.NilKeyword:return this.printNilLiteral(e);case C.DotsKeyword:return this.printDotsLiteral(e);case C.ArgKeyword:return this.printArgLiteral(e);case C.TrueKeyword:case C.FalseKeyword:return this.printBooleanLiteral(e);case C.FunctionExpression:return this.printFunctionExpression(e);case C.TableFieldExpression:return this.printTableFieldExpression(e);case C.TableExpression:return this.printTableExpression(e);case C.UnaryExpression:return this.printUnaryExpression(e);case C.BinaryExpression:return this.printBinaryExpression(e);case C.CallExpression:return this.printCallExpression(e);case C.MethodCallExpression:return this.printMethodCallExpression(e);case C.Identifier:return this.printIdentifier(e);case C.TableIndexExpression:return this.printTableIndexExpression(e);case C.ParenthesizedExpression:return this.printParenthesizedExpression(e);case C.ConditionalExpression:return this.printConditionalExpression(e);default:throw new Error("Tried to print unknown statement kind: ".concat(C[e.kind]))}}printStringLiteral(e){return this.createSourceNode(e,Ea(e.value))}printNumericLiteral(e){return this.createSourceNode(e,String(e.value))}printNilLiteral(e){return this.createSourceNode(e,"nil")}printDotsLiteral(e){return this.createSourceNode(e,"...")}printArgLiteral(e){return this.createSourceNode(e,"arg")}printBooleanLiteral(e){return this.createSourceNode(e,e.kind===C.TrueKeyword?"true":"false")}printFunctionParameters(e){var t;const n=(null!==(t=e.params)&&void 0!==t?t:[]).map(e=>this.printIdentifier(e));return e.dots&&n.push(this.printDotsLiteral(e.dots)),this.joinChunksWithComma(n)}printFunctionExpression(e){const t=[];if(t.push("function("),t.push(...this.printFunctionParameters(e)),t.push(")"),function(e){var t;return 1===(null===(t=e.body.statements)||void 0===t?void 0:t.length)&&Z(e.body.statements[0])&&void 0!==e.body.statements[0].expressions&&0!==(e.flags&D.Inline)}(e)){const n=e.body.statements[0];t.push(" ");const r=["return ",...this.joinChunksWithComma(n.expressions.map(e=>this.printExpression(e)))];t.push(this.createSourceNode(n,r)),t.push(this.createSourceNode(e," end"))}else t.push("\n"),this.pushIndent(),t.push(this.printBlock(e.body)),this.popIndent(),t.push(this.indent(this.createSourceNode(e,"end")));return this.createSourceNode(e,t)}printFunctionDefinition(e){const t=e.right[0],n=[];return n.push("function "),n.push(this.printExpression(e.left[0])),n.push("("),n.push(...this.printFunctionParameters(t)),n.push(")\n"),this.pushIndent(),n.push(this.printBlock(t.body)),this.popIndent(),n.push(this.indent(this.createSourceNode(e,"end"))),this.createSourceNode(t,n)}printTableFieldExpression(e){const t=[],n=this.printExpression(e.value);return e.key?pe(e.key)&&Bs(e.key.value,this.options)?t.push(e.key.value," = ",n):t.push("[",this.printExpression(e.key),"] = ",n):t.push(n),this.createSourceNode(e,t)}printTableExpression(e){return this.createSourceNode(e,["{",...this.printExpressionList(e.fields),"}"])}printUnaryExpression(e){const t=[];return t.push(this.printOperator(e.operator)),t.push(this.printExpressionInParenthesesIfNeeded(e.operand,_a.operatorPrecedence[e.operator])),this.createSourceNode(e,t)}printBinaryExpression(e){const t=[],n=_a.rightAssociativeOperators.has(e.operator),r=_a.operatorPrecedence[e.operator];return t.push(this.printExpressionInParenthesesIfNeeded(e.left,n?r+1:r)),t.push(" ",this.printOperator(e.operator)," "),t.push(this.printExpressionInParenthesesIfNeeded(e.right,n?r:r+1)),this.createSourceNode(e,t)}printExpressionInParenthesesIfNeeded(e,t){return this.needsParenthesis(e,t)?this.createSourceNode(e,["(",this.printExpression(e),")"]):this.printExpression(e)}needsParenthesis(e,t){return ve(e)||xe(e)?void 0===t||_a.operatorPrecedence[e.operator]<t:me(e)||e.kind===C.TableExpression}printCallExpression(e){const t=[];return t.push(this.printExpressionInParenthesesIfNeeded(e.expression),"("),e.params&&t.push(...this.printExpressionList(e.params)),t.push(")"),this.createSourceNode(e,t)}printMethodCallExpression(e){const t=[],n=this.needsParenthesis(e.prefixExpression)||pe(e.prefixExpression)?["(",this.printExpression(e.prefixExpression),")"]:[this.printExpression(e.prefixExpression)],r=this.printIdentifier(e.name);return t.push(...n,":",r,"("),e.params&&t.push(...this.printExpressionList(e.params)),t.push(")"),this.createSourceNode(e,t)}printIdentifier(e){return this.createSourceNode(e,e.text,e.originalName!==e.text?e.originalName:void 0)}printTableIndexExpression(e){const t=[];return t.push(this.printExpressionInParenthesesIfNeeded(e.table)),pe(e.index)&&Bs(e.index.value,this.options)?t.push(".",this.createSourceNode(e.index,e.index.value)):t.push("[",this.printExpression(e.index),"]"),this.createSourceNode(e,t)}printParenthesizedExpression(e){return this.createSourceNode(e,["(",this.printExpression(e.expression),")"])}printConditionalExpression(e){return this.createSourceNode(e,["if ",this.printExpression(e.condition)," then ",this.printExpression(e.whenTrue)," else ",this.printExpression(e.whenFalse)])}printOperator(e){return new Ge.SourceNode(null,null,this.relativeSourcePath,_a.operatorMap[e])}joinChunksWithComma(e){return u(e,", ")}isSimpleExpressionList(e){return e.length<=1||!(e.length>4)&&e.every(Aa)}printExpressionList(e){const t=[];if(this.isSimpleExpressionList(e))t.push(...this.joinChunksWithComma(e.map(e=>this.printExpression(e))));else{t.push("\n"),this.pushIndent();for(const[n,r]of e.entries()){const i=n<e.length-1?",\n":"\n";t.push(this.indent(),this.printExpression(r),i)}this.popIndent(),t.push(this.indent())}return t}buildSourceMap(e,t){const n=new Ge.SourceMapGenerator({file:o.default.basename(this.luaFile),sourceRoot:e});let r,i=1,s=0;const a=e=>{(e=>null!==e.line&&(void 0===r||(r.generated.line!==i||r.generated.column!==s||r.name!==e.name)&&(r.original.line!==e.line||r.original.column!==e.column||r.name!==e.name)))(e)&&(r={source:e.source,original:{line:e.line,column:e.column},generated:{line:i,column:s},name:e.name},n.addMapping(r));for(const t of e.children)if("string"===typeof t){const e=t.split("\n");e.length>1&&(i+=e.length-1,s=0,r=void 0),s+=e[e.length-1].length}else a(t)};return a(t),n}}_a.operatorMap={[C.AdditionOperator]:"+",[C.SubtractionOperator]:"-",[C.MultiplicationOperator]:"*",[C.DivisionOperator]:"/",[C.FloorDivisionOperator]:"//",[C.ModuloOperator]:"%",[C.PowerOperator]:"^",[C.NegationOperator]:"-",[C.ConcatOperator]:"..",[C.LengthOperator]:"#",[C.EqualityOperator]:"==",[C.InequalityOperator]:"~=",[C.LessThanOperator]:"<",[C.LessEqualOperator]:"<=",[C.GreaterThanOperator]:">",[C.GreaterEqualOperator]:">=",[C.AndOperator]:"and",[C.OrOperator]:"or",[C.NotOperator]:"not ",[C.BitwiseAndOperator]:"&",[C.BitwiseOrOperator]:"|",[C.BitwiseExclusiveOrOperator]:"~",[C.BitwiseRightShiftOperator]:">>",[C.BitwiseLeftShiftOperator]:"<<",[C.BitwiseNotOperator]:"~"},_a.operatorPrecedence={[C.OrOperator]:1,[C.AndOperator]:2,[C.EqualityOperator]:3,[C.InequalityOperator]:3,[C.LessThanOperator]:3,[C.LessEqualOperator]:3,[C.GreaterThanOperator]:3,[C.GreaterEqualOperator]:3,[C.BitwiseOrOperator]:4,[C.BitwiseExclusiveOrOperator]:5,[C.BitwiseAndOperator]:6,[C.BitwiseLeftShiftOperator]:7,[C.BitwiseRightShiftOperator]:7,[C.ConcatOperator]:8,[C.AdditionOperator]:9,[C.SubtractionOperator]:9,[C.MultiplicationOperator]:10,[C.DivisionOperator]:10,[C.FloorDivisionOperator]:10,[C.ModuloOperator]:10,[C.NotOperator]:11,[C.LengthOperator]:11,[C.NegationOperator]:11,[C.BitwiseNotOperator]:11,[C.PowerOperator]:12},_a.rightAssociativeOperators=new Set([C.ConcatOperator,C.PowerOperator]),_a.sourceMapTracebackPlaceholder="{#SourceMapTraceback}";var ka=n(59852);const Oa=i.ScriptTarget.ESNext,Na=i.ModuleKind.ESNext,wa={strict:!0,jsx:i.JsxEmit.React,luaTarget:I.Lua54,luaLibImport:F.Require,noHeader:!0,sourceMap:!0,noImplicitSelf:!0,moduleResolution:i.ModuleResolutionKind.Classic,target:Oa,module:Na};function La(e,t){const n=a.A.path.dirname(e),s=new Map,o=new Map,c=new Set;return[{fileExists:t=>{if(t.search("node_modules")>0)return!1;t=a.A.path.normalize(t);const i=o.get(t);if(void 0!==i){if(null!==r.editor.getModel(i))return!0}const s=a.A.path.basename(t);if(s.startsWith("Dora.d."))return!1;if(s.startsWith("Dora."))return!0;if(s.toLowerCase().startsWith("dora."))return!1;if("lib.Dora.d.ts"===s)return!0;if(a.A.path.isAbsolute(t)){const i=a.A.path.relative(n,t);if(!i.startsWith("..")){const n=a.A.path.extname(i);let s=a.A.path.basename(i,n);s=".d"===a.A.path.extname(s)?a.A.path.basename(s,".d"):s;const u=s,l=a.A.path.dirname(i),p=a.A.path.join(l,u);for(const e of[".d.ts",".ts",".tsx"]){const n=r.Uri.file(p+e);if(null!==r.editor.getModel(n))return o.set(t,n),!0}if(c.has(p))return!1;const d=ka.Wf({path:p,exts:[".d.ts",".ts",".tsx"],projFile:e});if(null!==d&&void 0!==d&&d.success){const e=r.Uri.file(d.fullPath);return null===r.editor.getModel(e)&&r.editor.createModel(d.content,"typescript",e),o.set(t,e),!0}o.delete(t),c.add(p)}}const u=a.A.path.extname(t);let l=a.A.path.basename(t,u);l=".d"===a.A.path.extname(l)?a.A.path.basename(l,".d"):l;for(const e of[".d.ts",".ts",".tsx"]){const n=r.Uri.file(a.A.path.join(a.A.path.dirname(t),l+e));if(null!==r.editor.getModel(n))return o.set(t,n),!0}return!1},getCanonicalFileName:e=>a.A.path.normalize(e),getCurrentDirectory:()=>n,getDefaultLibFileName:()=>"lib.Dora.d.ts",readFile:e=>{e=a.A.path.normalize(e);const n=r.Uri.file(e),i=r.editor.getModel(n);if(null!==i)return i.getValue();const s=ka.Wf({path:e});return null!==s&&void 0!==s&&s.success&&null===r.editor.getModel(n)&&r.editor.createModel(s.content,"typescript",n),t},getNewLine:()=>"\n",useCaseSensitiveFileNames:()=>!0,writeFile:(e,t)=>{s.set(e,t)},getSourceFile(n){n=a.A.path.normalize(n);const s=a.A.path.basename(n);if(s.startsWith("Dora."))return i.createSourceFile("dummy.d.ts","",Oa,!1);if("jsx.d.ts"===s){const t=r.Uri.file(s),n=r.editor.getModel(t);if(null!==n)return i.createSourceFile(s,n.getValue(),Oa,!1);{const n=ka.Wf({path:s,projFile:e});if(null!==n&&void 0!==n&&n.success)return r.editor.createModel(n.content,"typescript",t),i.createSourceFile(s,n.content,Oa,!1)}}if("lib.Dora.d.ts"===s){const e=r.Uri.file("Dora.d.ts"),t=r.editor.getModel(e);if(null!==t)return i.createSourceFile("Dora.d.ts",t.getValue(),Oa,!1);{const t=ka.Wf({path:"Dora.d.ts"});if(null!==t&&void 0!==t&&t.success)return r.editor.createModel(t.content,"typescript",e),i.createSourceFile("Dora.d.ts",t.content,Oa,!1)}}const c=r.typescript.typescriptDefaults.getExtraLibs()[n];if(c)return i.createSourceFile(n,c.content,Oa,!1);if(a.A.path.isAbsolute(n)&&""!==a.A.path.relative(e,n)){const e=o.get(n);if(void 0!==e){const t=r.editor.getModel(e);if(null!==t)return i.createSourceFile(e.fsPath,t.getValue(),Oa,!1)}return}return i.createSourceFile(n,t,Oa,!1)}},s]}async function Fa(e,t){const n=function(e,t){const[n]=La(e,t);return wa.baseUrl=a.A.path.dirname(e),i.createProgram([e],wa,n)}(e,t);let r=i.getPreEmitDiagnostics(n);const s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".lua";const t=[];return{writeFile:function(n,r,i,s){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],a=t.find(e=>p(e.sourceFiles,o).length>0);a?a.sourceFiles=l(a.sourceFiles,o):(a={outPath:n,sourceFiles:[...o]},t.push(a)),n.endsWith(e)?a.lua=r:n.endsWith("".concat(e,".map"))?a.luaSourceMap=r:n.endsWith(".js")?a.js=r:n.endsWith(".js.map")?a.jsSourceMap=r:n.endsWith(".d.ts")?a.declaration=r:n.endsWith(".d.ts.map")&&(a.declarationMap=r)},files:t}}(),o=new ma({emitHost:{directoryExists:()=>!1,fileExists:()=>!0,getCurrentDirectory:()=>a.A.path.dirname(e),readFile:()=>"",writeFile:()=>{}}}).emit({program:n,writeFile:s.writeFile});r=[...r,...o.diagnostics].filter(e=>2497!==e.code&&2666!==e.code);const c=r.filter(t=>{try{var n,r;return""!==a.A.path.relative(null!==(n=null===(r=t.file)||void 0===r?void 0:r.fileName)&&void 0!==n?n:"",e)}catch(i){return!0}});Ca(e,c);const u=0===r.length,d=s.files.find(t=>{let{sourceFiles:n}=t;return n.some(t=>""===a.A.path.relative(t.fileName,e))});if(void 0!==d){const t=d.luaSourceMap;if(void 0!==t&&void 0!==d.lua){const n=d.lua.split("\n");let i;return await Ge.SourceMapConsumer.with(t,null,t=>{let r=null;i="-- [".concat(a.A.path.extname(e).substring(1).toLowerCase(),"]: ").concat(a.A.path.basename(e),"\n")+n.map((e,n)=>{var i;const s=e.search(/\S|$/),o=t.originalPositionFor({line:n+1,column:s});null!=o.line&&(r=o.line);const a=null!==(i=r)&&void 0!==i?i:1;return""===e.trim()?"":e.match("--")?e:e+" -- ".concat(a)}).filter(e=>""!==e).join("\n")}),{success:u,luaCode:i,diagnostics:r,extraError:c.length>0}}}return{success:u,luaCode:void 0,diagnostics:r,extraError:c.length>0}}async function Ia(e){if(!e||e.isDisposed())return;const t=await r.typescript.getTypeScriptWorker(),n=await t(e.uri),s=(await Promise.all([n.getSyntacticDiagnostics(e.uri.toString()),n.getSemanticDiagnostics(e.uri.toString())])).reduce((e,t)=>e.concat(t)).filter(e=>2497!==e.code&&2666!==e.code).map(t=>{const{start:n=0,length:s=0}=t,o=e.getPositionAt(n),a=e.getPositionAt(n+s);return{severity:r.MarkerSeverity.Error,startLineNumber:o.lineNumber,startColumn:o.column,endLineNumber:a.lineNumber,endColumn:a.column,message:i.flattenDiagnosticMessageText(t.messageText,"\n")}});r.editor.setModelMarkers(e,e.getLanguageId(),s)}function Ma(e,t){const n=t.filter(t=>{var n,r;const i=null!==(n=null===(r=t.file)||void 0===r?void 0:r.fileName)&&void 0!==n?n:"";if(!a.A.path.isAbsolute(i))return!1;if(!a.A.path.isAbsolute(e.uri.fsPath))return!1;try{return""===a.A.path.relative(i,e.uri.fsPath)&&"typescript-to-lua"===t.source}catch(s){return!1}}).map(t=>{const{start:n=0,length:s=0}=t,o=e.getPositionAt(n),a=e.getPositionAt(n+s);return{severity:r.MarkerSeverity.Error,startLineNumber:o.lineNumber,startColumn:o.column,endLineNumber:a.lineNumber,endColumn:a.column,message:i.flattenDiagnosticMessageText(t.messageText,"\n")}});r.editor.setModelMarkers(e,"tstl",n)}function Pa(e,t){return 0===t.length?"":"Compiling error: ".concat(e,"\n")+i.formatDiagnostics(t,{getCanonicalFileName:e=>a.A.path.normalize(e),getCurrentDirectory:()=>a.A.path.dirname(e),getNewLine:()=>"\n"})}function Ca(e,t){if(0===t.length)return;let n=Pa(e,t);n=n.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r?\n/g,"\\n"),ka.G5({code:'Log "Error", "'.concat(n,'"'),log:!1})}Ge.SourceMapConsumer.initialize({"lib/mappings.wasm":"/mappings.wasm"});const Da={declaration:!0,emitDeclarationOnly:!0,strict:!0,jsx:i.JsxEmit.React,sourceMap:!0,moduleResolution:i.ModuleResolutionKind.Classic,target:Oa,module:Na};function Ka(e,t){const[n,r]=La(e,t);Ca(e,i.createProgram([e],Da,n).emit().diagnostics);const s=a.A.path.basename(e,a.A.path.extname(e));for(const[i,o]of r.entries()){if(a.A.path.basename(i,".d.ts")===s&&i.endsWith(".d.ts"))return{fileName:i,content:o}}return null}},66247:()=>{},72615:()=>{},82202:()=>{},84021:()=>{},84351:()=>{},89387:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=89387,e.exports=t},97664:()=>{}}]);