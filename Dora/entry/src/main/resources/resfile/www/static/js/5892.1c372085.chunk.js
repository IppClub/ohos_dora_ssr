"use strict";(self.webpackChunkdora_dora=self.webpackChunkdora_dora||[]).push([[5892],{55892:(e,l,r)=>{r.r(l),r.d(l,{default:()=>G});var i=r(54616),t=r(59852),o=r(9950),d=r(57559),n=r(65827),a=r(65250),s=r(49702),c=r(71500),h=r(47371),p=r(87209),x=r(53693),u=r(66615),m=r(67818),y=r(13450),g=r(29949),j=r(71613),v=r(10495),f=r(7714),b=r(78945),k=r(79771),A=r(9762),T=r(77459),S=r(75641),P=r(58179),w=r(23072),F=r(15030),C=r(84765),M=r(44414);let D=[];const B=e=>[{title:e("pro.order"),dataIndex:"order",showSorterTooltip:{target:"full-header"},defaultSortOrder:"descend",sorter:(e,l)=>e.order-l.order,sortDirections:["ascend","descend"]},{title:e("pro.time"),dataIndex:"time",sorter:(e,l)=>e.time-l.time,sortDirections:["ascend","descend"],render:(e,l)=>{let{time:r}=l;return(0,M.jsxs)(M.Fragment,{children:[r," ms"]})}},{title:e("pro.depth"),dataIndex:"depth",sorter:(e,l)=>e.depth-l.depth,sortDirections:["ascend","descend"],render:(e,l)=>{let{depth:r}=l;return(0,M.jsxs)(M.Fragment,{children:[Array.from({length:r},((e,l)=>(0,M.jsx)("p",{style:{display:"inline-block",padding:0,margin:0},children:"\u2003"},l))),r+1]})}},{title:e("pro.module"),dataIndex:"moduleName"}],z=e=>(0,M.jsx)("span",{children:e.split(/\[(error|warning|info)\]/).map(((e,l)=>l%2===1?(0,M.jsxs)("span",{children:["[",(0,M.jsx)("span",{style:{color:"error"===e?y.Q1.Error:"warning"===e?y.Q1.Warning:y.Q1.Info},children:e}),"]"]},l):(0,M.jsx)("span",{children:e},l)))}),L={appear:!1,enter:!1,exit:!1},G=(0,o.memo)((e=>{var l;const{t:r}=(0,m.Bd)(),[G,Q]=(0,o.useState)(r("log.wait")),[U,O]=(0,o.useState)(""),[W,R]=(0,o.useState)([]),[H,I]=(0,o.useState)(-1),[N,K]=(0,o.useState)(C.A.webProfiler),[E,X]=(0,o.useState)(null),[Y,V]=(0,o.useState)(B(r));(0,o.useEffect)((()=>{V(B(r))}),[r]),(0,o.useEffect)((()=>{const e=(e,l)=>{Q(""===l?r("log.wait"):l)};t.oi(e);const l=e=>{if(N){var l;if(void 0===e.loaderCosts)e.loaderCosts=null!==(l=null===E||void 0===E?void 0:E.loaderCosts)&&void 0!==l?l:[],D=e.plotCount>0?Array.from({length:e.plotCount+1},((e,l)=>l)):[];X(e)}};return t.NW(l),()=>{t.N4(e),t.KW(l)}}),[r,null===E||void 0===E?void 0:E.loaderCosts,N]);const $=e=>{null!==E&&(E.targetFPS=e.target.value,t.G5({code:`App.targetFPS = ${E.targetFPS}`,log:!1}).then((()=>{X({...E})})).catch((e=>{console.error(e)})))},_=e=>{null!==E&&(E.fixedFPS=e.target.value,t.G5({code:`Director.scheduler.fixedFPS = ${E.fixedFPS}`,log:!1}).then((()=>{X({...E})})).catch((e=>{console.error(e)})))},q=e=>{null!==E&&(E.vSync=e.target.checked,t.G5({code:"View.vsync = "+(E.vSync?"true":"false"),log:!1}).then((()=>{X({...E})})).catch((e=>{console.error(e)})))},J=e=>{null!==E&&(E.fpsLimited=e.target.checked,t.G5({code:"App.fpsLimited = "+(E.fpsLimited?"true":"false"),log:!1}).then((()=>{X({...E})})).catch((e=>{console.error(e)})))};let Z,ee,le,re,ie=null,te=null,oe=0;if(null!==E){var de,ne;Z=[{key:"1",label:(0,M.jsx)(d.A,{title:r("pro.rendererTip"),children:(0,M.jsx)("div",{children:r("pro.renderer")})}),children:E.renderer},{key:"2",label:(0,M.jsx)(d.A,{title:r("pro.multiThreadedTip"),children:(0,M.jsx)("div",{children:r("pro.multiThreaded")})}),children:E.multiThreaded?"Yes":"No"},{key:"3",label:(0,M.jsx)(d.A,{title:r("pro.backBufferTip"),children:(0,M.jsx)("div",{children:r("pro.backBuffer")})}),children:E.backBufferX+" x "+E.backBufferY},{key:"4",label:(0,M.jsx)(d.A,{title:r("pro.drawCallTip"),children:(0,M.jsx)("div",{children:r("pro.drawCall")})}),children:E.drawCall},{key:"5",label:(0,M.jsx)(d.A,{title:r("pro.triTip"),children:(0,M.jsx)("div",{children:r("pro.tri")})}),children:E.tri},{key:"6",label:(0,M.jsx)(d.A,{title:r("pro.lineTip"),children:(0,M.jsx)("div",{children:r("pro.line")})}),children:E.line},{key:"7",label:(0,M.jsx)(d.A,{title:r("pro.visualSizeTip"),children:(0,M.jsx)("div",{children:r("pro.visualSize")})}),children:E.visualSizeX+" x "+E.visualSizeY},{key:"8",label:(0,M.jsx)(d.A,{title:r("pro.vSyncTip"),children:(0,M.jsx)("div",{children:r("pro.vSync")})}),children:(0,M.jsx)(v.A,{checked:null===E||void 0===E?void 0:E.vSync,onChange:q})},{key:"9",label:(0,M.jsx)(d.A,{title:r("pro.fpsLimitedTip"),children:(0,M.jsx)("div",{children:r("pro.fpsLimited")})}),children:(0,M.jsx)(v.A,{checked:null===E||void 0===E?void 0:E.fpsLimited,onChange:J})},{key:"10",label:(0,M.jsx)(d.A,{title:r("pro.fpsTip"),children:(0,M.jsx)("div",{children:r("pro.fps")})}),children:(0,M.jsxs)(f.Ay.Group,{onChange:$,value:E.targetFPS,children:[(0,M.jsx)(f.Ay,{value:30,children:"30"}),(0,M.jsx)("br",{}),(0,M.jsx)(f.Ay,{value:45,children:"45"}),(0,M.jsx)("br",{}),(0,M.jsx)(f.Ay,{value:60,children:"60"}),E.maxTargetFPS>60&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)("br",{}),(0,M.jsx)(f.Ay,{value:E.maxTargetFPS,children:E.maxTargetFPS})]})]})},{key:"11",label:(0,M.jsx)(d.A,{title:r("pro.currentFPSTip"),children:(0,M.jsx)("div",{children:r("pro.currentFPS")})}),children:E.currentFPS},{key:"12",label:(0,M.jsx)(d.A,{title:r("pro.fixedFPSTip"),children:(0,M.jsx)("div",{children:r("pro.fixedFPS")})}),children:(0,M.jsxs)(f.Ay.Group,{onChange:_,value:E.fixedFPS,children:[(0,M.jsx)(f.Ay,{value:30,children:"30"}),(0,M.jsx)("br",{}),(0,M.jsx)(f.Ay,{value:45,children:"45"}),(0,M.jsx)("br",{}),(0,M.jsx)(f.Ay,{value:60,children:"60"}),E.maxTargetFPS>60&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)("br",{}),(0,M.jsx)(f.Ay,{value:E.maxTargetFPS,children:E.maxTargetFPS})]})]})}],ee=[{key:"1",label:(0,M.jsx)(d.A,{title:r("pro.avgCPUTip"),children:(0,M.jsx)("div",{children:r("pro.avgCPU")})}),children:E.avgCPU+" ms"},{key:"2",label:(0,M.jsx)(d.A,{title:r("pro.avgGPUTip"),children:(0,M.jsx)("div",{children:r("pro.avgGPU")})}),children:E.avgGPU+" ms"}],le=[{key:"1",label:(0,M.jsx)(d.A,{title:r("pro.cppObjectTip"),children:(0,M.jsx)("div",{children:r("pro.cppObject")})}),children:E.cppObject},{key:"2",label:(0,M.jsx)(d.A,{title:r("pro.luaObjectTip"),children:(0,M.jsx)("div",{children:r("pro.luaObject")})}),children:E.luaObject},{key:"3",label:(0,M.jsx)(d.A,{title:r("pro.luaCallbackTip"),children:(0,M.jsx)("div",{children:r("pro.luaCallback")})}),children:E.luaCallback},{key:"4",label:(0,M.jsx)(d.A,{title:r("pro.texturesTip"),children:(0,M.jsx)("div",{children:r("pro.textures")})}),children:E.textures},{key:"5",label:(0,M.jsx)(d.A,{title:r("pro.fontsTip"),children:(0,M.jsx)("div",{children:r("pro.fonts")})}),children:E.fonts},{key:"6",label:(0,M.jsx)(d.A,{title:r("pro.audiosTip"),children:(0,M.jsx)("div",{children:r("pro.audios")})}),children:E.audios}],re=[{key:"1",label:(0,M.jsx)(d.A,{title:r("pro.memoryPoolTip"),children:(0,M.jsx)("div",{children:r("pro.memoryPool")})}),children:E.memoryPool/1024+" KB"},{key:"2",label:(0,M.jsx)(d.A,{title:r("pro.luaMemoryTip"),children:(0,M.jsx)("div",{children:r("pro.luaMemory")})}),children:(E.luaMemory/1024/1024).toFixed(2)+" MB"},{key:"3",label:(0,M.jsx)(d.A,{title:r("pro.tealMemoryTip"),children:(0,M.jsx)("div",{children:r("pro.tealMemory")})}),children:(E.tealMemory/1024/1024).toFixed(2)+" MB"},{key:"4",label:(0,M.jsx)(d.A,{title:r("pro.wasmMemoryTip"),children:(0,M.jsx)("div",{children:r("pro.wasmMemory")})}),children:(E.wasmMemory/1024/1024).toFixed(2)+" MB"},{key:"5",label:(0,M.jsx)(d.A,{title:r("pro.textureMemoryTip"),children:(0,M.jsx)("div",{children:r("pro.textureMemory")})}),children:(E.textureMemory/1024/1024).toFixed(2)+" MB"},{key:"6",label:(0,M.jsx)(d.A,{title:r("pro.fontMemoryTip"),children:(0,M.jsx)("div",{children:r("pro.fontMemory")})}),children:(E.fontMemory/1024/1024).toFixed(2)+" MB"},{key:"7",label:(0,M.jsx)(d.A,{title:r("pro.audioMemoryTip"),children:(0,M.jsx)("div",{children:r("pro.audioMemory")})}),children:(E.audioMemory/1024/1024).toFixed(2)+" MB"}],ie={data:D.map(((e,l)=>({time:D.length-l,value:1e3/E.targetFPS,category:"Base"}))).concat(E.cpuTimePeeks.map(((e,l)=>({time:E.cpuTimePeeks.length-l,value:e,category:"CPU"})))).concat(E.gpuTimePeeks.map(((e,l)=>({time:E.gpuTimePeeks.length-l,value:e,category:"GPU"})))).concat(E.deltaTimePeeks.map(((e,l)=>({time:E.deltaTimePeeks.length-l,value:e,category:"Delta"})))),xField:"time",yField:"value",legend:{size:!1},colorField:"category",title:{title:r("pro.frameTimePeaks"),style:{titleFontSize:14,titleFill:y.Q1.TextPrimary}},autoFit:!0,theme:"classicDark",animate:!1,tooltip:!1,marginLeft:0,marginRight:10};let e=0;for(let l of E.updateCosts)e+=l.value;te={data:E.updateCosts.filter((e=>e.value>0)).map((l=>({type:l.name,value:Math.round(100*l.value/e)}))),angleField:"value",colorField:"type",label:{text:"value",style:{fontWeight:"bold"}},legend:{color:{title:!1,position:"top",rowPadding:5}},title:{title:r("pro.cpuTimePercent"),style:{titleFontSize:14,titleFill:y.Q1.TextPrimary}},innerRadius:.5,autoFit:!0,theme:"classicDark",animate:!1,tooltip:!1,marginLeft:0,marginRight:10},oe=(null!==(de=null===(ne=E.loaderCosts)||void 0===ne?void 0:ne.filter((e=>0===e.depth)).reduce(((e,l)=>e+l.time),0))&&void 0!==de?de:0)/1e3}else Z=[],ee=[],le=[],re=[];const ae=.3*e.height;return(0,M.jsx)(y.HK,{children:(0,M.jsxs)(n.A,{maxWidth:"lg",fullWidth:!0,keepMounted:!0,open:null!==e.openName,"aria-labelledby":"logview-dialog-title","aria-describedby":"logview-dialog-description",transitionDuration:0,slotProps:{transition:L},children:[(0,M.jsxs)(a.A,{style:{overflow:"hidden",margin:0,padding:0},children:[(0,M.jsxs)("div",{hidden:!N,children:[(0,M.jsx)(s.A,{sx:{width:"100%",height:e.height-ae-1,background:y.Q1.BackgroundDark},children:(0,M.jsx)(b.Ay,{theme:{algorithm:[k.A.darkAlgorithm,k.A.compactAlgorithm],components:{Radio:{colorPrimary:y.Q1.Theme+"aa"},Checkbox:{colorPrimary:y.Q1.Theme+"aa",colorPrimaryHover:y.Q1.Theme}}},children:(0,M.jsx)(T.K9,{skin:"dark",style:{width:"100%",height:"100%"},children:(0,M.jsxs)("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap",width:"100%",height:"100%",padding:10},children:[(0,M.jsx)("div",{style:{padding:5,width:"25%",minHeight:400},children:(0,M.jsx)(A.A,{title:r("pro.basic"),layout:"vertical",bordered:!0,items:Z,size:"small"})}),(0,M.jsxs)("div",{style:{padding:5,width:"25%",height:290},children:[(0,M.jsx)(A.A,{title:r("pro.time"),layout:"vertical",bordered:!0,items:ee,size:"small"}),ie?(0,M.jsx)(S.A,{...ie}):null]}),(0,M.jsxs)("div",{style:{padding:5,width:"25%",height:290},children:[(0,M.jsx)(A.A,{title:r("pro.object"),layout:"vertical",bordered:!0,items:le,size:"small"}),te?(0,M.jsx)(P.A,{...te}):null]}),(0,M.jsx)("div",{style:{padding:5,width:"25%",minHeight:290},children:(0,M.jsx)(A.A,{title:r("pro.memory"),layout:"vertical",bordered:!0,items:re,size:"small"})}),(0,M.jsxs)("div",{style:{padding:5,width:"50%",minHeight:290},children:[(0,M.jsxs)(w.A,{children:[r("pro.loaderTimeCosts")," (",oe.toFixed(4)," s)"]}),(0,M.jsx)(F.A,{bordered:!0,dataSource:null===E||void 0===E||null===(l=E.loaderCosts)||void 0===l?void 0:l.map((e=>({key:e.order,order:e.order,time:e.time,depth:e.depth,moduleName:e.moduleName}))),columns:Y})]})]})})})}),(0,M.jsx)(y.wv,{})]}),(0,M.jsx)(i.LazyLog,{height:N?ae:e.height,text:G,style:{msOverflowStyle:"none",scrollbarWidth:"none",WebkitScrollSnapType:"none",fontSize:18,fontFamily:"Roboto,Helvetica,Arial,sans-serif",color:y.Q1.TextSecondary,background:y.Q1.BackgroundDark},formatPart:z,rowHeight:22,extraLines:1,selectableLines:!0,enableSearch:!0,caseInsensitive:!0,stream:!0,follow:!0}),(0,M.jsxs)("div",{style:{position:"absolute",bottom:10,right:10,opacity:.5,display:"flex",alignItems:"center"},children:[(0,M.jsx)("p",{style:{fontSize:14,marginRight:10,color:y.Q1.Secondary},children:e.openName}),(0,M.jsx)(c.A,{color:"secondary","aria-label":"toggle-profiler",onClick:()=>{t.G5({code:"Director.profilerSending = "+(N?"false":"true"),log:!1}).then((()=>{K(!N)})).catch((e=>{console.error(e)}))},sx:{width:40,height:40},children:N?(0,M.jsx)(g.uFL,{}):(0,M.jsx)(j.A,{})})]})]}),(0,M.jsxs)(h.A,{children:[(0,M.jsx)("form",{noValidate:!0,autoComplete:"off",style:{width:"100%"},onSubmit:e=>{e.preventDefault(),""!==U&&(R((e=>{const l=[...e,U];return l.length>20?l.slice(-20):l})),I(W.length>=20?20:W.length+1),O(""),t.G5({code:U,log:!0}).then().catch((e=>{console.error(e)})))},children:(0,M.jsx)(p.A,{fullWidth:!0,sx:{paddingRight:3,"& .MuiOutlinedInput-notchedOutline":{borderColor:y.Q1.Secondary}},children:(0,M.jsx)(x.A,{label:r("log.command"),id:"commandline",value:U,onChange:e=>O(e.target.value),onKeyDown:e=>{if("ArrowUp"===e.key||"ArrowDown"===e.key){e.preventDefault();let l=H;"ArrowUp"===e.key?l=l>0?l-1:0:"ArrowDown"===e.key&&(l=l<W.length-1?l+1:W.length-1),l>=0&&l<W.length?(O(W[l]),I(l)):l===W.length&&(O(""),I(l))}}})})}),(0,M.jsx)(u.A,{onClick:async()=>{try{const e=await t.ss();if(e.success){const l=e.path,r=new XMLHttpRequest;r.open("GET",t.c2("/"+l),!0),r.responseType="text",r.onload=function(){t.Ux(),t.SX(r.response)},r.send()}}catch(e){console.error(e)}},children:r("action.reload")}),(0,M.jsx)(u.A,{onClick:()=>{t.Ux()},children:r("action.clear")}),(0,M.jsx)(u.A,{onClick:e.onClose,style:{marginRight:20},children:r("action.close")})]})]})})}))}}]);